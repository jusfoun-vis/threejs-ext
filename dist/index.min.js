/*!
 * The three.js expansion library v0.89.0
 * Collected by Jusfoun Visualization Department
 * Contact: 
 *   vis@jusfoun.com
 *   http://vis.jusfoun.com
 *   http://jusfoun-vis.github.io
 * 
 * Copyright (c) 2018, Jusfoun Big Data Group Inc.
 * All rights reserved.
 * 
 * LICENSE
 * http://www.jusfoun.com/software/LICENSE.txt
 * 
 * The three.js LICENSE
 * http://threejs.org/license
 */
!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t){e.exports=require("three")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var n=r(14);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.VRControls=t.TransformControls=t.TrackballControls=t.PointerLockControls=t.OrthographicTrackballControls=t.OrbitControls=t.FlyControls=t.FirstPersonControls=t.EditorControls=t.DragControls=t.DeviceOrientationControls=void 0;var n=r(3),i=a(n),o=r(4),s=a(o),l=r(5),u=a(l),c=r(6),h=a(c),d=r(7),p=a(d),f=r(8),m=a(f),v=r(9),g=a(v),y=r(10),b=a(y),w=r(11),A=a(w),M=r(12),x=a(M),L=r(13),E=a(L);t.DeviceOrientationControls=i.default,t.DragControls=s.default,t.EditorControls=u.default,t.FirstPersonControls=h.default,t.FlyControls=p.default,t.OrbitControls=m.default,t.OrthographicTrackballControls=g.default,t.PointerLockControls=b.default,t.TrackballControls=A.default,t.TransformControls=x.default,t.VRControls=E.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var r=function(e){t.deviceOrientation=e},a=function(){t.screenOrientation=window.orientation||0},i=function(){var e=new n.Vector3(0,0,1),t=new n.Euler,r=new n.Quaternion,a=new n.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(n,i,o,s,l){t.set(o,i,-s,"YXZ"),n.setFromEuler(t),n.multiply(a),n.multiply(r.setFromAxisAngle(e,-l))}}();this.connect=function(){a(),window.addEventListener("orientationchange",a,!1),window.addEventListener("deviceorientation",r,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",a,!1),window.removeEventListener("deviceorientation",r,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var r=e.alpha?n.Math.degToRad(e.alpha)+t.alphaOffset:0,a=e.beta?n.Math.degToRad(e.beta):0,o=e.gamma?n.Math.degToRad(e.gamma):0,s=t.screenOrientation?n.Math.degToRad(t.screenOrientation):0;i(t.object.quaternion,r,a,o,s)}}},this.dispose=function(){t.disconnect()},this.connect()},t.default=n.DeviceOrientationControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.DragControls=function(e,t,r){function a(){r.addEventListener("mousemove",s,!1),r.addEventListener("mousedown",l,!1),r.addEventListener("mouseup",u,!1),r.addEventListener("mouseleave",u,!1),r.addEventListener("touchmove",c,!1),r.addEventListener("touchstart",h,!1),r.addEventListener("touchend",d,!1)}function i(){r.removeEventListener("mousemove",s,!1),r.removeEventListener("mousedown",l,!1),r.removeEventListener("mouseup",u,!1),r.removeEventListener("mouseleave",u,!1),r.removeEventListener("touchmove",c,!1),r.removeEventListener("touchstart",h,!1),r.removeEventListener("touchend",d,!1)}function o(){i()}function s(a){a.preventDefault();var n=r.getBoundingClientRect();if(v.x=(a.clientX-n.left)/n.width*2-1,v.y=-(a.clientY-n.top)/n.height*2+1,m.setFromCamera(v,t),b&&A.enabled)return m.ray.intersectPlane(f,y)&&b.position.copy(y.sub(g)),void A.dispatchEvent({type:"drag",object:b});m.setFromCamera(v,t);var i=m.intersectObjects(e);if(i.length>0){var o=i[0].object;f.setFromNormalAndCoplanarPoint(t.getWorldDirection(f.normal),o.position),w!==o&&(A.dispatchEvent({type:"hoveron",object:o}),r.style.cursor="pointer",w=o)}else null!==w&&(A.dispatchEvent({type:"hoveroff",object:w}),r.style.cursor="auto",w=null)}function l(a){a.preventDefault(),m.setFromCamera(v,t);var n=m.intersectObjects(e);n.length>0&&(b=n[0].object,m.ray.intersectPlane(f,y)&&g.copy(y).sub(b.position),r.style.cursor="move",A.dispatchEvent({type:"dragstart",object:b}))}function u(e){e.preventDefault(),b&&(A.dispatchEvent({type:"dragend",object:b}),b=null),r.style.cursor="auto"}function c(e){e.preventDefault(),e=e.changedTouches[0];var a=r.getBoundingClientRect();if(v.x=(e.clientX-a.left)/a.width*2-1,v.y=-(e.clientY-a.top)/a.height*2+1,m.setFromCamera(v,t),b&&A.enabled)return m.ray.intersectPlane(f,y)&&b.position.copy(y.sub(g)),void A.dispatchEvent({type:"drag",object:b})}function h(a){a.preventDefault(),a=a.changedTouches[0];var n=r.getBoundingClientRect();v.x=(a.clientX-n.left)/n.width*2-1,v.y=-(a.clientY-n.top)/n.height*2+1,m.setFromCamera(v,t);var i=m.intersectObjects(e);i.length>0&&(b=i[0].object,f.setFromNormalAndCoplanarPoint(t.getWorldDirection(f.normal),b.position),m.ray.intersectPlane(f,y)&&g.copy(y).sub(b.position),r.style.cursor="move",A.dispatchEvent({type:"dragstart",object:b}))}function d(e){e.preventDefault(),b&&(A.dispatchEvent({type:"dragend",object:b}),b=null),r.style.cursor="auto"}if(e instanceof n.Camera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var p=e;e=t,t=p}var f=new n.Plane,m=new n.Raycaster,v=new n.Vector2,g=new n.Vector3,y=new n.Vector3,b=null,w=null,A=this;a(),this.enabled=!0,this.activate=a,this.deactivate=i,this.dispose=o,this.setObjects=function(){console.error("THREE.DragControls: setObjects() has been removed.")},this.on=function(e,t){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead."),A.addEventListener(e,t)},this.off=function(e,t){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead."),A.removeEventListener(e,t)},this.notify=function(e){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead."),A.dispatchEvent({type:e})}},n.DragControls.prototype=Object.create(n.EventDispatcher.prototype),n.DragControls.prototype.constructor=n.DragControls,t.default=n.DragControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.EditorControls=function(e,t){function r(e){!1!==c.enabled&&(0===e.button?p=d.ROTATE:1===e.button?p=d.ZOOM:2===e.button&&(p=d.PAN),g.set(e.clientX,e.clientY),t.addEventListener("mousemove",a,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mouseout",i,!1),t.addEventListener("dblclick",i,!1))}function a(e){if(!1!==c.enabled){v.set(e.clientX,e.clientY);var t=v.x-g.x,r=v.y-g.y;p===d.ROTATE?c.rotate(new n.Vector3(-t*c.rotationSpeed,-r*c.rotationSpeed,0)):p===d.ZOOM?c.zoom(new n.Vector3(0,0,r)):p===d.PAN&&c.pan(new n.Vector3(-t,r,0)),g.set(e.clientX,e.clientY)}}function i(e){t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",i,!1),t.removeEventListener("mouseout",i,!1),t.removeEventListener("dblclick",i,!1),p=d.NONE}function o(e){e.preventDefault(),c.zoom(new n.Vector3(0,0,e.deltaY))}function s(e){e.preventDefault()}function l(e){if(!1!==c.enabled){switch(e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),M=w[0].distanceTo(w[1])}A[0].copy(w[0]),A[1].copy(w[1])}}function u(e){function t(e,t){var r=t[0];for(var a in t)r.distanceTo(e)>t[a].distanceTo(e)&&(r=t[a]);return r}if(!1!==c.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0),c.rotate(w[0].sub(t(w[0],A)).multiplyScalar(-c.rotationSpeed));break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var r=w[0].distanceTo(w[1]);c.zoom(new n.Vector3(0,0,M-r)),M=r;var a=w[0].clone().sub(t(w[0],A)),i=w[1].clone().sub(t(w[1],A));a.x=-a.x,i.x=-i.x,c.pan(a.add(i).multiplyScalar(.5))}A[0].copy(w[0]),A[1].copy(w[1])}}t=void 0!==t?t:document,this.enabled=!0,this.center=new n.Vector3,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var c=this,h=new n.Vector3,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},p=d.NONE,f=this.center,m=new n.Matrix3,v=new n.Vector2,g=new n.Vector2,y=new n.Spherical,b={type:"change"};this.focus=function(t){var r=(new n.Box3).setFromObject(t);e.lookAt(f.copy(r.getCenter())),c.dispatchEvent(b)},this.pan=function(t){var r=e.position.distanceTo(f);t.multiplyScalar(r*c.panSpeed),t.applyMatrix3(m.getNormalMatrix(e.matrix)),e.position.add(t),f.add(t),c.dispatchEvent(b)},this.zoom=function(t){var r=e.position.distanceTo(f);t.multiplyScalar(r*c.zoomSpeed),t.length()>r||(t.applyMatrix3(m.getNormalMatrix(e.matrix)),e.position.add(t),c.dispatchEvent(b))},this.rotate=function(t){h.copy(e.position).sub(f),y.setFromVector3(h),y.theta+=t.x,y.phi+=t.y,y.makeSafe(),h.setFromSpherical(y),e.position.copy(f).add(h),e.lookAt(f),c.dispatchEvent(b)},this.dispose=function(){t.removeEventListener("contextmenu",s,!1),t.removeEventListener("mousedown",r,!1),t.removeEventListener("wheel",o,!1),t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",i,!1),t.removeEventListener("mouseout",i,!1),t.removeEventListener("dblclick",i,!1),t.removeEventListener("touchstart",l,!1),t.removeEventListener("touchmove",u,!1)},t.addEventListener("contextmenu",s,!1),t.addEventListener("mousedown",r,!1),t.addEventListener("wheel",o,!1);var w=[new n.Vector3,new n.Vector3,new n.Vector3],A=[new n.Vector3,new n.Vector3,new n.Vector3],M=null;t.addEventListener("touchstart",l,!1),t.addEventListener("touchmove",u,!1)},n.EditorControls.prototype=Object.create(n.EventDispatcher.prototype),n.EditorControls.prototype.constructor=n.EditorControls,t.default=n.EditorControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.FirstPersonControls=function(e,t){function r(e){e.preventDefault()}function a(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new n.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=n.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),r=t-this.heightMin;this.autoSpeedFactor=e*(r*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var i=e*this.lookSpeed;this.activeLook||(i=0);var o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*i,this.lookVertical&&(this.lat-=this.mouseY*i*o),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=n.Math.degToRad(90-this.lat),this.theta=n.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=n.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var s=this.target,l=this.object.position;s.x=l.x+100*Math.sin(this.phi)*Math.cos(this.theta),s.y=l.y+100*Math.cos(this.phi),s.z=l.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(s)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousemove",i,!1),this.domElement.removeEventListener("mouseup",s,!1),window.removeEventListener("keydown",l,!1),window.removeEventListener("keyup",u,!1)};var i=a(this,this.onMouseMove),o=a(this,this.onMouseDown),s=a(this,this.onMouseUp),l=a(this,this.onKeyDown),u=a(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",i,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",s,!1),window.addEventListener("keydown",l,!1),window.addEventListener("keyup",u,!1),this.handleResize()},t.default=n.FirstPersonControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.FlyControls=function(e,t){function r(e,t){return function(){t.apply(e,arguments)}}function a(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.tmpQuaternion=new n.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new n.Vector3(0,0,0),this.rotationVector=new n.Vector3(0,0,0),this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),r=t.size[0]/2,a=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-a)/a,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a,!1),this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousemove",i,!1),this.domElement.removeEventListener("mouseup",s,!1),window.removeEventListener("keydown",l,!1),window.removeEventListener("keyup",u,!1)};var i=r(this,this.mousemove),o=r(this,this.mousedown),s=r(this,this.mouseup),l=r(this,this.keydown),u=r(this,this.keyup);this.domElement.addEventListener("contextmenu",a,!1),this.domElement.addEventListener("mousemove",i,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",s,!1),window.addEventListener("keydown",l,!1),window.addEventListener("keyup",u,!1),this.updateMovementVector(),this.updateRotationVector()},t.default=n.FlyControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*P.autoRotateSpeed}function a(){return Math.pow(.95,P.zoomSpeed)}function i(e){G.theta-=e}function o(e){G.phi-=e}function s(e){P.object.isPerspectiveCamera?z/=e:P.object.isOrthographicCamera?(P.object.zoom=Math.max(P.minZoom,Math.min(P.maxZoom,P.object.zoom*e)),P.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),P.enableZoom=!1)}function l(e){P.object.isPerspectiveCamera?z*=e:P.object.isOrthographicCamera?(P.object.zoom=Math.max(P.minZoom,Math.min(P.maxZoom,P.object.zoom/e)),P.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),P.enableZoom=!1)}function u(e){X.set(e.clientX,e.clientY)}function c(e){J.set(e.clientX,e.clientY)}function h(e){Q.set(e.clientX,e.clientY)}function d(e){W.set(e.clientX,e.clientY),K.subVectors(W,X);var t=P.domElement===document?P.domElement.body:P.domElement;i(2*Math.PI*K.x/t.clientWidth*P.rotateSpeed),o(2*Math.PI*K.y/t.clientHeight*P.rotateSpeed),X.copy(W),P.update()}function p(e){$.set(e.clientX,e.clientY),ee.subVectors($,J),ee.y>0?s(a()):ee.y<0&&l(a()),J.copy($),P.update()}function f(e){Z.set(e.clientX,e.clientY),q.subVectors(Z,Q),ae(q.x,q.y),Q.copy(Z),P.update()}function m(e){}function v(e){e.deltaY<0?l(a()):e.deltaY>0&&s(a()),P.update()}function g(e){switch(e.keyCode){case P.keys.UP:ae(0,P.keyPanSpeed),P.update();break;case P.keys.BOTTOM:ae(0,-P.keyPanSpeed),P.update();break;case P.keys.LEFT:ae(P.keyPanSpeed,0),P.update();break;case P.keys.RIGHT:ae(-P.keyPanSpeed,0),P.update()}}function y(e){X.set(e.touches[0].pageX,e.touches[0].pageY)}function b(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);J.set(0,a)}function w(e){Q.set(e.touches[0].pageX,e.touches[0].pageY)}function A(e){W.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(W,X);var t=P.domElement===document?P.domElement.body:P.domElement;i(2*Math.PI*K.x/t.clientWidth*P.rotateSpeed),o(2*Math.PI*K.y/t.clientHeight*P.rotateSpeed),X.copy(W),P.update()}function M(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);$.set(0,n),ee.subVectors($,J),ee.y>0?l(a()):ee.y<0&&s(a()),J.copy($),P.update()}function x(e){Z.set(e.touches[0].pageX,e.touches[0].pageY),q.subVectors(Z,Q),ae(q.x,q.y),Q.copy(Z),P.update()}function L(e){}function E(e){if(!1!==P.enabled){switch(e.preventDefault(),e.button){case P.mouseButtons.ORBIT:if(!1===P.enableRotate)return;u(e),V=D.ROTATE;break;case P.mouseButtons.ZOOM:if(!1===P.enableZoom)return;c(e),V=D.DOLLY;break;case P.mouseButtons.PAN:if(!1===P.enablePan)return;h(e),V=D.PAN}V!==D.NONE&&(document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",k,!1),P.dispatchEvent(I))}}function T(e){if(!1!==P.enabled)switch(e.preventDefault(),V){case D.ROTATE:if(!1===P.enableRotate)return;d(e);break;case D.DOLLY:if(!1===P.enableZoom)return;p(e);break;case D.PAN:if(!1===P.enablePan)return;f(e)}}function k(e){!1!==P.enabled&&(m(e),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",k,!1),P.dispatchEvent(B),V=D.NONE)}function _(e){!1===P.enabled||!1===P.enableZoom||V!==D.NONE&&V!==D.ROTATE||(e.preventDefault(),e.stopPropagation(),P.dispatchEvent(I),v(e),P.dispatchEvent(B))}function N(e){!1!==P.enabled&&!1!==P.enableKeys&&!1!==P.enablePan&&g(e)}function C(e){if(!1!==P.enabled){switch(e.touches.length){case 1:if(!1===P.enableRotate)return;y(e),V=D.TOUCH_ROTATE;break;case 2:if(!1===P.enableZoom)return;b(e),V=D.TOUCH_DOLLY;break;case 3:if(!1===P.enablePan)return;w(e),V=D.TOUCH_PAN;break;default:V=D.NONE}V!==D.NONE&&P.dispatchEvent(I)}}function S(e){if(!1!==P.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===P.enableRotate)return;if(V!==D.TOUCH_ROTATE)return;A(e);break;case 2:if(!1===P.enableZoom)return;if(V!==D.TOUCH_DOLLY)return;M(e);break;case 3:if(!1===P.enablePan)return;if(V!==D.TOUCH_PAN)return;x(e);break;default:V=D.NONE}}function O(e){!1!==P.enabled&&(L(e),P.dispatchEvent(B),V=D.NONE)}function F(e){!1!==P.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new n.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:n.MOUSE.LEFT,ZOOM:n.MOUSE.MIDDLE,PAN:n.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return U.phi},this.getAzimuthalAngle=function(){return U.theta},this.saveState=function(){P.target0.copy(P.target),P.position0.copy(P.object.position),P.zoom0=P.object.zoom},this.reset=function(){P.target.copy(P.target0),P.object.position.copy(P.position0),P.object.zoom=P.zoom0,P.object.updateProjectionMatrix(),P.dispatchEvent(R),P.update(),V=D.NONE},this.update=function(){var t=new n.Vector3,a=(new n.Quaternion).setFromUnitVectors(e.up,new n.Vector3(0,1,0)),o=a.clone().inverse(),s=new n.Vector3,l=new n.Quaternion;return function(){var e=P.object.position;return t.copy(e).sub(P.target),t.applyQuaternion(a),U.setFromVector3(t),P.autoRotate&&V===D.NONE&&i(r()),U.theta+=G.theta,U.phi+=G.phi,U.theta=Math.max(P.minAzimuthAngle,Math.min(P.maxAzimuthAngle,U.theta)),U.phi=Math.max(P.minPolarAngle,Math.min(P.maxPolarAngle,U.phi)),U.makeSafe(),U.radius*=z,U.radius=Math.max(P.minDistance,Math.min(P.maxDistance,U.radius)),P.target.add(H),t.setFromSpherical(U),t.applyQuaternion(o),e.copy(P.target).add(t),P.object.lookAt(P.target),!0===P.enableDamping?(G.theta*=1-P.dampingFactor,G.phi*=1-P.dampingFactor):G.set(0,0,0),z=1,H.set(0,0,0),!!(Y||s.distanceToSquared(P.object.position)>j||8*(1-l.dot(P.object.quaternion))>j)&&(P.dispatchEvent(R),s.copy(P.object.position),l.copy(P.object.quaternion),Y=!1,!0)}}(),this.dispose=function(){P.domElement.removeEventListener("contextmenu",F,!1),P.domElement.removeEventListener("mousedown",E,!1),P.domElement.removeEventListener("wheel",_,!1),P.domElement.removeEventListener("touchstart",C,!1),P.domElement.removeEventListener("touchend",O,!1),P.domElement.removeEventListener("touchmove",S,!1),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",k,!1),window.removeEventListener("keydown",N,!1)};var P=this,R={type:"change"},I={type:"start"},B={type:"end"},D={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=D.NONE,j=1e-6,U=new n.Spherical,G=new n.Spherical,z=1,H=new n.Vector3,Y=!1,X=new n.Vector2,W=new n.Vector2,K=new n.Vector2,Q=new n.Vector2,Z=new n.Vector2,q=new n.Vector2,J=new n.Vector2,$=new n.Vector2,ee=new n.Vector2,te=function(){var e=new n.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),H.add(e)}}(),re=function(){var e=new n.Vector3;return function(t,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(t),H.add(e)}}(),ae=function(){var e=new n.Vector3;return function(t,r){var a=P.domElement===document?P.domElement.body:P.domElement;if(P.object.isPerspectiveCamera){var n=P.object.position;e.copy(n).sub(P.target);var i=e.length();i*=Math.tan(P.object.fov/2*Math.PI/180),te(2*t*i/a.clientHeight,P.object.matrix),re(2*r*i/a.clientHeight,P.object.matrix)}else P.object.isOrthographicCamera?(te(t*(P.object.right-P.object.left)/P.object.zoom/a.clientWidth,P.object.matrix),re(r*(P.object.top-P.object.bottom)/P.object.zoom/a.clientHeight,P.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),P.enablePan=!1)}}();P.domElement.addEventListener("contextmenu",F,!1),P.domElement.addEventListener("mousedown",E,!1),P.domElement.addEventListener("wheel",_,!1),P.domElement.addEventListener("touchstart",C,!1),P.domElement.addEventListener("touchend",O,!1),P.domElement.addEventListener("touchmove",S,!1),window.addEventListener("keydown",N,!1),this.update()},n.OrbitControls.prototype=Object.create(n.EventDispatcher.prototype),n.OrbitControls.prototype.constructor=n.OrbitControls,Object.defineProperties(n.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),t.default=n.OrbitControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.OrthographicTrackballControls=function(e,t){function r(e){!1!==p.enabled&&(window.removeEventListener("keydown",r),g=v,v===f.NONE&&(e.keyCode!==p.keys[f.ROTATE]||p.noRotate?e.keyCode!==p.keys[f.ZOOM]||p.noZoom?e.keyCode!==p.keys[f.PAN]||p.noPan||(v=f.PAN):v=f.ZOOM:v=f.ROTATE))}function a(e){!1!==p.enabled&&(v=g,window.addEventListener("keydown",r,!1))}function i(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v===f.NONE&&(v=e.button),v!==f.ROTATE||p.noRotate?v!==f.ZOOM||p.noZoom?v!==f.PAN||p.noPan||(E.copy(C(e.pageX,e.pageY)),T.copy(E)):(A.copy(C(e.pageX,e.pageY)),M.copy(A)):(b.copy(S(e.pageX,e.pageY)),w.copy(b)),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",s,!1),p.dispatchEvent(_))}function o(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v!==f.ROTATE||p.noRotate?v!==f.ZOOM||p.noZoom?v!==f.PAN||p.noPan||T.copy(C(e.pageX,e.pageY)):M.copy(C(e.pageX,e.pageY)):w.copy(S(e.pageX,e.pageY)))}function s(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v=f.NONE,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s),p.dispatchEvent(N))}function l(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),A.y+=.01*e.deltaY,p.dispatchEvent(_),p.dispatchEvent(N))}function u(e){if(!1!==p.enabled){switch(e.touches.length){case 1:v=f.TOUCH_ROTATE,b.copy(S(e.touches[0].pageX,e.touches[0].pageY)),w.copy(b);break;case 2:v=f.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;L=x=Math.sqrt(t*t+r*r);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;E.copy(C(a,n)),T.copy(E);break;default:v=f.NONE}p.dispatchEvent(_)}}function c(e){if(!1!==p.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w.copy(S(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;L=Math.sqrt(t*t+r*r);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;T.copy(C(a,n));break;default:v=f.NONE}}function h(e){if(!1!==p.enabled){switch(e.touches.length){case 1:w.copy(S(e.touches[0].pageX,e.touches[0].pageY)),b.copy(w);break;case 2:x=L=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;T.copy(C(t,r)),E.copy(T)}v=f.NONE,p.dispatchEvent(N)}}function d(e){e.preventDefault()}var p=this,f={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new n.Vector3;var m=!0,v=f.NONE,g=f.NONE,y=new n.Vector3,b=new n.Vector3,w=new n.Vector3,A=new n.Vector2,M=new n.Vector2,x=0,L=0,E=new n.Vector2,T=new n.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var k={type:"change"},_={type:"start"},N={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var C=function(){var e=new n.Vector2;return function(t,r){return e.set((t-p.screen.left)/p.screen.width,(r-p.screen.top)/p.screen.height),e}}(),S=function(){var e=new n.Vector3,t=new n.Vector3,r=new n.Vector3;return function(a,n){r.set((a-.5*p.screen.width-p.screen.left)/p.radius,(.5*p.screen.height+p.screen.top-n)/p.radius,0);var i=r.length();return p.noRoll?i<Math.SQRT1_2?r.z=Math.sqrt(1-i*i):r.z=.5/i:i>1?r.normalize():r.z=Math.sqrt(1-i*i),y.copy(p.object.position).sub(p.target),e.copy(p.object.up).setLength(r.y),e.add(t.copy(p.object.up).cross(y).setLength(r.x)),e.add(y.setLength(r.z)),e}}();this.rotateCamera=function(){var e=new n.Vector3,t=new n.Quaternion;return function(){var r=Math.acos(b.dot(w)/b.length()/w.length());r&&(e.crossVectors(b,w).normalize(),r*=p.rotateSpeed,t.setFromAxisAngle(e,-r),y.applyQuaternion(t),p.object.up.applyQuaternion(t),w.applyQuaternion(t),p.staticMoving?b.copy(w):(t.setFromAxisAngle(e,r*(p.dynamicDampingFactor-1)),b.applyQuaternion(t)),m=!0)}}(),this.zoomCamera=function(){if(v===f.TOUCH_ZOOM_PAN){var e=L/x;x=L,p.object.zoom*=e,m=!0}else{var e=1+(M.y-A.y)*p.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(p.object.zoom/=e,p.staticMoving?A.copy(M):A.y+=(M.y-A.y)*this.dynamicDampingFactor,m=!0)}},this.panCamera=function(){var e=new n.Vector2,t=new n.Vector3,r=new n.Vector3;return function(){if(e.copy(T).sub(E),e.lengthSq()){var a=(p.object.right-p.object.left)/p.object.zoom,n=(p.object.top-p.object.bottom)/p.object.zoom;e.x*=a,e.y*=n,r.copy(y).cross(p.object.up).setLength(e.x),r.add(t.copy(p.object.up).setLength(e.y)),p.object.position.add(r),p.target.add(r),p.staticMoving?E.copy(T):E.add(e.subVectors(T,E).multiplyScalar(p.dynamicDampingFactor)),m=!0}}}(),this.update=function(){y.subVectors(p.object.position,p.target),p.noRotate||p.rotateCamera(),p.noZoom||(p.zoomCamera(),m&&p.object.updateProjectionMatrix()),p.noPan||p.panCamera(),p.object.position.addVectors(p.target,y),p.object.lookAt(p.target),m&&(p.dispatchEvent(k),m=!1)},this.reset=function(){v=f.NONE,g=f.NONE,p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.up.copy(p.up0),y.subVectors(p.object.position,p.target),p.object.left=p.left0,p.object.right=p.right0,p.object.top=p.top0,p.object.bottom=p.bottom0,p.object.lookAt(p.target),p.dispatchEvent(k),m=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",i,!1),this.domElement.removeEventListener("wheel",l,!1),this.domElement.removeEventListener("touchstart",u,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",c,!1),document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",s,!1),window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",a,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("wheel",l,!1),this.domElement.addEventListener("touchstart",u,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",c,!1),window.addEventListener("keydown",r,!1),window.addEventListener("keyup",a,!1),this.handleResize(),this.update()},n.OrthographicTrackballControls.prototype=Object.create(n.EventDispatcher.prototype),n.OrthographicTrackballControls.prototype.constructor=n.OrthographicTrackballControls,t.default=n.OrthographicTrackballControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PointerLockControls=function(e){var t=this;e.rotation.set(0,0,0);var r=new n.Object3D;r.add(e);var a=new n.Object3D;a.position.y=10,a.add(r);var i=Math.PI/2,o=function(e){if(!1!==t.enabled){var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0;a.rotation.y-=.002*n,r.rotation.x-=.002*o,r.rotation.x=Math.max(-i,Math.min(i,r.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",o,!1)},document.addEventListener("mousemove",o,!1),this.enabled=!1,this.getObject=function(){return a},this.getDirection=function(){var e=new n.Vector3(0,0,-1),t=new n.Euler(0,0,0,"YXZ");return function(n){return t.set(r.rotation.x,a.rotation.y,0),n.copy(e).applyEuler(t),n}}()},t.default=n.PointerLockControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.TrackballControls=function(e,t){function r(e){!1!==p.enabled&&(window.removeEventListener("keydown",r),g=v,v===f.NONE&&(e.keyCode!==p.keys[f.ROTATE]||p.noRotate?e.keyCode!==p.keys[f.ZOOM]||p.noZoom?e.keyCode!==p.keys[f.PAN]||p.noPan||(v=f.PAN):v=f.ZOOM:v=f.ROTATE))}function a(e){!1!==p.enabled&&(v=g,window.addEventListener("keydown",r,!1))}function i(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v===f.NONE&&(v=e.button),v!==f.ROTATE||p.noRotate?v!==f.ZOOM||p.noZoom?v!==f.PAN||p.noPan||(k.copy(O(e.pageX,e.pageY)),_.copy(k)):(x.copy(O(e.pageX,e.pageY)),L.copy(x)):(w.copy(F(e.pageX,e.pageY)),b.copy(w)),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",s,!1),p.dispatchEvent(C))}function o(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v!==f.ROTATE||p.noRotate?v!==f.ZOOM||p.noZoom?v!==f.PAN||p.noPan||_.copy(O(e.pageX,e.pageY)):L.copy(O(e.pageX,e.pageY)):(b.copy(w),w.copy(F(e.pageX,e.pageY))))}function s(e){!1!==p.enabled&&(e.preventDefault(),e.stopPropagation(),v=f.NONE,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s),p.dispatchEvent(S))}function l(e){if(!1!==p.enabled){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:x.y-=.025*e.deltaY;break;case 1:x.y-=.01*e.deltaY;break;default:x.y-=25e-5*e.deltaY}p.dispatchEvent(C),p.dispatchEvent(S)}}function u(e){if(!1!==p.enabled){switch(e.touches.length){case 1:v=f.TOUCH_ROTATE,w.copy(F(e.touches[0].pageX,e.touches[0].pageY)),b.copy(w);break;default:v=f.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;T=E=Math.sqrt(t*t+r*r);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;k.copy(O(a,n)),_.copy(k)}p.dispatchEvent(C)}}function c(e){if(!1!==p.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:b.copy(w),w.copy(F(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;T=Math.sqrt(t*t+r*r);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;_.copy(O(a,n))}}function h(e){if(!1!==p.enabled){switch(e.touches.length){case 0:v=f.NONE;break;case 1:v=f.TOUCH_ROTATE,w.copy(F(e.touches[0].pageX,e.touches[0].pageY)),b.copy(w)}p.dispatchEvent(S)}}function d(e){!1!==p.enabled&&e.preventDefault()}var p=this,f={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new n.Vector3;var m=new n.Vector3,v=f.NONE,g=f.NONE,y=new n.Vector3,b=new n.Vector2,w=new n.Vector2,A=new n.Vector3,M=0,x=new n.Vector2,L=new n.Vector2,E=0,T=0,k=new n.Vector2,_=new n.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var N={type:"change"},C={type:"start"},S={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var O=function(){var e=new n.Vector2;return function(t,r){return e.set((t-p.screen.left)/p.screen.width,(r-p.screen.top)/p.screen.height),e}}(),F=function(){var e=new n.Vector2;return function(t,r){return e.set((t-.5*p.screen.width-p.screen.left)/(.5*p.screen.width),(p.screen.height+2*(p.screen.top-r))/p.screen.width),e}}();this.rotateCamera=function(){var e,t=new n.Vector3,r=new n.Quaternion,a=new n.Vector3,i=new n.Vector3,o=new n.Vector3,s=new n.Vector3;return function(){s.set(w.x-b.x,w.y-b.y,0),e=s.length(),e?(y.copy(p.object.position).sub(p.target),a.copy(y).normalize(),i.copy(p.object.up).normalize(),o.crossVectors(i,a).normalize(),i.setLength(w.y-b.y),o.setLength(w.x-b.x),s.copy(i.add(o)),t.crossVectors(s,y).normalize(),e*=p.rotateSpeed,r.setFromAxisAngle(t,e),y.applyQuaternion(r),p.object.up.applyQuaternion(r),A.copy(t),M=e):!p.staticMoving&&M&&(M*=Math.sqrt(1-p.dynamicDampingFactor),y.copy(p.object.position).sub(p.target),r.setFromAxisAngle(A,M),y.applyQuaternion(r),p.object.up.applyQuaternion(r)),b.copy(w)}}(),this.zoomCamera=function(){var e;v===f.TOUCH_ZOOM_PAN?(e=E/T,E=T,y.multiplyScalar(e)):(e=1+(L.y-x.y)*p.zoomSpeed,1!==e&&e>0&&y.multiplyScalar(e),p.staticMoving?x.copy(L):x.y+=(L.y-x.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new n.Vector2,t=new n.Vector3,r=new n.Vector3;return function(){e.copy(_).sub(k),e.lengthSq()&&(e.multiplyScalar(y.length()*p.panSpeed),r.copy(y).cross(p.object.up).setLength(e.x),r.add(t.copy(p.object.up).setLength(e.y)),p.object.position.add(r),p.target.add(r),p.staticMoving?k.copy(_):k.add(e.subVectors(_,k).multiplyScalar(p.dynamicDampingFactor)))}}(),this.checkDistances=function(){p.noZoom&&p.noPan||(y.lengthSq()>p.maxDistance*p.maxDistance&&(p.object.position.addVectors(p.target,y.setLength(p.maxDistance)),x.copy(L)),y.lengthSq()<p.minDistance*p.minDistance&&(p.object.position.addVectors(p.target,y.setLength(p.minDistance)),x.copy(L)))},this.update=function(){y.subVectors(p.object.position,p.target),p.noRotate||p.rotateCamera(),p.noZoom||p.zoomCamera(),p.noPan||p.panCamera(),p.object.position.addVectors(p.target,y),p.checkDistances(),p.object.lookAt(p.target),m.distanceToSquared(p.object.position)>1e-6&&(p.dispatchEvent(N),m.copy(p.object.position))},this.reset=function(){v=f.NONE,g=f.NONE,p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.up.copy(p.up0),y.subVectors(p.object.position,p.target),p.object.lookAt(p.target),p.dispatchEvent(N),m.copy(p.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",i,!1),this.domElement.removeEventListener("wheel",l,!1),this.domElement.removeEventListener("touchstart",u,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",c,!1),document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",s,!1),window.removeEventListener("keydown",r,!1),window.removeEventListener("keyup",a,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("wheel",l,!1),this.domElement.addEventListener("touchstart",u,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",c,!1),window.addEventListener("keydown",r,!1),window.addEventListener("keyup",a,!1),this.handleResize(),this.update()},n.TrackballControls.prototype=Object.create(n.EventDispatcher.prototype),n.TrackballControls.prototype.constructor=n.TrackballControls,t.default=n.TrackballControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);!function(){var e=function(e){n.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=n.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(n.MeshBasicMaterial.prototype),e.prototype.constructor=e;var t=function(e){n.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(n.LineBasicMaterial.prototype),t.prototype.constructor=t;var r=new e({visible:!1,transparent:!1});n.TransformGizmo=function(){this.init=function(){n.Object3D.call(this),this.handles=new n.Object3D,this.pickers=new n.Object3D,this.planes=new n.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new n.PlaneBufferGeometry(50,50,2,2),t=new n.MeshBasicMaterial({visible:!1,side:n.DoubleSide}),r={XY:new n.Mesh(e,t),YZ:new n.Mesh(e,t),XZ:new n.Mesh(e,t),XYZE:new n.Mesh(e,t)};this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0);for(var a in r)r[a].name=a,this.planes.add(r[a]),this.planes[a]=r[a];var i=function(e,t){for(var r in e)for(a=e[r].length;a--;){var n=e[r][a][0],i=e[r][a][1],o=e[r][a][2];n.name=r,i&&n.position.set(i[0],i[1],i[2]),o&&n.rotation.set(o[0],o[1],o[2]),t.add(n)}};i(this.handleGizmos,this.handles),i(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof n.Mesh){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}},n.TransformGizmo.prototype=Object.create(n.Object3D.prototype),n.TransformGizmo.prototype.constructor=n.TransformGizmo,n.TransformGizmo.prototype.update=function(e,t){var r=new n.Vector3(0,0,0),a=new n.Vector3(0,1,0),i=new n.Matrix4;this.traverse(function(n){-1!==n.name.search("E")?n.quaternion.setFromRotationMatrix(i.lookAt(t,r,a)):-1===n.name.search("X")&&-1===n.name.search("Y")&&-1===n.name.search("Z")||n.quaternion.setFromEuler(e)})},n.TransformGizmoTranslate=function(){n.TransformGizmo.call(this);var a=new n.Geometry,i=new n.Mesh(new n.CylinderGeometry(0,.05,.2,12,1,!1));i.position.y=.5,i.updateMatrix(),a.merge(i.geometry,i.matrix);var o=new n.BufferGeometry;o.addAttribute("position",new n.Float32BufferAttribute([0,0,0,1,0,0],3));var s=new n.BufferGeometry;s.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,1,0],3));var l=new n.BufferGeometry;l.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new n.Mesh(a,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new n.Line(o,new t({color:16711680}))]],Y:[[new n.Mesh(a,new e({color:65280})),[0,.5,0]],[new n.Line(s,new t({color:65280}))]],Z:[[new n.Mesh(a,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new n.Line(l,new t({color:255}))]],XYZ:[[new n.Mesh(new n.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.OctahedronGeometry(.2,0),r)]],XY:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var r=new n.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()},n.TransformGizmoTranslate.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoTranslate.prototype.constructor=n.TransformGizmoTranslate,n.TransformGizmoRotate=function(){n.TransformGizmo.call(this);var e=function(e,t,r){var a=new n.BufferGeometry,i=[];r=r||1;for(var o=0;o<=64*r;++o)"x"===t&&i.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e),"y"===t&&i.push(Math.cos(o/32*Math.PI)*e,0,Math.sin(o/32*Math.PI)*e),"z"===t&&i.push(Math.sin(o/32*Math.PI)*e,Math.cos(o/32*Math.PI)*e,0);return a.addAttribute("position",new n.Float32BufferAttribute(i,3)),a};this.handleGizmos={X:[[new n.Line(new e(1,"x",.5),new t({color:16711680}))]],Y:[[new n.Line(new e(1,"y",.5),new t({color:65280}))]],Z:[[new n.Line(new e(1,"z",.5),new t({color:255}))]],E:[[new n.Line(new e(1.25,"z",1),new t({color:13421568}))]],XYZE:[[new n.Line(new e(1,"z",1),new t({color:7895160}))]]},this.pickerGizmos={X:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n.Mesh(new n.TorusBufferGeometry(1.25,.12,2,24),r)]],XYZE:[[new n.Mesh]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){n.TransformGizmo.prototype.update.apply(this,arguments);var r=new n.Matrix4,a=new n.Euler(0,0,1),i=new n.Quaternion,o=new n.Vector3(1,0,0),s=new n.Vector3(0,1,0),l=new n.Vector3(0,0,1),u=new n.Quaternion,c=new n.Quaternion,h=new n.Quaternion,d=t.clone();a.copy(this.planes.XY.rotation),i.setFromEuler(a),r.makeRotationFromQuaternion(i).getInverse(r),d.applyMatrix4(r),this.traverse(function(e){i.setFromEuler(a),"X"===e.name&&(u.setFromAxisAngle(o,Math.atan2(-d.y,d.z)),i.multiplyQuaternions(i,u),e.quaternion.copy(i)),"Y"===e.name&&(c.setFromAxisAngle(s,Math.atan2(d.x,d.z)),i.multiplyQuaternions(i,c),e.quaternion.copy(i)),"Z"===e.name&&(h.setFromAxisAngle(l,Math.atan2(d.y,d.x)),i.multiplyQuaternions(i,h),e.quaternion.copy(i))})},this.init()},n.TransformGizmoRotate.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoRotate.prototype.constructor=n.TransformGizmoRotate,n.TransformGizmoScale=function(){n.TransformGizmo.call(this);var a=new n.Geometry,i=new n.Mesh(new n.BoxGeometry(.125,.125,.125));i.position.y=.5,i.updateMatrix(),a.merge(i.geometry,i.matrix);var o=new n.BufferGeometry;o.addAttribute("position",new n.Float32BufferAttribute([0,0,0,1,0,0],3));var s=new n.BufferGeometry;s.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,1,0],3));var l=new n.BufferGeometry;l.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new n.Mesh(a,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new n.Line(o,new t({color:16711680}))]],Y:[[new n.Mesh(a,new e({color:65280})),[0,.5,0]],[new n.Line(s,new t({color:65280}))]],Z:[[new n.Mesh(a,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new n.Line(l,new t({color:255}))]],XYZ:[[new n.Mesh(new n.BoxBufferGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.BoxBufferGeometry(.4,.4,.4),r)]]},this.setActivePlane=function(e,t){var r=new n.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()},n.TransformGizmoScale.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoScale.prototype.constructor=n.TransformGizmoScale,n.TransformControls=function(e,t){function r(e){if(void 0!==l.object&&!0!==c&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e,r=s(t,h[u].pickers.children),a=null;r&&(a=r.object.name,e.preventDefault()),l.axis!==a&&(l.axis=a,l.update(),l.dispatchEvent(f))}}function a(e){if(void 0!==l.object&&!0!==c&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var r=s(t,h[u].pickers.children);if(r){e.preventDefault(),e.stopPropagation(),l.dispatchEvent(m),l.axis=r.object.name,l.update(),T.copy(X).sub(z).normalize(),h[u].setActivePlane(l.axis,T);var a=s(t,[h[u].activePlane]);a&&(D.copy(l.object.position),V.copy(l.object.scale),j.extractRotation(l.object.matrix),Y.extractRotation(l.object.matrixWorld),U.extractRotation(l.object.parent.matrixWorld),G.setFromMatrixScale(k.getInverse(l.object.parent.matrixWorld)),A.copy(a.point))}}c=!0}}function i(e){if(void 0!==l.object&&null!==l.axis&&!1!==c&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e,r=s(t,[h[u].activePlane]);!1!==r&&(e.preventDefault(),e.stopPropagation(),w.copy(r.point),"translate"===u?(w.sub(A),w.multiply(G),"local"===l.space&&(w.applyMatrix4(k.getInverse(Y)),-1===l.axis.search("X")&&(w.x=0),-1===l.axis.search("Y")&&(w.y=0),-1===l.axis.search("Z")&&(w.z=0),w.applyMatrix4(j),l.object.position.copy(D),l.object.position.add(w)),"world"!==l.space&&-1===l.axis.search("XYZ")||(-1===l.axis.search("X")&&(w.x=0),-1===l.axis.search("Y")&&(w.y=0),-1===l.axis.search("Z")&&(w.z=0),w.applyMatrix4(k.getInverse(U)),l.object.position.copy(D),l.object.position.add(w)),null!==l.translationSnap&&("local"===l.space&&l.object.position.applyMatrix4(k.getInverse(Y)),-1!==l.axis.search("X")&&(l.object.position.x=Math.round(l.object.position.x/l.translationSnap)*l.translationSnap),-1!==l.axis.search("Y")&&(l.object.position.y=Math.round(l.object.position.y/l.translationSnap)*l.translationSnap),-1!==l.axis.search("Z")&&(l.object.position.z=Math.round(l.object.position.z/l.translationSnap)*l.translationSnap),"local"===l.space&&l.object.position.applyMatrix4(Y))):"scale"===u?(w.sub(A),w.multiply(G),"local"===l.space&&("XYZ"===l.axis?(L=1+w.y/Math.max(V.x,V.y,V.z),l.object.scale.x=V.x*L,l.object.scale.y=V.y*L,l.object.scale.z=V.z*L):(w.applyMatrix4(k.getInverse(Y)),"X"===l.axis&&(l.object.scale.x=V.x*(1+w.x/V.x)),"Y"===l.axis&&(l.object.scale.y=V.y*(1+w.y/V.y)),"Z"===l.axis&&(l.object.scale.z=V.z*(1+w.z/V.z))))):"rotate"===u&&(w.sub(z),w.multiply(G),_.copy(A).sub(z),_.multiply(G),"E"===l.axis?(w.applyMatrix4(k.getInverse(E)),_.applyMatrix4(k.getInverse(E)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),x.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),N.setFromRotationMatrix(k.getInverse(U)),B.setFromAxisAngle(T,M.z-x.z),F.setFromRotationMatrix(Y),N.multiplyQuaternions(N,B),N.multiplyQuaternions(N,F),l.object.quaternion.copy(N)):"XYZE"===l.axis?(B.setFromEuler(w.clone().cross(_).normalize()),N.setFromRotationMatrix(k.getInverse(U)),P.setFromAxisAngle(B,-w.clone().angleTo(_)),F.setFromRotationMatrix(Y),N.multiplyQuaternions(N,P),N.multiplyQuaternions(N,F),l.object.quaternion.copy(N)):"local"===l.space?(w.applyMatrix4(k.getInverse(Y)),_.applyMatrix4(k.getInverse(Y)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),x.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),F.setFromRotationMatrix(j),null!==l.rotationSnap?(P.setFromAxisAngle(C,Math.round((M.x-x.x)/l.rotationSnap)*l.rotationSnap),R.setFromAxisAngle(S,Math.round((M.y-x.y)/l.rotationSnap)*l.rotationSnap),I.setFromAxisAngle(O,Math.round((M.z-x.z)/l.rotationSnap)*l.rotationSnap)):(P.setFromAxisAngle(C,M.x-x.x),R.setFromAxisAngle(S,M.y-x.y),I.setFromAxisAngle(O,M.z-x.z)),"X"===l.axis&&F.multiplyQuaternions(F,P),"Y"===l.axis&&F.multiplyQuaternions(F,R),"Z"===l.axis&&F.multiplyQuaternions(F,I),l.object.quaternion.copy(F)):"world"===l.space&&(M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),x.set(Math.atan2(_.z,_.y),Math.atan2(_.x,_.z),Math.atan2(_.y,_.x)),N.setFromRotationMatrix(k.getInverse(U)),null!==l.rotationSnap?(P.setFromAxisAngle(C,Math.round((M.x-x.x)/l.rotationSnap)*l.rotationSnap),R.setFromAxisAngle(S,Math.round((M.y-x.y)/l.rotationSnap)*l.rotationSnap),I.setFromAxisAngle(O,Math.round((M.z-x.z)/l.rotationSnap)*l.rotationSnap)):(P.setFromAxisAngle(C,M.x-x.x),R.setFromAxisAngle(S,M.y-x.y),I.setFromAxisAngle(O,M.z-x.z)),F.setFromRotationMatrix(Y),"X"===l.axis&&N.multiplyQuaternions(N,P),"Y"===l.axis&&N.multiplyQuaternions(N,R),"Z"===l.axis&&N.multiplyQuaternions(N,I),N.multiplyQuaternions(N,F),l.object.quaternion.copy(N))),l.update(),l.dispatchEvent(f),l.dispatchEvent(g))}}function o(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(c&&null!==l.axis&&(v.mode=u,l.dispatchEvent(v)),c=!1,"TouchEvent"in window&&e instanceof TouchEvent?(l.axis=null,l.update(),l.dispatchEvent(f)):r(e))}function s(r,a){var n=t.getBoundingClientRect(),i=(r.clientX-n.left)/n.width,o=(r.clientY-n.top)/n.height;b.set(2*i-1,-2*o+1),y.setFromCamera(b,e);var s=y.intersectObjects(a,!0);return!!s[0]&&s[0]}n.Object3D.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var l=this,u="translate",c=!1,h={translate:new n.TransformGizmoTranslate,rotate:new n.TransformGizmoRotate,scale:new n.TransformGizmoScale};for(var d in h){var p=h[d];p.visible=d===u,this.add(p)}var f={type:"change"},m={type:"mouseDown"},v={type:"mouseUp",mode:u},g={type:"objectChange"},y=new n.Raycaster,b=new n.Vector2,w=new n.Vector3,A=new n.Vector3,M=new n.Vector3,x=new n.Vector3,L=1,E=new n.Matrix4,T=new n.Vector3,k=new n.Matrix4,_=new n.Vector3,N=new n.Quaternion,C=new n.Vector3(1,0,0),S=new n.Vector3(0,1,0),O=new n.Vector3(0,0,1),F=new n.Quaternion,P=new n.Quaternion,R=new n.Quaternion,I=new n.Quaternion,B=new n.Quaternion,D=new n.Vector3,V=new n.Vector3,j=new n.Matrix4,U=new n.Matrix4,G=new n.Vector3,z=new n.Vector3,H=new n.Euler,Y=new n.Matrix4,X=new n.Vector3,W=new n.Euler;t.addEventListener("mousedown",a,!1),t.addEventListener("touchstart",a,!1),t.addEventListener("mousemove",r,!1),t.addEventListener("touchmove",r,!1),t.addEventListener("mousemove",i,!1),t.addEventListener("touchmove",i,!1),t.addEventListener("mouseup",o,!1),t.addEventListener("mouseout",o,!1),t.addEventListener("touchend",o,!1),t.addEventListener("touchcancel",o,!1),t.addEventListener("touchleave",o,!1),this.dispose=function(){t.removeEventListener("mousedown",a),t.removeEventListener("touchstart",a),t.removeEventListener("mousemove",r),t.removeEventListener("touchmove",r),t.removeEventListener("mousemove",i),t.removeEventListener("touchmove",i),t.removeEventListener("mouseup",o),t.removeEventListener("mouseout",o),t.removeEventListener("touchend",o),t.removeEventListener("touchcancel",o),t.removeEventListener("touchleave",o)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return u},this.setMode=function(e){"scale"===(u=e||u)&&(l.space="local");for(var t in h)h[t].visible=t===u;this.update(),l.dispatchEvent(f)},this.setTranslationSnap=function(e){l.translationSnap=e},this.setRotationSnap=function(e){l.rotationSnap=e},this.setSize=function(e){l.size=e,this.update(),l.dispatchEvent(f)},this.setSpace=function(e){l.space=e,this.update(),l.dispatchEvent(f)},this.update=function(){void 0!==l.object&&(l.object.updateMatrixWorld(),z.setFromMatrixPosition(l.object.matrixWorld),H.setFromRotationMatrix(k.extractRotation(l.object.matrixWorld)),e.updateMatrixWorld(),X.setFromMatrixPosition(e.matrixWorld),W.setFromRotationMatrix(k.extractRotation(e.matrixWorld)),L=z.distanceTo(X)/6*l.size,this.position.copy(z),this.scale.set(L,L,L),e instanceof n.PerspectiveCamera?T.copy(X).sub(z).normalize():e instanceof n.OrthographicCamera&&T.copy(X).normalize(),"local"===l.space?h[u].update(H,T):"world"===l.space&&h[u].update(new n.Euler,T),h[u].highlight(l.axis))}},n.TransformControls.prototype=Object.create(n.Object3D.prototype),n.TransformControls.prototype.constructor=n.TransformControls}(),t.default=n.TransformControls},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.VRControls=function(e,t){function r(e){i=e,e.length>0?a=e[0]:t&&t("VR input not available.")}var a,i,o=this,s=new n.Matrix4,l=null;"VRFrameData"in window&&(l=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(r).catch(function(){console.warn("THREE.VRControls: Unable to get VR Displays")}),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return a},this.setVRDisplay=function(e){a=e},this.getVRDisplays=function(){return console.warn("THREE.VRControls: getVRDisplays() is being deprecated."),i},this.getStandingMatrix=function(){return s},this.update=function(){if(a){var t;a.getFrameData?(a.getFrameData(l),t=l.pose):a.getPose&&(t=a.getPose()),null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),this.standing&&(a.stageParameters?(e.updateMatrix(),s.fromArray(a.stageParameters.sittingToStandingTransform),e.applyMatrix(s)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(o.scale)}},this.dispose=function(){a=null}},t.default=n.VRControls},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.XLoader=t.VTKLoader=t.VRMLLoader=t.UTF8Loader=t.TTFLoader=t.TGALoader=t.TDSLoader=t.SVGLoader=t.STLLoader=t.RGBELoader=t.PVRLoader=t.PRWMLoader=t.PLYLoader=t.PlayCanvasLoader=t.PDBLoader=t.PCDLoader=t.OBJLoader2=t.OBJLoader=t.NRRDLoader=t.NodeMaterialLoader=t.MTLLoader=t.MMDLoader=t.MD2Loader=t.LoaderSupport=t.KTXLoader=t.KMZLoader=t.HDRCubeTextureLoader=t.GLTFLoader=t.GCodeLoader=t.FBXLoader=t.EXRLoader=t.DDSLoader=t.ColladaLoader=t.BVHLoader=t.BinaryLoader=t.BabylonLoader=t.AWDLoader=t.AssimpLoader=t.AssimpJSONLoader=t.AMFLoader=t.ThreeMFLoader=void 0;var n=r(15),i=a(n),o=r(16),s=a(o),l=r(17),u=a(l),c=r(18),h=a(c),d=r(19),p=a(d),f=r(20),m=a(f),v=r(21),g=a(v),y=r(22),b=a(y),w=r(23),A=a(w),M=r(24),x=a(M),L=r(25),E=a(L),T=r(26),k=a(T),_=r(27),N=a(_),C=r(28),S=a(C),O=r(29),F=a(O),P=r(30),R=a(P),I=r(31),B=a(I),D=r(32),V=a(D),j=r(33),U=a(j),G=r(34),z=a(G),H=r(35),Y=a(H),X=r(36),W=a(X),K=r(37),Q=a(K),Z=r(38),q=a(Z),J=r(39),$=a(J),ee=r(40),te=a(ee),re=r(41),ae=a(re),ne=r(42),ie=a(ne),oe=r(43),se=a(oe),le=r(44),ue=a(le),ce=r(45),he=a(ce),de=r(46),pe=a(de),fe=r(47),me=a(fe),ve=r(48),ge=a(ve),ye=r(49),be=a(ye),we=r(50),Ae=a(we),Me=r(51),xe=a(Me),Le=r(52),Ee=a(Le),Te=r(53),ke=a(Te),_e=r(54),Ne=a(_e),Ce=r(55),Se=a(Ce);t.ThreeMFLoader=i.default,t.AMFLoader=s.default,t.AssimpJSONLoader=u.default,t.AssimpLoader=h.default,t.AWDLoader=p.default,t.BabylonLoader=m.default,t.BinaryLoader=g.default,t.BVHLoader=b.default,t.ColladaLoader=A.default,t.DDSLoader=x.default,t.EXRLoader=E.default,t.FBXLoader=k.default,t.GCodeLoader=N.default,t.GLTFLoader=S.default,t.HDRCubeTextureLoader=F.default,t.KMZLoader=R.default,t.KTXLoader=B.default,t.LoaderSupport=V.default,t.MD2Loader=U.default,t.MMDLoader=z.default,t.MTLLoader=Y.default,t.NodeMaterialLoader=W.default,t.NRRDLoader=Q.default,t.OBJLoader=q.default,t.OBJLoader2=$.default,t.PCDLoader=te.default,t.PDBLoader=ae.default,t.PlayCanvasLoader=ie.default,t.PLYLoader=se.default,t.PRWMLoader=ue.default,t.PVRLoader=he.default,t.RGBELoader=pe.default,t.STLLoader=me.default,t.SVGLoader=ge.default,t.TDSLoader=be.default,t.TGALoader=Ae.default,t.TTFLoader=xe.default,t.UTF8Loader=Ee.default,t.VRMLLoader=ke.default,t.VTKLoader=Ne.default,t.XLoader=Se.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.ThreeMFLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.availableExtensions=[]},n.ThreeMFLoader.prototype={constructor:n.ThreeMFLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e){var t=(new DOMParser).parseFromString(e,"application/xml"),r=t.querySelector("Relationship");return{target:r.getAttribute("Target"),id:r.getAttribute("Id"),type:r.getAttribute("Type")}}function r(e){for(var t={},r=0;r<e.length;r++){var a=e[r],n=a.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(n)&&(t[n]=a.textContent)}return t}function a(e){}function i(e,t){for(var r={},a=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var o=n[i],s=o.getAttribute("x"),l=o.getAttribute("y"),u=o.getAttribute("z");a.push(parseFloat(s),parseFloat(l),parseFloat(u))}r.vertices=new Float32Array(a.length);for(var i=0;i<a.length;i++)r.vertices[i]=a[i];for(var c=[],h=[],d=e.querySelectorAll("triangles triangle"),i=0;i<d.length;i++){var p=d[i],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),b=p.getAttribute("p3"),w=p.getAttribute("pid");h.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var A={};g&&(A.p1=parseInt(g,10)),y&&(A.p2=parseInt(y,10)),b&&(A.p3=parseInt(b,10)),w&&(A.pid=w),0<Object.keys(A).length&&c.push(A)}r.triangleProperties=c,r.triangles=new Uint32Array(h.length);for(var i=0;i<h.length;i++)r.triangles[i]=h[i];return r}function o(e){}function s(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var a=e.getAttribute("pid");a&&(t.pid=a);var n=e.getAttribute("pindex");n&&(t.pindex=n);var s=e.getAttribute("thumbnail");s&&(t.thumbnail=s);var l=e.getAttribute("partnumber");l&&(t.partnumber=l);var u=e.getAttribute("name");u&&(t.name=u);var c=e.querySelector("mesh");c&&(t.mesh=i(c));var h=e.querySelector("components");return h&&(t.components=o(h)),t}function l(e){var t={},r=e.querySelector("basematerials");r&&(t.basematerial=a(r)),t.object={};for(var n=e.querySelectorAll("object"),i=0;i<n.length;i++){var o=n[i],l=s(o);t.object[l.id]=l}return t}function u(e){for(var t=[],r=e.querySelectorAll("item"),a=0;a<r.length;a++){var i=r[a],o={objectid:i.getAttribute("objectid")},s=i.getAttribute("transform");if(s){var l=[];s.split(" ").forEach(function(e){l.push(parseFloat(e))});var u=new n.Matrix4;o.transform=u.set(l[0],l[3],l[6],l[9],l[1],l[4],l[7],l[10],l[2],l[5],l[8],l[11],0,0,0,1)}t.push(o)}return t}function c(e){var t={unit:e.getAttribute("unit")||"millimeter"},a=e.querySelectorAll("metadata");a&&(t.metadata=r(a));var n=e.querySelector("resources");n&&(t.resources=l(n));var i=e.querySelector("build");return i&&(t.build=u(i)),t}function h(e,t){var r=new n.BufferGeometry;r.setIndex(new n.BufferAttribute(e.triangles,1)),r.addAttribute("position",new n.BufferAttribute(e.vertices,3)),e.colors&&r.addAttribute("color",new n.BufferAttribute(e.colors,3)),r.computeBoundingSphere();var a={flatShading:!0};e.colors&&0<e.colors.length?a.vertexColors=n.VertexColors:a.color=11184895;var i=new n.MeshPhongMaterial(a);return new n.Mesh(r,i)}function d(e,t,r,a){if(e){for(var n=[],i=Object.keys(e),o=0;o<i.length;o++)for(var s=i[o],l=0;l<p.availableExtensions.length;l++){var u=p.availableExtensions[l];u.ns===s&&n.push(u)}for(var o=0;o<n.length;o++){var u=n[o];u.apply(r,e[u.ns],t)}}}var p=this,f=function(e){var r,a,i=null,o=null,s=[],l=[],u=[],h=[],d={},p={},f={},m={};try{i=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.ThreeMFLoader: jszip missing and file is compressed."),null}for(o in i.files)o.match(/\.rels$/)?r=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)?l.push(o):o.match(/^3D\/Textures\/.*/)?u.push(o):o.match(/^3D\/Other\/.*/)&&h.push(o);var v=new Uint8Array(i.file(r).asArrayBuffer());a=t(n.LoaderUtils.decodeText(v));for(var g=0;g<s.length;g++){var y=s[g],b=new Uint8Array(i.file(y).asArrayBuffer()),w=n.LoaderUtils.decodeText(b),A=(new DOMParser).parseFromString(w,"application/xml");"model"!==A.documentElement.nodeName.toLowerCase()&&console.error("THREE.ThreeMFLoader: Error loading 3MF - no 3MF document found: ",y);for(var M=A.querySelector("model"),x={},g=0;g<M.attributes.length;g++){var L=M.attributes[g];L.name.match(/^xmlns:(.+)$/)&&(x[L.value]=RegExp.$1)}var E=c(M);E.xml=M,0<Object.keys(x).length&&(E.extensions=x),d[y]=E}for(var g=0;g<u.length;g++){var T=u[g];f[T]=i.file(T).asBinary()}return{rels:a,model:d,printTicket:p,texture:f,other:m}}(e),m=function(e){for(var t=e.model,r={},a=Object.keys(t),n=0;n<a.length;n++)for(var i=a[n],o=t[i],s=o.xml,l=o.extensions,u=Object.keys(o.resources.object),c=0;c<u.length;c++){var p=u[c],f=o.resources.object[p],m=f.mesh;d(l,m,s,e),r[p]=h(m,e)}return r}(f);return function(e,t,r){for(var a=new n.Group,i=r.model[t.target.substring(1)].build,o=0;o<i.length;o++){var s=i[o],l=e[s.objectid];s.transform&&l.geometry.applyMatrix(s.transform),a.add(l)}return a}(m,f.rels,f)},addExtension:function(e){this.availableExtensions.push(e)}},t.default=n.ThreeMFLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.AMFLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.AMFLoader.prototype={constructor:n.AMFLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];"r"===a.nodeName?t.r=a.textContent:"g"===a.nodeName?t.g=a.textContent:"b"===a.nodeName?t.b=a.textContent:"a"===a.nodeName&&(t.a=a.textContent)}return t}function r(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var a=r.getElementsByTagName("v1")[0].textContent,n=r.getElementsByTagName("v2")[0].textContent,i=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(a,n,i)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],a=e.firstElementChild;a;){if("vertex"===a.nodeName)for(var n=a.firstElementChild;n;){if("coordinates"===n.nodeName){var i=n.getElementsByTagName("x")[0].textContent,o=n.getElementsByTagName("y")[0].textContent,s=n.getElementsByTagName("z")[0].textContent;t.push(i,o,s)}else if("normal"===n.nodeName){var l=n.getElementsByTagName("nx")[0].textContent,u=n.getElementsByTagName("ny")[0].textContent,c=n.getElementsByTagName("nz")[0].textContent;r.push(l,u,c)}n=n.nextElementSibling}a=a.nextElementSibling}return{vertices:t,normals:r}}var i,o,s=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,a=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(a in r.files)if(".amf"===a.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+a),t=new DataView(r.file(a).asArrayBuffer())}var i=n.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(i,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),l="",u="",c=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var a={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==a[r]&&(t=a[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(s),h={},d={},p=s.documentElement.childNodes;for(i=0;i<p.length;i++){var f=p[i];if("metadata"===f.nodeName)void 0!==f.attributes.type&&("name"===f.attributes.type.value?l=f.textContent:"author"===f.attributes.type.value&&(u=f.textContent));else if("material"===f.nodeName){var m=function(e){for(var r="AMF Material",a=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},o=null,s=0;s<e.childNodes.length;s++){var l=e.childNodes[s];"metadata"===l.nodeName&&void 0!==l.attributes.type?"name"===l.attributes.type.value&&(r=l.textContent):"color"===l.nodeName&&(i=t(l))}return o=new n.MeshPhongMaterial({flatShading:!0,color:new n.Color(i.r,i.g,i.b),name:r}),1!==i.a&&(o.transparent=!0,o.opacity=i.a),{id:a,material:o}}(f);h[m.id]=m.material}else if("object"===f.nodeName){var v=function(e){for(var n=e.attributes.id.textContent,i={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(i.name=s.textContent);else if("color"===s.nodeName)o=t(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,u={vertices:[],normals:[],volumes:[],color:o};l;){if("vertices"===l.nodeName){var c=a(l);u.normals=u.normals.concat(c.normals),u.vertices=u.vertices.concat(c.vertices)}else"volume"===l.nodeName&&u.volumes.push(r(l));l=l.nextElementSibling}i.meshes.push(u)}s=s.nextElementSibling}return{id:n,obj:i}}(f);d[v.id]=v.obj}}var g=new n.Group,y=new n.MeshPhongMaterial({color:11184895,flatShading:!0});g.name=l,g.userData.author=u,g.userData.loader="AMF";for(var b in d){var w=d[b],A=w.meshes,M=new n.Group;for(M.name=w.name||"",i=0;i<A.length;i++){var x=y,L=A[i],E=new n.Float32BufferAttribute(L.vertices,3),T=null;if(L.normals.length&&(T=new n.Float32BufferAttribute(L.normals,3)),L.color){var k=L.color;x=y.clone(),x.color=new n.Color(k.r,k.g,k.b),1!==k.a&&(x.transparent=!0,x.opacity=k.a)}var _=L.volumes;for(o=0;o<_.length;o++){var N=_[o],C=new n.BufferGeometry,S=x;C.setIndex(N.triangles),C.addAttribute("position",E.clone()),T&&C.addAttribute("normal",T.clone()),void 0!==h[N.materialId]&&(S=h[N.materialId]),C.scale(c,c,c),M.add(new n.Mesh(C,S.clone()))}}g.add(M)}return g}},t.default=n.AMFLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.AssimpJSONLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.AssimpJSONLoader.prototype={constructor:n.AssimpJSONLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this,o=n.LoaderUtils.extractUrlBase(e);new n.FileLoader(this.manager).load(e,function(e){var r=JSON.parse(e),n=r.__metadata__;if(void 0!==n){if("assimp2json"!==n.format)return void a("THREE.AssimpJSONLoader: Not an assimp2json scene.");if(n.version<100&&n.version>=200)return void a("THREE.AssimpJSONLoader: Unsupported assimp2json file format version.")}t(i.parse(r,o))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=new Array(e.length),a=0;a<e.length;++a)r[a]=t.call(this,e[a]);return r}function a(e){var t,r,a,i=new n.BufferGeometry,o=[],s=e.vertices||[],l=e.normals||[],u=e.texturecoords||[],c=e.colors||[];for(u=u[0]||[],t=0,r=e.faces.length;t<r;t++)a=e.faces[t],o.push(a[0],a[1],a[2]);return i.setIndex(o),i.addAttribute("position",new n.Float32BufferAttribute(s,3)),l.length>0&&i.addAttribute("normal",new n.Float32BufferAttribute(l,3)),u.length>0&&i.addAttribute("uv",new n.Float32BufferAttribute(u,2)),c.length>0&&i.addAttribute("color",new n.Float32BufferAttribute(c,3)),i.computeBoundingSphere(),i}function i(e){var t=new n.MeshPhongMaterial;for(var r in e.properties){var a=e.properties[r],i=a.key,o=a.value;switch(i){case"$tex.file":var l=a.semantic;if(1===l||2===l||5===l||6===l){var u;switch(l){case 1:u="map";break;case 2:u="specularMap";break;case 5:u="bumpMap";break;case 6:u="normalMap"}var c=s.load(o);c.wrapS=c.wrapT=n.RepeatWrapping,t[u]=c}break;case"?mat.name":t.name=o;break;case"$clr.diffuse":t.color.fromArray(o);break;case"$clr.specular":t.specular.fromArray(o);break;case"$clr.emissive":t.emissive.fromArray(o);break;case"$mat.shininess":t.shininess=o;break;case"$mat.shadingm":t.flatShading=1===o;break;case"$mat.opacity":o<1&&(t.opacity=o,t.transparent=!0)}}return t}function o(e,t,r,a){var i,s,l=new n.Object3D;for(l.name=t.name||"",l.matrix=(new n.Matrix4).fromArray(t.transformation).transpose(),l.matrix.decompose(l.position,l.quaternion,l.scale),i=0;t.meshes&&i<t.meshes.length;i++)s=t.meshes[i],l.add(new n.Mesh(r[s],a[e.meshes[s].materialindex]));for(i=0;t.children&&i<t.children.length;i++)l.add(o(e,t.children[i],r,a));return l}var s=new n.TextureLoader(this.manager);s.setPath(t).setCrossOrigin(this.crossOrigin);var l=r(e.meshes,a),u=r(e.materials,i);return o(e,e.rootnode,l,u)}},t.default=n.AssimpJSONLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.AssimpLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.AssimpLoader.prototype={constructor:n.AssimpLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this,o=n.LoaderUtils.extractUrlBase(e),s=new n.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(i.parse(e,o))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e){return ke<<e}function a(e){return _e<<e}function i(e){for(var t in e.mMeshes){var r=e.mMeshes[t];for(var a in r.mBones){var n=e.findNode(r.mBones[a].mName);n&&(n.isBone=!0)}}}function o(e,t){var r=new n.Bone;r.matrix.copy(e.matrix),r.matrixWorld.copy(e.matrixWorld),r.position.copy(e.position),r.quaternion.copy(e.quaternion),r.scale.copy(e.scale),t.nodeCount++,r.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(r);for(var a in e.children){var i=o(e.children[a],t);i&&r.add(i)}return r}function s(e,t){for(var r=[],a=0;a<e.length;a++)r.push({i:e[a],w:t[a]});for(r.sort(function(e,t){return t.w-e.w});r.length<4;)r.push({i:0,w:0});r.length>4&&(r.length=4);for(var n=0,a=0;a<4;a++)n+=r[a].w*r[a].w;n=Math.sqrt(n);for(var a=0;a<4;a++)r[a].w=r[a].w/n,e[a]=r[a].i,t[a]=r[a].w}function l(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var r in e.children){var a=l(e.children[r],t);if(a)return a}}function u(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e,t){if(0!=this.mBones.length){for(var r=[],a=[],i=e.findNode(this.mBones[0].mName);i.mParent&&i.mParent.isBone;)i=i.mParent;var s=i.toTHREE(e),u=o(s,e);this.threeNode.add(u);for(var c=0;c<this.mBones.length;c++){var h=l(u,this.mBones[c].mName);if(h){var d=h;r.push(d),a.push(this.mBones[c].mOffsetMatrix.toTHREE())}else{var i=e.findNode(this.mBones[c].mName);if(!i)return;var s=i.toTHREE(e),u=(s.parent,o(s,e));this.threeNode.add(u);var h=l(u,this.mBones[c].mName),d=h;r.push(d),a.push(this.mBones[c].mOffsetMatrix.toTHREE())}}var p=new n.Skeleton(r,a);this.threeNode.bind(p,new n.Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,r=new n.BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new n.MeshLambertMaterial,r.setIndex(new n.BufferAttribute(new Uint32Array(this.mIndexArray),1)),r.addAttribute("position",new n.BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.addAttribute("normal",new n.BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.addAttribute("color",new n.BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.addAttribute("uv",new n.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.addAttribute("uv1",new n.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.addAttribute("tangents",new n.BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.addAttribute("bitangents",new n.BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){for(var a=[],i=[],o=0;o<this.mBones.length;o++)for(var l=0;l<this.mBones[o].mWeights.length;l++){var u=this.mBones[o].mWeights[l];u&&(a[u.mVertexId]||(a[u.mVertexId]=[]),i[u.mVertexId]||(i[u.mVertexId]=[]),a[u.mVertexId].push(u.mWeight),i[u.mVertexId].push(parseInt(o)))}for(var o in i)s(i[o],a[o]);for(var c=[],h=[],o=0;o<a.length;o++)for(var l=0;l<4;l++)a[o]&&i[o]?(c.push(a[o][l]),h.push(i[o][l])):(c.push(0),h.push(0));r.addAttribute("skinWeight",new n.BufferAttribute(new Float32Array(c),Be)),r.addAttribute("skinIndex",new n.BufferAttribute(new Float32Array(h),Be))}var d;return 0==this.mBones.length&&(d=new n.Mesh(r,t)),this.mBones.length>0&&(d=new n.SkinnedMesh(r,t)),this.threeNode=d,d}}function c(){this.mNumIndices=0,this.mIndices=[]}function h(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new n.Vector3(this.x,this.y,this.z)}}function d(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new n.Color(this.r,this.g,this.b,1)}}function p(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new n.Quaternion(this.x,this.y,this.z,this.w)}}function f(){this.mVertexId=0,this.mWeight=0}function m(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}function v(){this.mTime=0,this.mValue=null}function g(){this.mTime=0,this.mValue=null}function y(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new n.Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var r=0;r<this.mChildren.length;r++)t.add(this.mChildren[r].toTHREE(e));for(var r=0;r<this.mMeshes.length;r++)t.add(e.mMeshes[this.mMeshes[r]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function b(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function w(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),r=t.getFloat32(0,!0),a=t.getFloat32(4,!0),i=t.getFloat32(8,!0);return new n.Color(r,a,i)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new m;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new m;e.data=this.mData;var t=e.toString();return t=t.replace(/\\/g,"/"),-1!=t.indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),ue.load(t)}}function A(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(e){for(var t=(this.mProperties[0].dataAsString(),new n.MeshPhongMaterial),r=0;r<this.mProperties.length;r++)if("float"==Ve[this.mProperties[r].mKey]&&(t[De[this.mProperties[r].mKey]]=this.mProperties[r].dataAsFloat()),"color"==Ve[this.mProperties[r].mKey]&&(t[De[this.mProperties[r].mKey]]=this.mProperties[r].dataAsColor()),"bool"==Ve[this.mProperties[r].mKey]&&(t[De[this.mProperties[r].mKey]]=this.mProperties[r].dataAsBool()),"string"==Ve[this.mProperties[r].mKey]&&(t[De[this.mProperties[r].mKey]]=this.mProperties[r].dataAsString()),"map"==Ve[this.mProperties[r].mKey]){var a=this.mProperties[r];a.mSemantic==Fe&&(t.map=this.mProperties[r].dataAsMap()),a.mSemantic==Pe&&(t.normalMap=this.mProperties[r].dataAsMap()),a.mSemantic==Ie&&(t.lightMap=this.mProperties[r].dataAsMap()),a.mSemantic==Re&&(t.alphaMap=this.mProperties[r].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function M(e,t,r){var a=new n.Vector3,i=1-r;return a.x=e.x*r+t.x*i,a.y=e.y*r+t.y*i,a.z=e.z*r+t.z*i,a}function x(e,t,r){return e.clone().slerp(t,1-r)}function L(e,t,r,a){if(1==e.length)return e[0].mValue.toTHREE();for(var n=1/0,i=null,o=null,s=0;s<e.length;s++){var l=Math.abs(e[s].mTime-t);l<n&&e[s].mTime<=t&&(n=l,i=e[s],o=e[s+1])}if(i){if(o){var u=o.mTime-i.mTime,c=i.mTime-t,h=c/u;return a(i.mValue.toTHREE(),o.mValue.toTHREE(),h)}o=e[0].clone(),o.mTime+=r;var u=o.mTime-i.mTime,c=i.mTime-t,h=c/u;return a(i.mValue.toTHREE(),o.mValue.toTHREE(),h)}return null}function E(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e,t){this.sortKeys();for(var r=this.getLength(),a=new ce.KeyFrameTrack,i=0;i<r;i+=.05){var o=new n.Matrix4,s=i,l=L(this.mPositionKeys,s,r,M),u=L(this.mScalingKeys,s,r,M),c=L(this.mRotationKeys,s,r,x);o.compose(l,c,u);var h=new ce.KeyFrame(s,o);a.addKey(h)}a.target=e.findNode(this.mNodeName).toTHREE();var d=[a];if(e.nodeToBoneMap[this.mNodeName])for(var i=0;i<e.nodeToBoneMap[this.mNodeName].length;i++){var p=a.clone();p.target=e.nodeToBoneMap[this.mNodeName][i],d.push(p)}return d}}function T(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new ce.Animation;for(var r in this.mChannels){this.mChannels[r].init(this.mTicksPerSecond);var a=this.mChannels[r].toTHREE(e);for(var n in a)a[n].init(),t.addTrack(a[n])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}function k(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function _(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function N(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function C(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var r=0;r<t.mChildren.length;r++){var a=this.findNode(e,t.mChildren[r]);if(a)return a}return null},this.toTHREE=function(){this.nodeCount=0,i(this);var e=this.mRootNode.toTHREE(this);for(var t in this.mMeshes)this.mMeshes[t].hookupSkeletons(this,e);if(this.mAnimations.length>0)var r=this.mAnimations[0].toTHREE(this);return{object:e,animation:r}}}function S(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new n.Matrix4,t=0;t<4;++t)for(var r=0;r<4;++r)e.elements[4*t+r]=this.elements[r][t];return e}}function O(e){var t=e.getFloat32(e.readOffset,je);return e.readOffset+=4,t}function F(e){var t=e.getFloat64(e.readOffset,je);return e.readOffset+=8,t}function P(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}function R(e){var t=e.getUint16(e.readOffset,je);return e.readOffset+=2,t}function I(e){var t=e.getUint32(e.readOffset,je);return e.readOffset+=4,t}function B(e){var t=e.getUint32(e.readOffset,je);return e.readOffset+=4,t}function D(e){var t=new h;return t.x=O(e),t.y=O(e),t.z=O(e),t}function V(e){var t=new d;return t.r=O(e),t.g=O(e),t.b=O(e),t}function j(e){var t=new p;return t.w=O(e),t.x=O(e),t.y=O(e),t.z=O(e),t}function U(e){var t=new m,r=I(e);return e.ReadBytes(t.data,1,r),t.toString()}function G(e){var t=new f;return t.mVertexId=I(e),t.mWeight=O(e),t}function z(e){for(var t=new S,r=0;r<4;++r)for(var a=0;a<4;++a)t.elements[r][a]=O(e);return t}function H(e){var t=new v;return t.mTime=F(e),t.mValue=D(e),t}function Y(e){var t=new g;return t.mTime=F(e),t.mValue=j(e),t}function X(e,t,r){for(var a=0;a<r;a++)t[a]=G(e)}function W(e,t,r){for(var a=0;a<r;a++)t[a]=H(e)}function K(e,t,r){for(var a=0;a<r;a++)t[a]=Y(e)}function Q(e,t,r){return e.Seek(sizeof(t)*r,Ue)}function Z(e){if(!e)throw"asset failed"}function q(e,t,r){Z(B(e)==Ae),B(e);var a=new y;if(a.mParent=t,a.mDepth=r,a.mName=U(e),a.mTransformation=z(e),a.mNumChildren=I(e),a.mNumMeshes=I(e),a.mNumMeshes){a.mMeshes=[];for(var n=0;n<a.mNumMeshes;++n)a.mMeshes[n]=I(e)}if(a.mNumChildren){a.mChildren=[];for(var n=0;n<a.mNumChildren;++n){var i=q(e,a,r++);a.mChildren[n]=i}}return a}function J(e,t){return Z(B(e)==be),B(e),t.mName=U(e),t.mNumWeights=I(e),t.mOffsetMatrix=z(e),he?Q(e,t.mWeights,t.mNumWeights):(t.mWeights=[],X(e,t.mWeights,t.mNumWeights)),t}function $(e,t){Z(B(e)==ve),B(e),t.mPrimitiveTypes=I(e),t.mNumVertices=I(e),t.mNumFaces=I(e),t.mNumBones=I(e),t.mMaterialIndex=I(e),t.mNumUVComponents=[];var n=I(e);n&Le&&(he?Q(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ue))),n&Ee&&(he?Q(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ue))),n&Te&&(he?(Q(e,t.mTangents,t.mNumVertices),Q(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ue),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,Ue)));for(var i=0;i<Ne&&n&a(i);++i)he?Q(e,t.mColors[i],t.mNumVertices):(t.mColors[i]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,Ue));t.mTexCoordsBuffers=[];for(var i=0;i<Ce&&n&r(i);++i)if(t.mNumUVComponents[i]=I(e),he)Q(e,t.mTextureCoords[i],t.mNumVertices);else{t.mTextureCoords[i]=[],t.mTexCoordsBuffers[i]=[];for(var o=0;o<t.mNumVertices;o++)t.mTexCoordsBuffers[i].push(O(e)),t.mTexCoordsBuffers[i].push(O(e)),O(e)}if(he)I(e);else{t.mFaces=[];t.mIndexArray=[];for(var s=0;s<t.mNumFaces;++s){var l=t.mFaces[s]=new c;l.mNumIndices=R(e),l.mIndices=[];for(var u=0;u<l.mNumIndices;++u)t.mNumVertices<65536?l.mIndices[u]=R(e):l.mIndices[u]=I(e);if(3===l.mNumIndices)t.mIndexArray.push(l.mIndices[0]),t.mIndexArray.push(l.mIndices[1]),t.mIndexArray.push(l.mIndices[2]);else{if(4!==l.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(l.mIndices[0]),t.mIndexArray.push(l.mIndices[1]),t.mIndexArray.push(l.mIndices[2]),t.mIndexArray.push(l.mIndices[2]),t.mIndexArray.push(l.mIndices[3]),t.mIndexArray.push(l.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(var u=0;u<t.mNumBones;++u)t.mBones[u]=new b,J(e,t.mBones[u])}}function ee(e,t){Z(B(e)==xe),B(e),t.mKey=U(e),t.mSemantic=I(e),t.mIndex=I(e),t.mDataLength=I(e),t.mType=I(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function te(e,t){if(Z(B(e)==Me),B(e),t.mNumAllocated=t.mNumProperties=I(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var r=0;r<t.mNumProperties;++r)t.mProperties[r]=new w,ee(e,t.mProperties[r])}}function re(e,t){Z(B(e)==ge),B(e),t.mNodeName=U(e),t.mNumPositionKeys=I(e),t.mNumRotationKeys=I(e),t.mNumScalingKeys=I(e),t.mPreState=I(e),t.mPostState=I(e),t.mNumPositionKeys&&(he?Q(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],W(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(he?Q(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],K(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(he?Q(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],W(e,t.mScalingKeys,t.mNumScalingKeys)))}function ae(e,t){if(Z(B(e)==we),B(e),t.mName=U(e),t.mDuration=F(e),t.mTicksPerSecond=F(e),t.mNumChannels=I(e),t.mNumChannels){t.mChannels=[];for(var r=0;r<t.mNumChannels;++r)t.mChannels[r]=new E,re(e,t.mChannels[r])}}function ne(e,t){Z(B(e)==me),B(e),t.mWidth=I(e),t.mHeight=I(e),e.ReadBytes(t.achFormatHint,1,4),he||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function ie(e,t){Z(B(e)==fe),B(e),t.mName=U(e),t.mType=I(e),t.mType!=Se&&(t.mAttenuationConstant=O(e),t.mAttenuationLinear=O(e),t.mAttenuationQuadratic=O(e)),t.mColorDiffuse=V(e),t.mColorSpecular=V(e),t.mColorAmbient=V(e),t.mType==Oe&&(t.mAngleInnerCone=O(e),t.mAngleOuterCone=O(e))}function oe(e,t){Z(B(e)==pe),B(e),t.mName=U(e),t.mPosition=D(e),t.mLookAt=D(e),t.mUp=D(e),t.mHorizontalFOV=O(e),t.mClipPlaneNear=O(e),t.mClipPlaneFar=O(e),t.mAspect=O(e)}function se(e,t){if(Z(B(e)==ye),B(e),t.mFlags=I(e),t.mNumMeshes=I(e),t.mNumMaterials=I(e),t.mNumAnimations=I(e),t.mNumTextures=I(e),t.mNumLights=I(e),t.mNumCameras=I(e),t.mRootNode=new y,t.mRootNode=q(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var r=0;r<t.mNumMeshes;++r)t.mMeshes[r]=new u,$(e,t.mMeshes[r])}if(t.mNumMaterials){t.mMaterials=[];for(var r=0;r<t.mNumMaterials;++r)t.mMaterials[r]=new A,te(e,t.mMaterials[r])}if(t.mNumAnimations){t.mAnimations=[];for(var r=0;r<t.mNumAnimations;++r)t.mAnimations[r]=new T,ae(e,t.mAnimations[r])}if(t.mNumTextures){t.mTextures=[];for(var r=0;r<t.mNumTextures;++r)t.mTextures[r]=new k,ne(e,t.mTextures[r])}if(t.mNumLights){t.mLights=[];for(var r=0;r<t.mNumLights;++r)t.mLights[r]=new _,ie(e,t.mLights[r])}if(t.mNumCameras){t.mCameras=[];for(var r=0;r<t.mNumCameras;++r)t.mCameras[r]=new N,oe(e,t.mCameras[r])}}function le(e){e.readOffset=0,e.Seek=function(t,r){r==Ue&&(e.readOffset+=t),r==Ge&&(e.readOffset=t)},e.ReadBytes=function(e,t,r){for(var a=t*r,n=0;n<a;n++)e[n]=P(this)},e.subArray32=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Float32Array(a)},e.subArrayUint16=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint16Array(a)},e.subArrayUint8=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint8Array(a)},e.subArrayUint32=function(e,t){var r=this.buffer,a=r.slice(e,t);return new Uint32Array(a)}}var ue=new n.TextureLoader(this.manager);ue.setPath(t).setCrossOrigin(this.crossOrigin);var ce={};ce.KeyFrame=function(e,t){this.time=e,this.matrix=t.clone(),this.position=new n.Vector3,this.quaternion=new n.Quaternion,this.scale=new n.Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new ce.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){t-=this.time;var r=e.time-this.time,a=t/r,n=1-a,i=this.position,o=this.quaternion,s=e.position,l=e.quaternion;return ce.KeyFrame.tempAniPos.x=i.x*n+s.x*a,ce.KeyFrame.tempAniPos.y=i.y*n+s.y*a,ce.KeyFrame.tempAniPos.z=i.z*n+s.z*a,ce.KeyFrame.tempAniQuat.set(o.x,o.y,o.z,o.w),ce.KeyFrame.tempAniQuat.slerp(l,a),ce.KeyFrame.tempAniMatrix.compose(ce.KeyFrame.tempAniPos,ce.KeyFrame.tempAniQuat,ce.KeyFrame.tempAniScale)}},ce.KeyFrame.tempAniPos=new n.Vector3,ce.KeyFrame.tempAniQuat=new n.Quaternion,ce.KeyFrame.tempAniScale=new n.Vector3(1,1,1),ce.KeyFrame.tempAniMatrix=new n.Matrix4,ce.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;for(var r=e.hierarchy[0].keys,a=0;a<r.length;a++)this.addKey(new ce.KeyFrame(a/t||r[a].time,r[a].targets[0].data));this.init()},this.parseFromCollada=function(e){for(var t=e.keys,r=this.fps,a=0;a<t.length;a++)this.addKey(new ce.KeyFrame(a/r||t[a].time,t[a].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new ce.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=ce.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);for(var t=null,r=null,a=this.keySearchAccel(e);a<this.keys.length;a++){if(this.keys[a].time==e){t=this.keys[a],r=this.keys[a];break}if(this.keys[a].time<e&&this.keys[a+1]&&this.keys[a+1].time>e){t=this.keys[a],r=this.keys[a+1];break}if(this.keys[a].time<e&&a==this.keys.length-1){t=this.keys[a],r=this.keys[0].clone(),r.time+=this.length+.05;break}}return t&&r&&t!==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(r,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&r&&t==r?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},ce.TrackTargetNodeNameCompare=function(e,t){function r(e,t){if(e.name==t)return e;for(var a=0;a<e.children.length;a++){var n=r(e.children[a],t);if(n)return n}return null}return r(e,t.name)},ce.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=ce.TrackTargetNodeNameCompare);var r=new ce.Animation;r.target=e;for(var a=0;a<this.tracks.length;a++){var n=this.tracks[a].clone();n.reTarget(e,t),r.addTrack(n)}return r}};var he,de,pe=4660,fe=4661,me=4662,ve=4663,ge=4664,ye=4665,be=4666,we=4667,Ae=4668,Me=4669,xe=4670,Le=1,Ee=2,Te=4,ke=256,_e=65536,Ne=1,Ce=4,Se=1,Oe=3,Fe=1,Pe=6,Re=8,Ie=10,Be=4,De={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},Ve={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"},je=!0,Ue=0,Ge=1;return function(e){var t=new C,r=new DataView(e);le(r),r.Seek(44,Ue);I(r),I(r),I(r),I(r);if(he=R(r)>0,de=R(r)>0,he)throw"Shortened binaries are not supported!";if(r.Seek(256,Ue),r.Seek(128,Ue),r.Seek(64,Ue),!de)return se(r,t),t.toTHREE();var a=B(r),n=r.FileSize()-r.Tell(),i=[];r.Read(i,1,n);var o=[];uncompress(o,a,i,n),se(new ArrayBuffer(o),t)}(e)}},t.default=n.AssimpLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);!function(){function e(){this.id=0,this.data=null}function t(){}t.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}},n.AWDLoader=function(t){this.manager=void 0!==t?t:n.DefaultLoadingManager,this.trunk=new n.Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new e],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1},n.AWDLoader.prototype={constructor:n.AWDLoader,load:function(e,t,r,a){var i=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var o=new n.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){var t=e.byteLength;for(this._ptr=0,this._data=new DataView(e),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==e.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,t-this._ptr);this._ptr<t;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,r,a,n,i=this.readU32(),r=(this.readU8(),this.readU8()),a=(this.readU8(),this.readU32());switch(r){case 1:t=this.parseMeshData(a);break;case 22:t=this.parseContainer(a);break;case 23:t=this.parseMeshInstance(a);break;case 81:t=this.parseMaterial(a);break;case 82:t=this.parseTexture(a);break;case 101:t=this.parseSkeleton(a);break;case 112:t=this.parseMeshPoseAnimation(a,!1);break;case 113:t=this.parseVertexAnimationSet(a);break;case 102:t=this.parseSkeletonPose(a);break;case 103:t=this.parseSkeletonAnimation(a);break;case 122:t=this.parseAnimatorSet(a);break;default:this._ptr+=a}this._blocks[i]=n=new e,n.data=t,n.id=i},_parseHeader:function(){var e=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var t=this.readU16();this._streaming=1==(1&t),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2==(2&t),this._accuracyGeo=4==(4&t),this._accuracyProps=8==(8&t)),this._geoNrType=this._accuracyGeo?8:7,this._matrixNrType=this._accuracyMatrix?8:7,this._propsNrType=this._accuracyProps?8:7,this._optimized_for_accuracy=2==(2&t),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(e){var t,r=new n.Object3D,a=this.readU32(),i=this.parseMatrix4();return r.name=this.readUTF(),r.applyMatrix(i),t=this._blocks[a].data||this.trunk,t.add(r),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:4}),r.extra=this.parseUserAttributes(),r},parseMeshInstance:function(e){var t,r,a,i,o,s,l,u,c,h,d,p,f,m;for(s=this.readU32(),u=this.parseMatrix4(),t=this.readUTF(),l=this.readU32(),p=this.readU16(),a=this.getBlock(l),c=[],m=0;m<p;m++)d=this.readU32(),h=this.getBlock(d),c.push(h);if(i=a.length,o=[],i>1)for(r=new n.Object3D,m=0;m<i;m++){var v=new n.Mesh(a[m]);o.push(v),r.add(v)}else r=new n.Mesh(a[0]),o.push(r);r.applyMatrix(u),r.name=t,f=this.getBlock(s)||this.trunk,f.add(r);var g=c.length,y=Math.max(i,g);for(m=0;m<y;m++)o[m%i].material=c[m%g];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(e){var t,r,a,i,o,s,l;for(t=this.readUTF(),r=this.readU8(),s=this.readU8(),a=this.parseProperties({1:3,2:23,11:21,12:7,13:21}),l=0;l<s;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(t)))return i;if(i=new n.MeshPhongMaterial,1===r)i.color.setHex(a.get(1,13421772));else if(2===r){var u=a.get(2,0);i.map=this.getBlock(u)}return i.extra=o,i.alphaThreshold=a.get(12,0),i.repeat=a.get(13,!1),i},parseTexture:function(e){var t,r,a=(this.readUTF(),this.readU8());if(0===a){r=this.readU32();var n=this.readUTFBytes(r);console.log(n),t=this.loadTexture(n)}return this.parseProperties(null),this.parseUserAttributes(),t},loadTexture:function(e){var t=new n.Texture;return new n.ImageLoader(this.manager).load(this._baseDir+e,function(e){t.image=e,t.needsUpdate=!0}),t},parseSkeleton:function(e){var t=(this.readUTF(),this.readU16()),r=[],a=0;for(this.parseProperties(null);a<t;){var i,o;this.readU16(),i=new n.Bone,i.parent=this.readU16()-1,i.name=this.readUTF(),o=this.parseMatrix4(),i.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),r.push(i),a++}return this.parseUserAttributes(),r},parseSkeletonPose:function(e){var t=(this.readUTF(),this.readU16());this.parseProperties(null);for(var r=[],a=0;a<t;){var i,o;i=this.readU8(),o=1===i?this.parseMatrix4():new n.Matrix4,r[a]=o,a++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(e){var t,r,a,n=(this.readUTF(),[]),i=this.readU16();this.parseProperties(null);for(var o=0;o<i;)r=this.readU32(),t=this.readU16(),a=this._blocks[r].data,n.push({pose:a,duration:t}),o++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(e){for(var t,r=(this.readUTF(),this.readU16()),a=(this.parseProperties({1:5}),0),n=[];a<r;)t=this.readU32(),n.push(this._blocks[t].data),a++;return this.parseUserAttributes(),n},parseAnimatorSet:function(e){var t,r,a=(this.readUTF(),this.readU16()),n=this.parseProperties({1:23});t=this.readU32();for(var i=this.readU16(),o=[],s=0;s<i;s++)o.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var l=[];for(s=0;s<o.length;s++)l.push(this._blocks[o[s]].data);r=this._blocks[t].data;var u;for(1==a&&(u={animationSet:r,skeleton:this._blocks[n.get(1,0)].data}),s=0;s<l.length;s++)l[s].animator=u;return u},parseMeshData:function(e){var t,r,a=this.readUTF(),i=this.readU16(),o=0,s=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<i;){var l,u,c;for(t=new n.BufferGeometry,t.name=a,s.push(t),l=this.readU32(),u=this._ptr+l,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<u;){var h=0,d=this.readU8(),p=(this.readU8(),this.readU32()),f=p+this._ptr;if(1===d)for(r=new Float32Array(p/12*3),c=new n.BufferAttribute(r,3),t.addAttribute("position",c),h=0;this._ptr<f;)r[h]=-this.readF32(),r[h+1]=this.readF32(),r[h+2]=this.readF32(),h+=3;else if(2===d)for(r=new Uint16Array(p/2),c=new n.BufferAttribute(r,1),t.setIndex(c),h=0;this._ptr<f;)r[h+1]=this.readU16(),r[h]=this.readU16(),r[h+2]=this.readU16(),h+=3;else if(3===d)for(r=new Float32Array(p/8*2),c=new n.BufferAttribute(r,2),t.addAttribute("uv",c),h=0;this._ptr<f;)r[h]=this.readF32(),r[h+1]=1-this.readF32(),h+=2;else if(4===d)for(r=new Float32Array(p/12*3),c=new n.BufferAttribute(r,3),t.addAttribute("normal",c),h=0;this._ptr<f;)r[h]=-this.readF32(),r[h+1]=this.readF32(),r[h+2]=this.readF32(),h+=3;else this._ptr=f}this.parseUserAttributes(),t.computeBoundingSphere(),o++}return this.parseUserAttributes(),s},parseMeshPoseAnimation:function(e,t){var r,a,n,i,o,s,l,u,c,h=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null===v)return void console.log("parseMeshPoseAnimation target mesh not found at:",m);for(s=v.geometry,s.morphTargets=[],t||(h=this.readU16()),r=this.readU16(),l=this.readU16(),u=0;u<l;)f.push(this.readU16()),u++;for(c=this.parseProperties({1:21,2:21}),p.looping=c.get(1,!0),p.stitchFinalFrame=c.get(2,!1),a=0;a<h;){for(this.readU16(),n=0;n<r;)for(u=0,i=this.readU32(),o=this._ptr+i;u<l;){if(1===f[u]){var g=new Float32Array(i/4);for(s.morphTargets.push({array:g}),d=0;this._ptr<o;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;n++}else this._ptr=o;u++}a++}return this.parseUserAttributes(),null},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new n.Matrix4,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var r=this.readU32(),a=this._ptr+r,n=new t;if(e)for(;this._ptr<a;){var i,o=this.readU16(),s=this.readU32();e.hasOwnProperty(o)?(i=e[o],n.set(o,this.parseAttrValue(i,s))):this._ptr+=s}return n},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,t){var r,a;switch(e){case 1:r=1,a=this.readI8;break;case 2:r=2,a=this.readI16;break;case 3:r=4,a=this.readI32;break;case 21:case 4:r=1,a=this.readU8;break;case 5:r=2,a=this.readU16;break;case 6:case 23:r=4,a=this.readU32;break;case 7:r=4,a=this.readF32;break;case 8:r=8,a=this.readF64;break;case 41:case 42:case 43:case 44:case 45:case 46:case 47:r=8,a=this.readF64}if(r<t){var n,i,o;for(n=[],i=0,o=t/r;i<o;)n.push(a.call(this)),i++;return n}return a.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var e=this._data.getUint16(this._ptr,!0);return this._ptr+=2,e},readI16:function(){var e=this._data.getInt16(this._ptr,!0);return this._ptr+=2,e},readU32:function(){var e=this._data.getUint32(this._ptr,!0);return this._ptr+=4,e},readI32:function(){var e=this._data.getInt32(this._ptr,!0);return this._ptr+=4,e},readF32:function(){var e=this._data.getFloat32(this._ptr,!0);return this._ptr+=4,e},readF64:function(){var e=this._data.getFloat64(this._ptr,!0);return this._ptr+=8,e},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],r=0;t.length<e;){var a=this._data.getUint8(this._ptr++,!0);if(a<128)t[r++]=String.fromCharCode(a);else if(a>191&&a<224){var n=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((31&a)<<6|63&n)}else{var n=this._data.getUint8(this._ptr++,!0),i=this._data.getUint8(this._ptr++,!0);t[r++]=String.fromCharCode((15&a)<<12|(63&n)<<6|63&i)}}return t.join("")}}}(),t.default=n.AWDLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.BabylonLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.BabylonLoader.prototype={constructor:n.BabylonLoader,load:function(e,t,r,a){var i=this;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,a)},parse:function(e){function t(e){var t=new n.BufferGeometry,r=e.indices,a=e.positions,i=e.normals,o=e.uvs;t.setIndex(r);for(var s=2,l=a.length;s<l;s+=3)a[s]=-a[s];if(t.addAttribute("position",new n.Float32BufferAttribute(a,3)),i){for(var s=2,l=i.length;s<l;s+=3)i[s]=-i[s];t.addAttribute("normal",new n.Float32BufferAttribute(i,3))}o&&t.addAttribute("uv",new n.Float32BufferAttribute(o,2));var u=e.subMeshes;if(u)for(var s=0,l=u.length;s<l;s++){var c=u[s];t.addGroup(c.indexStart,c.indexCount)}return t}var r=function(e){for(var t={},r=0,a=e.materials.length;r<a;r++){var i=e.materials[r],o=new n.MeshPhongMaterial;o.name=i.name,o.color.fromArray(i.diffuse),o.emissive.fromArray(i.emissive),o.specular.fromArray(i.specular),o.shininess=i.specularPower,o.opacity=i.alpha,t[i.id]=o}if(e.multiMaterials)for(var r=0,a=e.multiMaterials.length;r<a;r++){var i=e.multiMaterials[r];console.warn("THREE.BabylonLoader: Multi materials not yet supported."),t[i.id]=new n.MeshPhongMaterial}return t}(e);return function(e,r){for(var a={},i=new n.Scene,o=e.cameras,s=0,l=o.length;s<l;s++){var u=o[s],c=new n.PerspectiveCamera(u.fov/Math.PI*180,1.33,u.minZ,u.maxZ);c.name=u.name,c.position.fromArray(u.position),u.rotation&&c.rotation.fromArray(u.rotation),a[u.id]=c}for(var h=e.lights,s=0,l=h.length;s<l;s++){var d,u=h[s];switch(u.type){case 0:d=new n.PointLight;break;case 1:d=new n.DirectionalLight;break;case 2:d=new n.SpotLight;break;case 3:d=new n.HemisphereLight}d.name=u.name,u.position&&d.position.set(u.position[0],u.position[1],-u.position[2]),d.color.fromArray(u.diffuse),u.groundColor&&d.groundColor.fromArray(u.groundColor),u.intensity&&(d.intensity=u.intensity),a[u.id]=d,i.add(d)}for(var p=e.meshes,s=0,l=p.length;s<l;s++){var f,u=p[s];if(u.indices){var m=t(u);f=new n.Mesh(m,r[u.materialId])}else f=new n.Group;f.name=u.name,f.position.set(u.position[0],u.position[1],-u.position[2]),f.rotation.fromArray(u.rotation),u.rotationQuaternion&&f.quaternion.fromArray(u.rotationQuaternion),f.scale.fromArray(u.scaling),u.parentId?a[u.parentId].add(f):i.add(f),a[u.id]=f}return i}(e,r)}},t.default=n.BabylonLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.BinaryLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.BinaryLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:n.DefaultLoadingManager},n.BinaryLoader.prototype={constructor:n.BinaryLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this.texturePath||n.LoaderUtils.extractUrlBase(e),o=this.binaryPath||n.LoaderUtils.extractUrlBase(e),s=this;new n.FileLoader(this.manager).load(e,function(e){var l=JSON.parse(e),u=o+l.buffers,c=new n.FileLoader(s.manager);c.setResponseType("arraybuffer"),c.load(u,function(e){s.parse(e,t,i,l.materials)},r,a)},r,a)},setBinaryPath:function(e){this.binaryPath=e},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t,r,a){var i=function(){function t(e){return e%4?4-e%4:0}function r(e,t,r){return n.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function a(e,t){return new Uint8Array(e,t,1)[0]}function i(e,t){return new Uint32Array(e,t,1)[0]}function o(t,r){var a,i,o,s,l,u,c,h,d,p,f=new Uint32Array(e,r,3*t);for(a=0;a<t;a++)i=f[3*a],o=f[3*a+1],s=f[3*a+2],l=F[2*i],h=F[2*i+1],u=F[2*o],d=F[2*o+1],c=F[2*s],p=F[2*s+1],C.faceVertexUvs[0].push([new n.Vector2(l,h),new n.Vector2(u,d),new n.Vector2(c,p)])}function s(t,r){var a,i,o,s,l,u,c,h,d,p,f,m,v,g=new Uint32Array(e,r,4*t);for(a=0;a<t;a++)i=g[4*a],o=g[4*a+1],s=g[4*a+2],l=g[4*a+3],u=F[2*i],p=F[2*i+1],c=F[2*o],f=F[2*o+1],h=F[2*s],m=F[2*s+1],d=F[2*l],v=F[2*l+1],C.faceVertexUvs[0].push([new n.Vector2(u,p),new n.Vector2(c,f),new n.Vector2(d,v)]),C.faceVertexUvs[0].push([new n.Vector2(c,f),new n.Vector2(h,m),new n.Vector2(d,v)])}function l(t,r,a){var i,o,s,l,u,c=new Uint32Array(e,r,3*t),h=new Uint16Array(e,a,t);for(i=0;i<t;i++)o=c[3*i],s=c[3*i+1],l=c[3*i+2],u=h[i],C.faces.push(new n.Face3(o,s,l,null,null,u))}function u(t,r,a){var i,o,s,l,u,c,h=new Uint32Array(e,r,4*t),d=new Uint16Array(e,a,t);for(i=0;i<t;i++)o=h[4*i],s=h[4*i+1],l=h[4*i+2],u=h[4*i+3],c=d[i],C.faces.push(new n.Face3(o,s,u,null,null,c)),C.faces.push(new n.Face3(s,l,u,null,null,c))}function c(t,r,a,i){var o,s,l,u,c,h,d,p,f=new Uint32Array(e,r,3*t),m=new Uint32Array(e,a,3*t),v=new Uint16Array(e,i,t);for(o=0;o<t;o++){s=f[3*o],l=f[3*o+1],u=f[3*o+2],h=m[3*o],d=m[3*o+1],p=m[3*o+2],c=v[o];var g=O[3*h],y=O[3*h+1],b=O[3*h+2],w=O[3*d],A=O[3*d+1],M=O[3*d+2],x=O[3*p],L=O[3*p+1],E=O[3*p+2];C.faces.push(new n.Face3(s,l,u,[new n.Vector3(g,y,b),new n.Vector3(w,A,M),new n.Vector3(x,L,E)],null,c))}}function h(t,r,a,i){var o,s,l,u,c,h,d,p,f,m,v=new Uint32Array(e,r,4*t),g=new Uint32Array(e,a,4*t),y=new Uint16Array(e,i,t);for(o=0;o<t;o++){s=v[4*o],l=v[4*o+1],u=v[4*o+2],c=v[4*o+3],d=g[4*o],p=g[4*o+1],f=g[4*o+2],m=g[4*o+3],h=y[o];var b=O[3*d],w=O[3*d+1],A=O[3*d+2],M=O[3*p],x=O[3*p+1],L=O[3*p+2],E=O[3*f],T=O[3*f+1],k=O[3*f+2],_=O[3*m],N=O[3*m+1],S=O[3*m+2];C.faces.push(new n.Face3(s,l,c,[new n.Vector3(b,w,A),new n.Vector3(M,x,L),new n.Vector3(_,N,S)],null,h)),C.faces.push(new n.Face3(l,u,c,[new n.Vector3(M,x,L),new n.Vector3(E,T,k),new n.Vector3(_,N,S)],null,h))}}var d,p,f,m,v,g,y,b,w,A,M,x,L,E,T,k,_,N,C=this,S=0,O=[],F=[];n.Geometry.call(this),d=function(e,t){return{signature:r(e,t,12),header_bytes:a(e,t+12),vertex_coordinate_bytes:a(e,t+13),normal_coordinate_bytes:a(e,t+14),uv_coordinate_bytes:a(e,t+15),vertex_index_bytes:a(e,t+16),normal_index_bytes:a(e,t+17),uv_index_bytes:a(e,t+18),material_index_bytes:a(e,t+19),nvertices:i(e,t+20),nnormals:i(e,t+20+4),nuvs:i(e,t+20+8),ntri_flat:i(e,t+20+12),ntri_smooth:i(e,t+20+16),ntri_flat_uv:i(e,t+20+20),ntri_smooth_uv:i(e,t+20+24),nquad_flat:i(e,t+20+28),nquad_smooth:i(e,t+20+32),nquad_flat_uv:i(e,t+20+36),nquad_smooth_uv:i(e,t+20+40)}}(e,S),S+=d.header_bytes,A=3*d.vertex_index_bytes+d.material_index_bytes,M=4*d.vertex_index_bytes+d.material_index_bytes,x=d.ntri_flat*A,L=d.ntri_smooth*(A+3*d.normal_index_bytes),E=d.ntri_flat_uv*(A+3*d.uv_index_bytes),T=d.ntri_smooth_uv*(A+3*d.normal_index_bytes+3*d.uv_index_bytes),k=d.nquad_flat*M,_=d.nquad_smooth*(M+4*d.normal_index_bytes),N=d.nquad_flat_uv*(M+4*d.uv_index_bytes),S+=function(t){var r,a,i,o,s=d.nvertices,l=new Float32Array(e,t,3*s);for(r=0;r<s;r++)a=l[3*r],i=l[3*r+1],o=l[3*r+2],C.vertices.push(new n.Vector3(a,i,o));return 3*s*Float32Array.BYTES_PER_ELEMENT}(S),S+=function(t){var r=d.nnormals;if(r){var a,n,i,o,s=new Int8Array(e,t,3*r);for(a=0;a<r;a++)n=s[3*a],i=s[3*a+1],o=s[3*a+2],O.push(n/127,i/127,o/127)}return 3*r*Int8Array.BYTES_PER_ELEMENT}(S),S+=t(3*d.nnormals),S+=function(t){var r=d.nuvs;if(r){var a,n,i,o=new Float32Array(e,t,2*r);for(a=0;a<r;a++)n=o[2*a],i=o[2*a+1],F.push(n,i)}return 2*r*Float32Array.BYTES_PER_ELEMENT}(S),p=S,f=p+x+t(2*d.ntri_flat),m=f+L+t(2*d.ntri_smooth),v=m+E+t(2*d.ntri_flat_uv),g=v+T+t(2*d.ntri_smooth_uv),y=g+k+t(2*d.nquad_flat),b=y+_+t(2*d.nquad_smooth),w=b+N+t(2*d.nquad_flat_uv),function(e){var t=d.ntri_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3;l(t,e,r+t*Uint32Array.BYTES_PER_ELEMENT*3),o(t,r)}}(m),function(e){var t=d.ntri_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3,a=r+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,r,a+t*Uint32Array.BYTES_PER_ELEMENT*3),o(t,a)}}(v),function(e){var t=d.nquad_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4;u(t,e,r+t*Uint32Array.BYTES_PER_ELEMENT*4),s(t,r)}}(b),function(e){var t=d.nquad_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4,a=r+t*Uint32Array.BYTES_PER_ELEMENT*4;h(t,e,r,a+t*Uint32Array.BYTES_PER_ELEMENT*4),s(t,a)}}(w),function(e){var t=d.ntri_flat;t&&l(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*3)}(p),function(e){var t=d.ntri_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3;c(t,e,r,r+t*Uint32Array.BYTES_PER_ELEMENT*3)}}(f),function(e){var t=d.nquad_flat;t&&u(t,e,e+t*Uint32Array.BYTES_PER_ELEMENT*4)}(g),function(e){var t=d.nquad_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4;h(t,e,r,r+t*Uint32Array.BYTES_PER_ELEMENT*4)}}(y),this.computeFaceNormals()};i.prototype=Object.create(n.Geometry.prototype),i.prototype.constructor=i,t(new i,n.Loader.prototype.initMaterials(a,r,this.crossOrigin))}},t.default=n.BinaryLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.BVHLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.animateBonePositions=!0,this.animateBoneRotations=!0},n.BVHLoader.prototype={constructor:n.BVHLoader,load:function(e,t,r,a){var i=this;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e,r,a){if("ENDSITE"!==a.type){var i={time:r,position:new n.Vector3,rotation:new n.Quaternion};a.frames.push(i);for(var o=new n.Quaternion,s=new n.Vector3(1,0,0),l=new n.Vector3(0,1,0),u=new n.Vector3(0,0,1),c=0;c<a.channels.length;c++)switch(a.channels[c]){case"Xposition":i.position.x=parseFloat(e.shift().trim());break;case"Yposition":i.position.y=parseFloat(e.shift().trim());break;case"Zposition":i.position.z=parseFloat(e.shift().trim());break;case"Xrotation":o.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(l,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(u,parseFloat(e.shift().trim())*Math.PI/180),i.rotation.multiply(o);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(var c=0;c<a.children.length;c++)t(e,r,a.children[c])}}function r(e,t,a){var o={name:"",type:"",frames:[]};a.push(o);var s=t.split(/[\s]+/);"END"===s[0].toUpperCase()&&"SITE"===s[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=s[1],o.type=s[0].toUpperCase()),"{"!==i(e)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),s=i(e).split(/[\s]+/),"OFFSET"!==s[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+s[0]),4!==s.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var l=new n.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));if((isNaN(l.x)||isNaN(l.y)||isNaN(l.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),o.offset=l,"ENDSITE"!==o.type){s=i(e).split(/[\s]+/),"CHANNELS"!==s[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var u=parseInt(s[1]);o.channels=s.splice(2,u),o.children=[]}for(;;){var c=i(e);if("}"===c)return o;o.children.push(r(e,c,a))}}function a(e,t){var r=new n.Bone;if(t.push(r),r.position.add(e.offset),r.name=e.name,"ENDSITE"!==e.type)for(var i=0;i<e.children.length;i++)r.add(a(e.children[i],t));return r}function i(e){for(var t;0===(t=e.shift().trim()).length;);return t}var o=this,s=e.split(/[\r\n]+/g),l=function(e){"HIERARCHY"!==i(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var a=[],n=r(e,i(e),a);"MOTION"!==i(e)&&console.error("THREE.BVHLoader: MOTION expected.");var o=i(e).split(/[\s]+/),s=parseInt(o[1]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read number of frames."),o=i(e).split(/[\s]+/);var l=parseFloat(o[2]);isNaN(l)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var u=0;u<s;u++)o=i(e).split(/[\s]+/),t(o,u*l,n);return a}(s),u=[];a(l[0],u);var c=function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r];if("ENDSITE"!==a.type){for(var i=[],s=[],l=[],u=0;u<a.frames.length;u++){var c=a.frames[u];i.push(c.time),s.push(c.position.x+a.offset.x),s.push(c.position.y+a.offset.y),s.push(c.position.z+a.offset.z),l.push(c.rotation.x),l.push(c.rotation.y),l.push(c.rotation.z),l.push(c.rotation.w)}o.animateBonePositions&&t.push(new n.VectorKeyframeTrack(".bones["+a.name+"].position",i,s)),o.animateBoneRotations&&t.push(new n.QuaternionKeyframeTrack(".bones["+a.name+"].quaternion",i,l))}}return new n.AnimationClip("animation",-1,t)}(l);return{skeleton:new n.Skeleton(u),clip:c}}},t.default=n.BVHLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.ColladaLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.ColladaLoader.prototype={constructor:n.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this,o=void 0===i.path?n.LoaderUtils.extractUrlBase(e):i.path;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(e,o))},r,a)},setPath:function(e){this.path=e},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=[],a=e.childNodes,n=0,i=a.length;n<i;n++){var o=a[n];o.nodeName===t&&r.push(o)}return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=t[a];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseFloat(t[a]);return r}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseInt(t[a]);return r}function s(e){return e.substring(1)}function l(){return"three_default_"+st++}function u(e){return 0===Object.keys(e).length}function c(e){return void 0!==e?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function d(e,t,a,n){var i=r(e,t)[0];if(void 0!==i)for(var o=r(i,a),s=0;s<o.length;s++)n(o[s])}function p(e,t){for(var r in e){e[r].build=t(e[r])}}function f(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function m(e){for(var t={sources:{},samplers:{},channels:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType){var i;switch(n.nodeName){case"source":i=n.getAttribute("id"),t.sources[i]=me(n);break;case"sampler":i=n.getAttribute("id"),t.samplers[i]=v(n);break;case"channel":i=n.getAttribute("target"),t.channels[i]=g(n);break;default:console.log(n)}}}lt.animations[e.getAttribute("id")]=t}function v(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=s(n.getAttribute("source")),o=n.getAttribute("semantic");t.inputs[o]=i}}return t}function g(e){var t={},r=e.getAttribute("target"),a=r.split("/"),n=a.shift(),i=a.shift(),o=-1!==i.indexOf("("),l=-1!==i.indexOf(".");if(l)a=i.split("."),i=a.shift(),t.member=a.shift();else if(o){var u=i.split("(");i=u.shift();for(var c=0;c<u.length;c++)u[c]=parseInt(u[c].replace(/\)/,""));t.indices=u}return t.id=n,t.sid=i,t.arraySyntax=o,t.memberSyntax=l,t.sampler=s(e.getAttribute("source")),t}function y(e){var t=[],r=e.channels,a=e.samplers,n=e.sources;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i],s=a[o.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT,c=n[l],h=n[u],d=w(o,c,h);M(d,t)}return t}function b(e){return f(lt.animations[e],y)}function w(e,t,r){var a,n,i,o,s,l,u=lt.nodes[e.id],c=Ye(u.id),h=u.transforms[e.sid],d=u.matrix.clone().transpose(),p={};switch(h){case"matrix":for(i=0,o=t.array.length;i<o;i++)if(a=t.array[i],n=i*r.stride,void 0===p[a]&&(p[a]={}),!0===e.arraySyntax){var f=r.array[n],m=e.indices[0]+4*e.indices[1];p[a][m]=f}else for(s=0,l=r.stride;s<l;s++)p[a][s]=r.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=A(p,d);return{name:c.uuid,keyframes:v}}function A(e,t){function r(e,t){return e.time-t.time}var a=[];for(var n in e)a.push({time:parseFloat(n),value:e[n]});a.sort(r);for(var i=0;i<16;i++)x(a,i,t.elements[i]);return a}function M(e,t){for(var r=e.keyframes,a=e.name,i=[],o=[],s=[],l=[],u=0,c=r.length;u<c;u++){var h=r[u],d=h.time,p=h.value;Je.fromArray(p).transpose(),Je.decompose(Qe,qe,Ze),i.push(d),o.push(Qe.x,Qe.y,Qe.z),s.push(qe.x,qe.y,qe.z,qe.w),l.push(Ze.x,Ze.y,Ze.z)}return o.length>0&&t.push(new n.VectorKeyframeTrack(a+".position",i,o)),s.length>0&&t.push(new n.QuaternionKeyframeTrack(a+".quaternion",i,s)),l.length>0&&t.push(new n.VectorKeyframeTrack(a+".scale",i,l)),t}function x(e,t,r){var a,n,i,o=!0;for(n=0,i=e.length;n<i;n++)a=e[n],void 0===a.value[t]?a.value[t]=null:o=!1;if(!0===o)for(n=0,i=e.length;n<i;n++)a=e[n],a.value[t]=r;else L(e,t)}function L(e,t){for(var r,a,n=0,i=e.length;n<i;n++){var o=e[n];if(null===o.value[t]){if(r=E(e,n,t),a=T(e,n,t),null===r){o.value[t]=a.value[t];continue}if(null===a){o.value[t]=r.value[t];continue}k(o,r,a,t)}}}function E(e,t,r){for(;t>=0;){var a=e[t];if(null!==a.value[r])return a;t--}return null}function T(e,t,r){for(;t<e.length;){var a=e[t];if(null!==a.value[r])return a;t++}return null}function k(e,t,r,a){if(r.time-t.time==0)return void(e.value[a]=t.value[a]);e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]}function _(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(s(n.getAttribute("url")))}}lt.clips[e.getAttribute("id")]=t}function N(e){for(var t=[],r=e.name,a=e.end-e.start||-1,i=e.animations,o=0,s=i.length;o<s;o++)for(var l=b(i[o]),u=0,c=l.length;u<c;u++)t.push(l[u]);return new n.AnimationClip(r,a,t)}function C(e){return f(lt.clips[e],N)}function S(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=O(n);break;case"morph":t.id=s(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}lt.controllers[e.getAttribute("id")]=t}function O(e){for(var t={sources:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(n.textContent);break;case"source":var o=n.getAttribute("id");t.sources[o]=me(n);break;case"joints":t.joints=F(n);break;case"vertex_weights":t.vertexWeights=P(n)}}return t}function F(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=n.getAttribute("semantic"),o=s(n.getAttribute("source"));t.inputs[i]=o}}return t}function P(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=n.getAttribute("semantic"),l=s(n.getAttribute("source")),u=parseInt(n.getAttribute("offset"));t.inputs[i]={id:l,offset:u};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function R(e){var t={id:e.id},r=lt.geometries[t.id];return void 0!==e.skin&&(t.skin=I(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function I(e){function t(e,t){return t.weight-e.weight}var r,a,i,o={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},s=e.sources,l=e.vertexWeights,u=l.vcount,c=l.v,h=l.inputs.JOINT.offset,d=l.inputs.WEIGHT.offset,p=e.sources[e.joints.inputs.JOINT],f=e.sources[e.joints.inputs.INV_BIND_MATRIX],m=s[l.inputs.WEIGHT.id].array,v=0;for(r=0,i=u.length;r<i;r++){var g=u[r],y=[];for(a=0;a<g;a++){var b=c[v+h],w=c[v+d],A=m[w];y.push({index:b,weight:A}),v+=2}for(y.sort(t),a=0;a<4;a++){var M=y[a];void 0!==M?(o.indices.array.push(M.index),o.weights.array.push(M.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}for(o.bindMatrix=(new n.Matrix4).fromArray(e.bindShapeMatrix).transpose(),r=0,i=p.array.length;r<i;r++){var x=p.array[r],L=(new n.Matrix4).fromArray(f.array,r*f.stride).transpose();o.joints.push({name:x,boneInverse:L})}return o}function B(e){return f(lt.controllers[e],R)}function D(e){var t={init_from:r(e,"init_from")[0].textContent};lt.images[e.getAttribute("id")]=t}function V(e){return void 0!==e.build?e.build:e.init_from}function j(e){return f(lt.images[e],V)}function U(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=G(n)}}lt.effects[e.getAttribute("id")]=t}function G(e){for(var t={surfaces:{},samplers:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":z(n,t);break;case"technique":t.technique=X(n)}}return t}function z(e,t){for(var r=e.getAttribute("sid"),a=0,n=e.childNodes.length;a<n;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[r]=H(i);break;case"sampler2D":t.samplers[r]=Y(i)}}}function H(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function Y(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function X(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=W(n)}}return t}function W(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":t[n.nodeName]=K(n)}}return t}function K(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=i(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:Q(n)}}}return t}function Q(e){for(var t={technique:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":Z(n,t)}}return t}function Z(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":q(n,t)}}}function q(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function J(e){return e}function $(e){return f(lt.effects[e],J)}function ee(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=s(n.getAttribute("url"))}}lt.materials[e.getAttribute("id")]=t}function te(e){function t(e){var t,r=a.profile.samplers[e.id];if(void 0!==r){t=j(a.profile.surfaces[r.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),t=j(e.id);if(void 0!==t){var i=nt.load(t),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===u(o.technique)){var s=o.technique;i.wrapS=s.wrapU?n.RepeatWrapping:n.ClampToEdgeWrapping,i.wrapT=s.wrapV?n.RepeatWrapping:n.ClampToEdgeWrapping,i.offset.set(s.offsetU||0,s.offsetV||0),i.repeat.set(s.repeatU||1,s.repeatV||1)}else i.wrapS=n.RepeatWrapping,i.wrapT=n.RepeatWrapping;return i}return console.error("THREE.ColladaLoader: Unable to load texture with ID:",e.id),null}var r,a=$(e.url),i=a.profile.technique;switch(i.type){case"phong":case"blinn":r=new n.MeshPhongMaterial;break;case"lambert":r=new n.MeshLambertMaterial;break;default:r=new n.MeshBasicMaterial}r.name=e.name;var o=i.parameters;for(var s in o){var l=o[s];switch(s){case"diffuse":l.color&&r.color.fromArray(l.color),l.texture&&(r.map=t(l.texture));break;case"specular":l.color&&r.specular&&r.specular.fromArray(l.color),l.texture&&(r.specularMap=t(l.texture));break;case"shininess":l.float&&r.shininess&&(r.shininess=l.float);break;case"emission":l.color&&r.emissive&&r.emissive.fromArray(l.color);break;case"transparent":r.transparent=!0;break;case"transparency":void 0!==l.float&&(r.opacity=l.float),r.transparent=!0}}return r}function re(e){return f(lt.materials[e],te)}function ae(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=ne(n)}}lt.cameras[e.getAttribute("id")]=t}function ne(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return ie(r)}}return{}}function ie(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"perspective":case"orthographic":t.technique=a.nodeName,t.parameters=oe(a)}}return t}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[a.nodeName]=parseFloat(a.textContent)}}return t}function se(e){var t;switch(e.optics.technique){case"perspective":t=new n.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,a=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;a=void 0===a?r*i:a,r=void 0===r?a/i:r,a*=.5,r*=.5,t=new n.OrthographicCamera(-a,a,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new n.PerspectiveCamera}return t.name=e.name,t}function le(e){var t=lt.cameras[e];return void 0!==t?f(t,se):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ue(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=ce(n)}}lt.lights[e.getAttribute("id")]=t}function ce(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=he(n)}}return t}function he(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var s=i(o.textContent);t.color=(new n.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var l=parseFloat(o.textContent);t.distance=l?Math.sqrt(1/l):0}}return t}function de(e){var t;switch(e.technique){case"directional":t=new n.DirectionalLight;break;case"point":t=new n.PointLight;break;case"spot":t=new n.SpotLight;break;case"ambient":t=new n.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function pe(e){var t=lt.lights[e];return void 0!==t?f(t,de):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function fe(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},a=r(e,"mesh")[0];if(void 0!==a){for(var n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if(1===i.nodeType){var o=i.getAttribute("id");switch(i.nodeName){case"source":t.sources[o]=me(i);break;case"vertices":t.vertices=ve(i);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",i.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ge(i));break;default:console.log(i)}}}lt.geometries[e.getAttribute("id")]=t}}function me(e){for(var t={array:[],stride:3},n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=a(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ve(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];1===a.nodeType&&(t[a.getAttribute("semantic")]=s(a.getAttribute("source")))}return t}function ge(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var i=s(n.getAttribute("source")),l=n.getAttribute("semantic"),u=parseInt(n.getAttribute("offset"));t.inputs[l]={id:i,offset:u},t.stride=Math.max(t.stride,u+1);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function ye(e){for(var t={},r=0;r<e.length;r++){var a=e[r];void 0===t[a.type]&&(t[a.type]=[]),t[a.type].push(a)}return t}function be(e){var t={},r=e.sources,a=e.vertices,n=e.primitives;if(0===n.length)return{};var i=ye(n);for(var o in i)t[o]=we(i[o],r,a);return t}function we(e,t,r){for(var a={},i={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u={array:[],stride:4},c={array:[],stride:4},h=new n.BufferGeometry,d=[],p=0,f=0,m=0;m<e.length;m++){var v=e[m],g=v.inputs,y=1;v.vcount&&4===v.vcount[0]&&(y=2),f="lines"===v.type||"linestrips"===v.type?2*v.count:3*v.count*y,h.addGroup(p,f,m),p+=f,v.material&&d.push(v.material);for(var b in g){var w=g[b];switch(b){case"VERTEX":for(var A in r){var M=r[A];switch(A){case"POSITION":Ae(v,t[M],w.offset,i.array),i.stride=t[M].stride,t.skinWeights&&t.skinIndices&&(Ae(v,t.skinIndices,w.offset,u.array),Ae(v,t.skinWeights,w.offset,c.array));break;case"NORMAL":Ae(v,t[M],w.offset,o.array),o.stride=t[M].stride;break;case"COLOR":Ae(v,t[M],w.offset,l.array),l.stride=t[M].stride;break;case"TEXCOORD":Ae(v,t[M],w.offset,s.array),s.stride=t[M].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',A)}}break;case"NORMAL":Ae(v,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":Ae(v,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":Ae(v,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&h.addAttribute("position",new n.Float32BufferAttribute(i.array,i.stride)),o.array.length>0&&h.addAttribute("normal",new n.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&h.addAttribute("color",new n.Float32BufferAttribute(l.array,l.stride)),s.array.length>0&&h.addAttribute("uv",new n.Float32BufferAttribute(s.array,s.stride)),u.array.length>0&&h.addAttribute("skinIndex",new n.Float32BufferAttribute(u.array,u.stride)),c.array.length>0&&h.addAttribute("skinWeight",new n.Float32BufferAttribute(c.array,c.stride)),a.data=h,a.type=e[0].type,a.materialKeys=d,a}function Ae(e,t,r,a){function n(e){for(var t=i[e+r]*c,n=t+c;t<n;t++)a.push(u[t])}var i=e.p,o=e.stride,s=e.vcount,l=0,u=t.array,c=t.stride;if(void 0!==e.vcount){for(var h=0,d=0,p=s.length;d<p;d++){var f=s[d];if(4===f){var m=h+0*o,v=h+1*o,g=h+2*o,y=h+3*o;n(m),n(v),n(y),n(v),n(g),n(y)}else if(3===f){var m=h+0*o,v=h+1*o,g=h+2*o;n(m),n(v),n(g)}else l=Math.max(l,f);h+=o*f}l>0&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(var d=0,p=i.length;d<p;d+=o)n(d)}function Me(e){return f(lt.geometries[e],be)}function xe(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"technique_common":Te(a,t)}}lt.kinematicsModels[e.getAttribute("id")]=t}function Le(e){return void 0!==e.build?e.build:e}function Ee(e){return f(lt.kinematicsModels[e],Le)}function Te(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"joint":t.joints[a.getAttribute("sid")]=ke(a);break;case"link":t.links.push(Ne(a))}}}function ke(e){for(var t,r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"prismatic":case"revolute":t=_e(a)}}return t}function _e(e,t){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new n.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var o=i(a.textContent);t.axis.fromArray(o);break;case"limits":var s=a.getElementsByTagName("max")[0],l=a.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(l.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Ne(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"attachment_full":t.attachments.push(Ce(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Se(a))}}return t}function Ce(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"link":t.links.push(Ne(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Se(a))}}return t}function Se(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new n.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new n.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new n.Vector3,t.obj.fromArray(r),t.angle=n.Math.degToRad(r[3])}return t}function Oe(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Fe(a))}}lt.kinematicsScenes[s(e.getAttribute("url"))]=t}function Fe(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var n=a.getElementsByTagName("param")[0];t.axis=n.textContent;var i=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=i.substr(0,i.length-1)}}return t}function Pe(e){return void 0!==e.build?e.build:e}function Re(e){return f(lt.kinematicsScenes[e],Pe)}function Ie(e){for(var t=[],r=tt.querySelector('[id="'+e.id+'"]'),a=0;a<r.childNodes.length;a++){var o=r.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=i(o.textContent),l=(new n.Matrix4).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"translate":case"scale":var s=i(o.textContent),u=(new n.Vector3).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:u});break;case"rotate":var s=i(o.textContent),u=(new n.Vector3).fromArray(s),c=n.Math.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:u,angle:c})}}return t}function Be(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var a=t[r];!1===a.hasAttribute("id")&&a.setAttribute("id",l())}}function De(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new n.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"node":t.nodes.push(a.getAttribute("id")),De(a);break;case"instance_camera":t.instanceCameras.push(s(a.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ve(a));break;case"instance_light":t.instanceLights.push(s(a.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ve(a));break;case"instance_node":t.instanceNodes.push(s(a.getAttribute("url")));break;case"matrix":var o=i(a.textContent);t.matrix.multiply(Je.fromArray(o).transpose()),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":var o=i(a.textContent);$e.fromArray(o),t.matrix.multiply(Je.makeTranslation($e.x,$e.y,$e.z)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":var o=i(a.textContent),l=n.Math.degToRad(o[3]);t.matrix.multiply(Je.makeRotationAxis($e.fromArray(o),l)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":var o=i(a.textContent);t.matrix.scale($e.fromArray(o)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return lt.nodes[t.id]=t,t}function Ve(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"bind_material":for(var n=a.getElementsByTagName("instance_material"),i=0;i<n.length;i++){var o=n[i],l=o.getAttribute("symbol"),u=o.getAttribute("target");t.materials[l]=s(u)}break;case"skeleton":t.skeletons.push(s(a.textContent))}}return t}function je(e,t){var r,a,i,o=[],s=[];for(r=0;r<e.length;r++){Ue(Ye(e[r]),t,o)}for(r=0;r<t.length;r++)for(a=0;a<o.length;a++)if(i=o[a],i.bone.name===t[r].name){s[r]=i,i.processed=!0;break}for(r=0;r<o.length;r++)i=o[r],!1===i.processed&&(s.push(i),i.processed=!0);var l=[],u=[];for(r=0;r<s.length;r++)i=s[r],l.push(i.bone),u.push(i.boneInverse);return new n.Skeleton(l,u)}function Ue(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var a,i=0;i<t.length;i++){var o=t[i];if(o.name===e.name){a=o.boneInverse;break}}void 0===a&&(a=new n.Matrix4),r.push({bone:e,boneInverse:a,processed:!1})}})}function Ge(e){for(var t=[],r=e.matrix,a=e.nodes,i=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,u=e.instanceGeometries,c=e.instanceNodes,h=0,d=a.length;h<d;h++)t.push(Ye(a[h]));for(var h=0,d=o.length;h<d;h++){var p=le(o[h]);null!==p&&t.push(p.clone())}for(var h=0,d=s.length;h<d;h++)for(var f=s[h],m=B(f.id),v=Me(m.id),g=He(v,f.materials),y=f.skeletons,b=m.skin.joints,w=je(y,b),A=0,M=g.length;A<M;A++){var x=g[A];x.isSkinnedMesh&&(x.bind(w,m.skin.bindMatrix),x.normalizeSkinWeights()),t.push(x)}for(var h=0,d=l.length;h<d;h++){var L=pe(l[h]);null!==L&&t.push(L.clone())}for(var h=0,d=u.length;h<d;h++)for(var f=u[h],v=Me(f.id),g=He(v,f.materials),A=0,M=g.length;A<M;A++)t.push(g[A]);for(var h=0,d=c.length;h<d;h++)t.push(Ye(c[h]).clone());var x;if(0===a.length&&1===t.length)x=t[0];else{x="JOINT"===i?new n.Bone:new n.Group;for(var h=0;h<t.length;h++)x.add(t[h])}return x.name="JOINT"===i?e.sid:e.name,x.matrix.copy(r),x.matrix.decompose(x.position,x.quaternion,x.scale),x}function ze(e,t){for(var r=[],a=0,n=e.length;a<n;a++){var i=t[e[a]];r.push(re(i))}return r}function He(e,t){var r=[];for(var a in e){var i=e[a],o=ze(i.materialKeys,t);0===o.length&&("lines"===a||"linestrips"===a?o.push(new n.LineBasicMaterial):o.push(new n.MeshPhongMaterial));var s=void 0!==i.data.attributes.skinIndex;if(s)for(var l=0,u=o.length;l<u;l++)o[l].skinning=!0;var c,h=1===o.length?o[0]:o;switch(a){case"lines":c=new n.LineSegments(i.data,h);break;case"linestrips":c=new n.Line(i.data,h);break;case"triangles":case"polylist":c=s?new n.SkinnedMesh(i.data,h):new n.Mesh(i.data,h)}r.push(c)}return r}function Ye(e){return f(lt.nodes[e],Ge)}function Xe(e){var t={name:e.getAttribute("name"),children:[]};Be(e);for(var a=r(e,"node"),n=0;n<a.length;n++)t.children.push(De(a[n]));lt.visualScenes[e.getAttribute("id")]=t}function We(e){var t=new n.Group;t.name=e.name;for(var r=e.children,a=0;a<r.length;a++){var i=r[a];null===i.id?t.add(Ge(i)):t.add(Ye(i.id))}return t}function Ke(e){return f(lt.visualScenes[e],We)}var Qe=new n.Vector3,Ze=new n.Vector3,qe=new n.Quaternion,Je=new n.Matrix4,$e=new n.Vector3;if(console.time("THREE.ColladaLoader"),0===e.length)return{scene:new n.Scene};console.time("THREE.ColladaLoader: DOMParser");var et=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var tt=r(et,"COLLADA")[0],rt=tt.getAttribute("version");console.log("THREE.ColladaLoader: File version",rt);var at=function(e){return{unit:c(r(e,"unit")[0]),upAxis:h(r(e,"up_axis")[0])}}(r(tt,"asset")[0]),nt=new n.TextureLoader(this.manager);nt.setPath(t).setCrossOrigin(this.crossOrigin);var it=[],ot={},st=0,lt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),d(tt,"library_animations","animation",m),d(tt,"library_animation_clips","animation_clip",_),d(tt,"library_controllers","controller",S),d(tt,"library_images","image",D),d(tt,"library_effects","effect",U),d(tt,"library_materials","material",ee),d(tt,"library_cameras","camera",ae),d(tt,"library_lights","light",ue),d(tt,"library_geometries","geometry",fe),d(tt,"library_nodes","node",De),d(tt,"library_visual_scenes","visual_scene",Xe),d(tt,"library_kinematics_models","kinematics_model",xe),d(tt,"scene","instance_kinematics_scene",Oe),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),p(lt.animations,y),p(lt.clips,N),p(lt.controllers,R),p(lt.images,V),p(lt.effects,J),p(lt.materials,te),p(lt.cameras,se),p(lt.lights,de),p(lt.geometries,be),p(lt.visualScenes,We),console.timeEnd("THREE.ColladaLoader: Build"),function(){var e=lt.clips;if(!0===u(e)){if(!1===u(lt.animations)){var t=[];for(var r in lt.animations)for(var a=b(r),i=0,o=a.length;i<o;i++)t.push(a[i]);it.push(new n.AnimationClip("default",-1,t))}}else for(var r in e)it.push(C(r))}(),function(){var e=Object.keys(lt.kinematicsModels)[0],t=Object.keys(lt.kinematicsScenes)[0],r=Object.keys(lt.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var a=Ee(e),i=Re(t),o=Ke(r),s=i.bindJointAxis,l={},u=0,c=s.length;u<c;u++){var h=s[u],d=tt.querySelector('[sid="'+h.target+'"]');if(d){var p=d.parentElement;!function(e,t){var r=t.getAttribute("name"),n=a.joints[e];o.traverse(function(a){a.name===r&&(l[e]={object:a,transforms:Ie(t),joint:n,position:n.zeroPosition})})}(h.jointIndex,p)}}var f=new n.Matrix4;ot={joints:a&&a.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var a=r.joint;if(t>a.limits.max||t<a.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+").");else if(a.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,o=a.axis,s=r.transforms;Je.identity();for(var u=0;u<s.length;u++){var c=s[u];if(c.sid&&-1!==c.sid.indexOf(e))switch(a.type){case"revolute":Je.multiply(f.makeRotationAxis(o,n.Math.degToRad(t)));break;case"prismatic":Je.multiply(f.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+a.type)}else switch(c.type){case"matrix":Je.multiply(c.obj);break;case"translate":Je.multiply(f.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":Je.scale(c.obj);break;case"rotate":Je.multiply(f.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(Je),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}}();var ut=function(e){return Ke(s(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(tt,"scene")[0]);return"Z_UP"===at.upAxis&&(ut.rotation.x=-Math.PI/2),ut.scale.multiplyScalar(at.unit),console.timeEnd("THREE.ColladaLoader"),{animations:it,kinematics:ot,library:lt,scene:ut}}},t.default=n.ColladaLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.DDSLoader=function(){this._parser=n.DDSLoader.parse},n.DDSLoader.prototype=Object.create(n.CompressedTextureLoader.prototype),n.DDSLoader.prototype.constructor=n.DDSLoader,n.DDSLoader.parse=function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var a={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},i=r("DXT1"),o=r("DXT3"),s=r("DXT5"),l=r("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),a;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),a;var c,h=u[21],d=!1;switch(h){case i:c=8,a.format=n.RGB_S3TC_DXT1_Format;break;case o:c=16,a.format=n.RGBA_S3TC_DXT3_Format;break;case s:c=16,a.format=n.RGBA_S3TC_DXT5_Format;break;case l:c=8,a.format=n.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(h)),a;d=!0,c=64,a.format=n.RGBAFormat}a.mipmapCount=1,131072&u[2]&&!1!==t&&(a.mipmapCount=Math.max(1,u[7]));var p=u[28];if(a.isCubemap=!!(512&p),a.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),a;a.width=u[4],a.height=u[3];for(var f=u[1]+4,m=a.isCubemap?6:1,v=0;v<m;v++)for(var g=a.width,y=a.height,b=0;b<a.mipmapCount;b++){if(d)var w=function(e,t,r,a){for(var n=r*a*4,i=new Uint8Array(e,t,n),o=new Uint8Array(n),s=0,l=0,u=0;u<a;u++)for(var c=0;c<r;c++){var h=i[l];l++;var d=i[l];l++;var p=i[l];l++;var f=i[l];l++,o[s]=p,s++,o[s]=d,s++,o[s]=h,s++,o[s]=f,s++}return o}(e,f,g,y),A=w.length;else var A=Math.max(4,g)/4*Math.max(4,y)/4*c,w=new Uint8Array(e,f,A);var M={data:w,width:g,height:y};a.mipmaps.push(M),f+=A,g=Math.max(g>>1,1),y=Math.max(y>>1,1)}return a},t.default=n.DDSLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.EXRLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.EXRLoader.prototype=Object.create(n.DataTextureLoader.prototype),n.EXRLoader.prototype._parser=function(e){function t(e,t){for(var r=new Uint8Array(e),a=0;0!=r[t.value+a];)a+=1;var n=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+a));return t.value=t.value+a+1,n}function r(e,t,r){var a=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,a}function a(e,t){var r=new DataView(e.slice(t.value,t.value+4)).getUint32(0,!0);return t.value=t.value+4,r}function i(e,t){var r=new DataView(e.slice(t.value,t.value+1)).getUint8(0,!0);return t.value=t.value+1,r}function o(e,t){var r=new DataView(e.slice(t.value,t.value+4)).getFloat32(0,!0);return t.value+=4,r}function s(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function l(e,r,n){for(var o=r.value,s=[];r.value<o+n-1;){var l=t(e,r),u=a(e,r),c=i(e,r);r.value+=3;var h=a(e,r),d=a(e,r);s.push({name:l,pixelType:u,pLinear:c,xSampling:h,ySampling:d})}return r.value+=1,s}function u(e,t){return{redX:o(e,t),redY:o(e,t),greenX:o(e,t),greenY:o(e,t),blueX:o(e,t),blueY:o(e,t),whiteX:o(e,t),whiteY:o(e,t)}}function c(e,t){return["NO_COMPRESSION","PIZ_COMPRESSION"][i(e,t)]}function h(e,t){return{xMin:a(e,t),yMin:a(e,t),xMax:a(e,t),yMax:a(e,t)}}function d(e,t){return["INCREASING_Y"][i(e,t)]}function p(e,t){return[o(e,t),o(e,t)]}for(var f={},m=(new DataView(e).getUint32(0,!0),new DataView(e).getUint8(4,!0),new DataView(e).getUint8(5,!0),{value:8}),v=!0;v;){var g=t(e,m);if(0==g)v=!1;else{var y=t(e,m),b=a(e,m),w=function(e,t,a,n){if("string"==a||"iccProfile"==a)return r(e,t,n);if("chlist"==a)return l(e,t,n);if("chromaticities"==a)return u(e,t);if("compression"==a)return c(e,t);if("box2i"==a)return h(e,t);if("lineOrder"==a)return d(e,t);if("float"==a)return o(e,t);if("v2f"==a)return p(e,t);throw"Cannot parse value for unsupported type: "+a}(e,m,y,b);f[g]=w}}for(var A=f.dataWindow.yMax+1,M=A/1,x=0;x<M;x++){(function(e,t){var r=new DataView(e.slice(t.value,t.value+4)).getUint32(0,!0);t.value=t.value+8})(e,m)}for(var L=f.dataWindow.xMax-f.dataWindow.xMin+1,E=f.dataWindow.yMax-f.dataWindow.yMin+1,T=f.channels.length,k=new Float32Array(L*E*T),_={R:0,G:1,B:2,A:3},N=0;N<E;N++)for(var C=a(e,m),S=(a(e,m),0);S<f.channels.length;S++){if(1!=f.channels[S].pixelType)throw"Only supported pixel format is HALF";for(var O=0;O<L;O++){var F=function(e,t){var r=new DataView(e.slice(t.value,t.value+2)).getUint16(0,!0);return t.value+=2,s(r)}(e,m),P=_[f.channels[S].name];k[E*T*(L-C)+O*T+P]=F}}return{header:f,width:L,height:E,data:k,format:n.RGBAFormat,type:n.FloatType}},t.default=n.EXRLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=r(0),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);!function(){function e(e){var t=new Map;if("Connections"in e){e.Connections.connections.forEach(function(e){var r=e[0],a=e[1],n=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var i={ID:a,relationship:n};t.get(r).parents.push(i),t.has(a)||t.set(a,{parents:[],children:[]});var o={ID:r,relationship:n};t.get(a).children.push(o)})}return t}function t(e){var t={},a={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var o=n[i],s=parseInt(i);if(t[s]=o.Filename,"Content"in o){var l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,u="string"==typeof o.Content&&""!==o.Content;if(l||u){var c=r(n[i]);a[o.Filename]=c}}}}for(var s in t){var h=t[s];void 0!==a[h]?t[s]=a[h]:t[s]=t[s].split("\\").pop()}return t}function r(e){var t,r=e.Content,a=e.RelativeFilename||e.Filename,n=a.slice(a.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var i=new Uint8Array(r);return window.URL.createObjectURL(new Blob([i],{type:t}))}function n(e,t,r,a){var n=new Map;if("Texture"in e.Objects){var i=e.Objects.Texture;for(var s in i){var l=o(i[s],t,r,a);n.set(parseInt(s),l)}}return n}function o(e,t,r,a){var n=s(e,t,r,a);n.ID=e.id,n.name=e.attrName;var o=e.WrapModeU,l=e.WrapModeV,u=void 0!==o?o.value:0,c=void 0!==l?l.value:0;if(n.wrapS=0===u?i.RepeatWrapping:i.ClampToEdgeWrapping,n.wrapT=0===c?i.RepeatWrapping:i.ClampToEdgeWrapping,"Scaling"in e){var h=e.Scaling.value;n.repeat.x=h[0],n.repeat.y=h[1]}return n}function s(e,t,r,a){var n,i=a.get(e.id).children;void 0!==i&&i.length>0&&void 0!==r[i[0].ID]&&(n=r[i[0].ID]);var o=t.path;0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||t.setPath(void 0);var s=t.load(n);return t.setPath(o),s}function l(e,t,r){var a=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var o=u(e,n[i],t,r);null!==o&&a.set(parseInt(i),o)}}return a}function u(e,t,r,n){var o=t.id,s=t.attrName,l=t.ShadingModel;if("object"===(void 0===l?"undefined":a(l))&&(l=l.value),!n.has(o))return null;var u,h=c(e,t,r,o,n);switch(l.toLowerCase()){case"phong":u=new i.MeshPhongMaterial;break;case"lambert":u=new i.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',l),u=new i.MeshPhongMaterial({color:3342591})}return u.setValues(h),u.name=s,u}function c(e,t,r,a,n){var o={};return t.BumpFactor&&(o.bumpScale=t.BumpFactor.value),t.Diffuse&&(o.color=ae(t.Diffuse)),t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value),t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value),t.Specular&&(o.specular=ae(t.Specular)),t.Shininess&&(o.shininess=t.Shininess.value),t.Emissive&&(o.emissive=ae(t.Emissive)),t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(o.opacity=parseFloat(t.Opacity.value)),o.opacity<1&&(o.transparent=!0),n.get(a).children.forEach(function(t){var a=t.relationship;switch(a){case"Bump":o.bumpMap=r.get(t.ID);break;case"DiffuseColor":o.map=h(e,r,t.ID,n);break;case"DisplacementColor":o.displacementMap=h(e,r,t.ID,n);break;case"EmissiveColor":o.emissiveMap=h(e,r,t.ID,n);break;case"NormalMap":o.normalMap=h(e,r,t.ID,n);break;case"ReflectionColor":o.envMap=h(e,r,t.ID,n),o.envMap.mapping=i.EquirectangularReflectionMapping;break;case"SpecularColor":o.specularMap=h(e,r,t.ID,n);break;case"TransparentColor":o.alphaMap=h(e,r,t.ID,n),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a)}}),o}function h(e,t,r,a){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=a.get(r).children[0].ID),t.get(r)}function d(e,t){var r={};if("Deformer"in e.Objects){var a=e.Objects.Deformer;for(var n in a){if("Skin"===a[n].attrType){var i=t.get(parseInt(n)),o=p(i,a);o.ID=n,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=i.parents[0].ID,r[n]=o}}}return r}function p(e,t){var r=[];return e.children.forEach(function(e){var a=t[e.ID];if("Cluster"===a.attrType){var n={ID:e.ID,indices:[],weights:[],transform:(new i.Matrix4).fromArray(a.Transform.a),transformLink:(new i.Matrix4).fromArray(a.TransformLink.a),linkMode:a.Mode};"Indexes"in a&&(n.indices=a.Indexes.a,n.weights=a.Weights.a),r.push(n)}}),{rawBones:r,bones:[]}}function f(e,t,r){var a=new Map;if("Geometry"in e.Objects){var n=e.Objects.Geometry;for(var i in n){var o=t.get(parseInt(i)),s=m(e,o,n[i],r);a.set(parseInt(i),s)}}return a}function m(e,t,r,a){switch(r.attrType){case"Mesh":return v(e,t,r,a);case"NurbsCurve":return x(r)}}function v(e,t,r,a){var n=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==n.length){var o=t.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),s=new i.Matrix4,l=n[0];if("GeometricRotation"in l){var u=l.GeometricRotation.value.map(i.Math.degToRad);u[3]="ZYX",s.makeRotationFromEuler((new i.Euler).fromArray(u))}return"GeometricTranslation"in l&&s.setPosition((new i.Vector3).fromArray(l.GeometricTranslation.value)),g(e,t,r,o,s)}}function g(e,t,r,a,n){var o=r.Vertices.a,s=r.PolygonVertexIndex.a,l=[],u=[],c=[],h=[],d=[],p=[],f=[];if(r.LayerElementColor)var m=w(r.LayerElementColor[0]);if(r.LayerElementMaterial)var v=A(r.LayerElementMaterial[0]);if(r.LayerElementNormal)var g=y(r.LayerElementNormal[0]);if(r.LayerElementUV)for(var x=[],L=0;r.LayerElementUV[L];)x.push(b(r.LayerElementUV[L])),L++;var E={};null!==a&&a.rawBones.forEach(function(e,t){e.indices.forEach(function(r,a){void 0===E[r]&&(E[r]=[]),E[r].push({id:t,weight:e.weights[a]})})});var T=0,k=0,_=!1,N=[],C=[],S=[],O=[],F=[],P=[];s.forEach(function(e,t){var r=!1;e<0&&(e^=-1,s[t]=e,r=!0);var n=[],i=[];if(N.push(3*e,3*e+1,3*e+2),m){var y=M(t,T,e,m);S.push(y[0],y[1],y[2])}if(a){if(void 0!==E[e]&&E[e].forEach(function(e){i.push(e.weight),n.push(e.id)}),i.length>4){_||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),_=!0);var b=[0,0,0,0],w=[0,0,0,0];i.forEach(function(e,t){var r=e,a=n[t];w.forEach(function(e,t,n){if(r>e){n[t]=r,r=e;var i=b[t];b[t]=a,a=i}})}),n=b,i=w}for(;i.length<4;)i.push(0),n.push(0);for(var A=0;A<4;++A)F.push(i[A]),P.push(n[A])}if(g){var y=M(t,T,e,g);C.push(y[0],y[1],y[2])}if(v&&"AllSame"!==v.mappingType)var L=M(t,T,e,v)[0];if(x&&x.forEach(function(r,a){var n=M(t,T,e,r);void 0===O[a]&&(O[a]=[]),O[a].push(n[0]),O[a].push(n[1])}),k++,r){for(var A=2;A<k;A++)l.push(o[N[0]]),l.push(o[N[1]]),l.push(o[N[2]]),l.push(o[N[3*(A-1)]]),l.push(o[N[3*(A-1)+1]]),l.push(o[N[3*(A-1)+2]]),l.push(o[N[3*A]]),l.push(o[N[3*A+1]]),l.push(o[N[3*A+2]]),a&&(p.push(F[0]),p.push(F[1]),p.push(F[2]),p.push(F[3]),p.push(F[4*(A-1)]),p.push(F[4*(A-1)+1]),p.push(F[4*(A-1)+2]),p.push(F[4*(A-1)+3]),p.push(F[4*A]),p.push(F[4*A+1]),p.push(F[4*A+2]),p.push(F[4*A+3]),f.push(P[0]),f.push(P[1]),f.push(P[2]),f.push(P[3]),f.push(P[4*(A-1)]),f.push(P[4*(A-1)+1]),f.push(P[4*(A-1)+2]),f.push(P[4*(A-1)+3]),f.push(P[4*A]),f.push(P[4*A+1]),f.push(P[4*A+2]),f.push(P[4*A+3])),m&&(c.push(S[0]),c.push(S[1]),c.push(S[2]),c.push(S[3*(A-1)]),c.push(S[3*(A-1)+1]),c.push(S[3*(A-1)+2]),c.push(S[3*A]),c.push(S[3*A+1]),c.push(S[3*A+2])),v&&"AllSame"!==v.mappingType&&(d.push(L),d.push(L),d.push(L)),g&&(u.push(C[0]),u.push(C[1]),u.push(C[2]),u.push(C[3*(A-1)]),u.push(C[3*(A-1)+1]),u.push(C[3*(A-1)+2]),u.push(C[3*A]),u.push(C[3*A+1]),u.push(C[3*A+2])),x&&x.forEach(function(e,t){void 0===h[t]&&(h[t]=[]),h[t].push(O[t][0]),h[t].push(O[t][1]),h[t].push(O[t][2*(A-1)]),h[t].push(O[t][2*(A-1)+1]),h[t].push(O[t][2*A]),h[t].push(O[t][2*A+1])});T++,k=0,N=[],C=[],S=[],O=[],F=[],P=[]}});var R=new i.BufferGeometry;R.name=r.name;var I=new i.Float32BufferAttribute(l,3);if(n.applyToBufferAttribute(I),R.addAttribute("position",I),c.length>0&&R.addAttribute("color",new i.Float32BufferAttribute(c,3)),a&&(R.addAttribute("skinIndex",new i.Float32BufferAttribute(f,4)),R.addAttribute("skinWeight",new i.Float32BufferAttribute(p,4)),R.FBX_Deformer=a),u.length>0&&R.addAttribute("normal",new i.Float32BufferAttribute(u,3)),h.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),R.addAttribute(r,new i.Float32BufferAttribute(h[t],2))}),v&&"AllSame"!==v.mappingType){var B=d[0],D=0;if(d.forEach(function(e,t){e!==B&&(R.addGroup(D,t-D,B),B=e,D=t)}),R.groups.length>0){var V=R.groups[R.groups.length-1],j=V.start+V.count;j!==d.length&&R.addGroup(j,d.length-j,B)}0===R.groups.length&&R.addGroup(0,d.length,d[0])}return R}function y(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:n,mappingType:t,referenceType:r}}function b(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:a,indices:n,mappingType:t,referenceType:r}}function w(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:a,indices:n,mappingType:t,referenceType:r}}function A(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var a=e.Materials.a,n=[],i=0;i<a.length;++i)n.push(i);return{dataSize:1,buffer:a,indices:n,mappingType:t,referenceType:r}}function M(e,t,r,a){return le[a.mappingType][a.referenceType](e,t,r,a)}function x(e){if(void 0===i.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.BufferGeometry;for(var r=t-1,a=e.KnotVector.a,n=[],o=e.Points.a,s=0,l=o.length;s<l;s+=4)n.push((new i.Vector4).fromArray(o,s));var u,c;if("Closed"===e.Form)n.push(n[0]);else if("Periodic"===e.Form){u=r,c=a.length-1-u;for(var s=0;s<r;++s)n.push(n[s])}var h=new i.NURBSCurve(r,a,n,u,c),d=h.getPoints(7*n.length),p=new Float32Array(3*d.length);d.forEach(function(e,t){e.toArray(p,3*t)});var f=new i.BufferGeometry;return f.addAttribute("position",new i.BufferAttribute(p,3)),f}function L(e,t,r,a,n){var o=new i.Group,s=E(e,r,a,n,t),l=e.Objects.Model;return s.forEach(function(r){var a=l[r.ID];O(e,r,a,t,o),t.get(r.ID).parents.forEach(function(e){var t=s.get(e.ID);void 0!==t&&t.add(r)}),null===r.parent&&o.add(r)}),P(e,r,a,s,t),U(e,t,o),S(e,o),o}function E(e,t,r,a,n){var o=new Map,s=e.Objects.Model;for(var l in s){var u=parseInt(l),c=s[l],h=n.get(u),d=T(h,t,u,c.attrName);if(!d){switch(c.attrType){case"Camera":d=k(e,h);break;case"Light":d=_(e,h);break;case"Mesh":d=N(e,h,r,a);break;case"NurbsCurve":d=C(h,r);break;case"LimbNode":case"Null":default:d=new i.Group}d.name=i.PropertyBinding.sanitizeNodeName(c.attrName),d.ID=u}F(e,d,c),o.set(u,d)}return o}function T(e,t,r,a){var n=null;return e.parents.forEach(function(e){for(var o in t){var s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){var l=n;n=new i.Bone,n.matrixWorld.copy(t.transformLink),n.name=i.PropertyBinding.sanitizeNodeName(a),n.ID=r,s.bones[o]=n,null!==l&&n.add(l)}})}}),n}function k(e,t){var r,a;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(a=r)}),void 0===a)r=new i.Object3D;else{var n=0;void 0!==a.CameraProjectionType&&1===a.CameraProjectionType.value&&(n=1);var o=1;void 0!==a.NearPlane&&(o=a.NearPlane.value/1e3);var s=1e3;void 0!==a.FarPlane&&(s=a.FarPlane.value/1e3);var l=window.innerWidth,u=window.innerHeight;void 0!==a.AspectWidth&&void 0!==a.AspectHeight&&(l=a.AspectWidth.value,u=a.AspectHeight.value);var c=l/u,h=45;switch(void 0!==a.FieldOfView&&(h=a.FieldOfView.value),n){case 0:r=new i.PerspectiveCamera(h,c,o,s);break;case 1:r=new i.OrthographicCamera(-l/2,l/2,u/2,-u/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),r=new i.Object3D}}return r}function _(e,t){var r,a;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(a=r)}),void 0===a)r=new i.Object3D;else{var n;n=void 0===a.LightType?0:a.LightType.value;var o=16777215;void 0!==a.Color&&(o=ae(a.Color));var s=void 0===a.Intensity?1:a.Intensity.value/100;void 0!==a.CastLightOnObject&&0===a.CastLightOnObject.value&&(s=0);var l=0;void 0!==a.FarAttenuationEnd&&(l=void 0!==a.EnableFarAttenuation&&0===a.EnableFarAttenuation.value?0:a.FarAttenuationEnd.value/1e3);switch(n){case 0:r=new i.PointLight(o,s,l,1);break;case 1:r=new i.DirectionalLight(o,s);break;case 2:var u=Math.PI/3;void 0!==a.InnerAngle&&(u=i.Math.degToRad(a.InnerAngle.value));var c=0;void 0!==a.OuterAngle&&(c=i.Math.degToRad(a.OuterAngle.value),c=Math.max(c,1)),r=new i.SpotLight(o,s,l,u,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+a.LightType.value+", defaulting to a THREE.PointLight."),r=new i.PointLight(o,s)}void 0!==a.CastShadows&&1===a.CastShadows.value&&(r.castShadow=!0)}return r}function N(e,t,r,a){var n,o=null,s=null,l=[];return t.children.forEach(function(e){r.has(e.ID)&&(o=r.get(e.ID)),a.has(e.ID)&&l.push(a.get(e.ID))}),l.length>1?s=l:l.length>0?s=l[0]:(s=new i.MeshPhongMaterial({color:13421772}),l.push(s)),"color"in o.attributes&&l.forEach(function(e){e.vertexColors=i.VertexColors}),o.FBX_Deformer?(l.forEach(function(e){e.skinning=!0}),n=new i.SkinnedMesh(o,s)):n=new i.Mesh(o,s),n}function C(e,t){var r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),a=new i.LineBasicMaterial({color:3342591,linewidth:1});return new i.Line(r,a)}function S(e,t){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var r=e.GlobalSettings.AmbientColor.value,a=r[0],n=r[1],o=r[2];if(0!==a||0!==n||0!==o){var s=new i.Color(a,n,o);t.add(new i.AmbientLight(s,1))}}}function O(e,t,r,a,n){if("LookAtProperty"in r){a.get(t.ID).children.forEach(function(r){if("LookAtProperty"===r.relationship){var a=e.Objects.Model[r.ID];if("Lcl_Translation"in a){var o=a.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(o),n.add(t.target)):t.lookAt((new i.Vector3).fromArray(o))}}})}}function F(e,t,r){if("RotationOrder"in r){var a=["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"],n=parseInt(r.RotationOrder.value,10);n>0&&n<6?console.warn("THREE.FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",a[n]):6===n&&console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in r&&t.position.fromArray(r.Lcl_Translation.value),"Lcl_Rotation"in r){var o=r.Lcl_Rotation.value.map(i.Math.degToRad);o.push("ZYX"),t.rotation.fromArray(o)}if("Lcl_Scaling"in r&&t.scale.fromArray(r.Lcl_Scaling.value),"PreRotation"in r){var s=r.PreRotation.value.map(i.Math.degToRad);s[3]="ZYX";var l=(new i.Euler).fromArray(s);l=(new i.Quaternion).setFromEuler(l);var u=(new i.Quaternion).setFromEuler(t.rotation);l.multiply(u),t.rotation.setFromQuaternion(l,"ZYX")}}function P(e,t,r,a,n){var o=R(e);for(var s in t){var l=t[s];n.get(parseInt(l.ID)).parents.forEach(function(e){if(r.has(e.ID)){var t=e.ID;n.get(t).parents.forEach(function(e){if(a.has(e.ID)){a.get(e.ID).bind(new i.Skeleton(l.bones),o[e.ID])}})}})}}function R(e){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var a in r)if("BindPose"===r[a].attrType){var n=r[a].PoseNode;Array.isArray(n)?n.forEach(function(e){t[e.Node]=(new i.Matrix4).fromArray(e.Matrix.a)}):t[n.Node]=(new i.Matrix4).fromArray(n.Matrix.a)}}return t}function I(e,t){if(void 0!==e.Objects.AnimationCurve){var r=B(e);D(e,t,r);return j(e,t,V(e,t,r))}}function B(e){var t=e.Objects.AnimationCurveNode,r=new Map;for(var a in t){var n=t[a];if(null!==n.attrName.match(/S|R|T/)){var i={id:n.id,attr:n.attrName,curves:{}};r.set(i.id,i)}}return r}function D(e,t,r){var a=e.Objects.AnimationCurve;for(var n in a){var i={id:a[n].id,times:a[n].KeyTime.a.map(te),values:a[n].KeyValueFloat.a},o=t.get(i.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship,u="";if(l.match(/X/))u="x";else if(l.match(/Y/))u="y";else{if(!l.match(/Z/))continue;u="z"}r.get(s).curves[u]=i}}}function V(e,t,r){var a=e.Objects.AnimationLayer,n=new Map;for(var o in a){var s=[],l=t.get(parseInt(o));if(void 0!==l){l.children.forEach(function(a,n){if(r.has(a.ID)){var o=r.get(a.ID);if(void 0===s[n]){var l;t.get(a.ID).parents.forEach(function(e){void 0!==e.relationship&&(l=e.ID)});var u=e.Objects.Model[l.toString()],c={modelName:i.PropertyBinding.sanitizeNodeName(u.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in u&&(c.initialPosition=u.Lcl_Translation.value),"Lcl_Rotation"in u&&(c.initialRotation=u.Lcl_Rotation.value),"Lcl_Scaling"in u&&(c.initialScale=u.Lcl_Scaling.value),"PreRotation"in u&&(c.preRotations=u.PreRotation.value),s[n]=c}s[n][o.attr]=o}}),n.set(parseInt(o),s)}}return n}function j(e,t,r){var a=e.Objects.AnimationStack,n={};for(var i in a){var o=t.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);n[i]={name:a[i].attrName,layer:s}}return n}function U(e,t,r){r.animations=[];var a=I(e,t);if(void 0!==a)for(var n in a){var i=a[n],o=G(i);r.animations.push(o)}}function G(e){var t=[];return e.layer.forEach(function(e){t=t.concat(z(e))}),new i.AnimationClip(e.name,-1,t)}function z(e){var t=[];if(void 0!==e.T&&Object.keys(e.T.curves).length>0){var r=H(e.modelName,e.T.curves,e.initialPosition,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=Y(e.modelName,e.R.curves,e.initialRotation,e.preRotations);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var n=H(e.modelName,e.S.curves,e.initialScale,"scale");void 0!==n&&t.push(n)}return t}function H(e,t,r,a){var n=W(t),o=X(n,t,r);return new i.VectorKeyframeTrack(e+"."+a,n,o)}function Y(e,t,r,a){void 0!==t.x&&(t.x.values=t.x.values.map(i.Math.degToRad)),void 0!==t.y&&(t.y.values=t.y.values.map(i.Math.degToRad)),void 0!==t.z&&(t.z.values=t.z.values.map(i.Math.degToRad));var n=W(t),o=X(n,t,r);void 0!==a&&(a=a.map(i.Math.degToRad),a.push("ZYX"),a=(new i.Euler).fromArray(a),a=(new i.Quaternion).setFromEuler(a));for(var s=new i.Quaternion,l=new i.Euler,u=[],c=0;c<o.length;c+=3)l.set(o[c],o[c+1],o[c+2],"ZYX"),s.setFromEuler(l),void 0!==a&&s.premultiply(a),s.toArray(u,c/3*4);return new i.QuaternionKeyframeTrack(e+".quaternion",n,u)}function X(e,t,r){var a=r,n=[],i=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){var r=t.x.values[i];n.push(r),a[0]=r}else n.push(a[0]);if(-1!==o){var l=t.y.values[o];n.push(l),a[1]=l}else n.push(a[1]);if(-1!==s){var u=t.z.values[s];n.push(u),a[2]=u}else n.push(a[2])}),n}function W(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})}function K(){}function Q(){}function Z(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function q(){}function J(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ne(e,0,t.length)}function $(e){for(var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0,a=0;a<t.length;++a){if(function(t){var a=e[t-1];return e=e.slice(r+t),r++,a}(1)===t[a])return!1}return!0}function ee(e){var t=/FBXVersion: (\d+)/,r=e.match(t);if(r){return parseInt(r[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function te(e){return e/46186158e3}function re(e){return e.split(",").map(function(e){return parseFloat(e)})}function ae(e){var t=new i.Color;return"Color"===e.type?t.setScalar(e.value):t.fromArray(e.value)}function ne(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),i.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function ie(e,t){for(var r=0,a=e.length,n=t.length;r<n;r++,a++)e[a]=t[r]}function oe(e,t,r,a){for(var n=r,i=0;n<a;n++,i++)e[i]=t[n];return e}i.FBXLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},Object.assign(i.FBXLoader.prototype,{load:function(e,t,r,a){var n=this,o=i.LoaderUtils.extractUrlBase(e),s=new i.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(r){try{var i=n.parse(r,o);t(i)}catch(t){window.setTimeout(function(){a&&a(t),n.manager.itemError(e)},0)}},r,a)},parse:function(r,a){var o;if(J(r))o=(new Q).parse(r);else{var s=ne(r);if(!$(s))throw new Error("THREE.FBXLoader: Unknown format.");if(ee(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ee(s));o=(new K).parse(s)}var u=e(o),c=t(o),h=n(o,new i.TextureLoader(this.manager).setPath(a),c,u),p=l(o,h,u),m=d(o,u);return L(o,u,m,f(o,u,m),p)}});var se=[],le={ByPolygonVertex:{Direct:function(e,t,r,a){var n=e*a.dataSize,i=e*a.dataSize+a.dataSize;return oe(se,a.buffer,n,i)},IndexToDirect:function(e,t,r,a){var n=a.indices[e],i=n*a.dataSize,o=n*a.dataSize+a.dataSize;return oe(se,a.buffer,i,o)}},ByPolygon:{Direct:function(e,t,r,a){var n=t*a.dataSize,i=t*a.dataSize+a.dataSize;return oe(se,a.buffer,n,i)},IndexToDirect:function(e,t,r,a){var n=a.indices[t],i=n*a.dataSize,o=n*a.dataSize+a.dataSize;return oe(se,a.buffer,i,o)}},ByVertice:{Direct:function(e,t,r,a){var n=r*a.dataSize,i=r*a.dataSize+a.dataSize;return oe(se,a.buffer,n,i)}},AllSame:{IndexToDirect:function(e,t,r,a){var n=a.indices[0]*a.dataSize,i=a.indices[0]*a.dataSize+a.dataSize;return oe(se,a.buffer,n,i)}}};Object.assign(K.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new q,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split("\n");return r.forEach(function(e,a){var n=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!n&&!i){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++a]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},i=this.parseNodeAttr(a),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in o?("PoseNode"===r?o.PoseNode.push(n):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==i.id&&(o[r][i.id]=n)):"number"==typeof i.id?(o[r]={},o[r][i.id]=n):"Properties70"!==r&&(o[r]="PoseNode"===r?[n]:n),"number"==typeof i.id&&(n.id=i.id),""!==i.name&&(n.attrName=i.name),""!==i.type&&(n.attrType=i.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",a="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:r,type:a}},parseNodeProperty:function(e,t,r){var a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===a&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"===i.name)return void this.parseNodeSpecialProperty(e,a,n);if("C"===a){var o=n.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),u=n.split(",").slice(3);u=u.map(function(e){return e.trim().replace(/^"/,"")}),a="connections",n=[s,l],ie(n,u),void 0===i[a]&&(i[a]=[])}"Node"===a&&(i.id=n),a in i&&Array.isArray(i[a])?i[a].push(n):"a"!==a?i[a]=n:i.a=n,this.setCurrentProp(i,a),"a"===a&&","!==n.slice(-1)&&(i.a=re(n))},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=re(t.a))},parseNodeSpecialProperty:function(e,t,r){var a=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=a[0],i=a[1],o=a[2],s=a[3],l=a[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=re(l)}this.getPrevNode()[n]={type:i,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}}),Object.assign(Q.prototype,{parse:function(e){var t=new Z(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var a=new q;!this.endOfContent(t);){var n=this.parseNode(t,r);null!==n&&a.add(n.name,n)}return a},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},a=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32(),i=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(i);if(0===a)return null;for(var s=[],l=0;l<n;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===n&&e.getOffset()===a;a>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof u&&(r.id=u),""!==c&&(r.attrName=c),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var a=r.propertyList[0];Array.isArray(a)?(t[r.name]=r,r.a=a):t[r.name]=a}else if("Connections"===e&&"C"===r.name){var n=[];r.propertyList.forEach(function(e,t){0!==t&&n.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===r.name){var i=Object.keys(r);i.forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var o,s=r.propertyList[0],l=r.propertyList[1],u=r.propertyList[2],c=r.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===l.indexOf("Lcl ")&&(l=l.replace("Lcl ","Lcl_")),o="ColorRGB"===l||"Vector"===l||"Vector3D"===l||0===l.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:l,type2:u,flag:c,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":var r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),n=e.getUint32(),i=e.getUint32();if(0===n)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}if(void 0===window.Zlib)throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(i))),s=new Z(o.decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(a);case"d":return s.getFloat64Array(a);case"f":return s.getFloat32Array(a);case"i":return s.getInt32Array(a);case"l":return s.getInt64Array(a)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}),Object.assign(Z.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.getUint8();var a=t.indexOf(0);return a>=0&&(t=t.slice(0,a)),i.LoaderUtils.decodeText(t)}}),Object.assign(q.prototype,{add:function(e,t){this[e]=t}})}(),t.default=i.FBXLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.GCodeLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.splitLayer=!1},n.GCodeLoader.prototype.load=function(e,t,r,a){var i=this;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(e))},r,a)},n.GCodeLoader.prototype.parse=function(e){function t(e){l={vertex:[],pathVertex:[],z:e.z},s.push(l)}function r(e,t){return o.relative?t:t-e}function a(e,t){return o.relative?e+t:t}function i(e,t){var r=new n.BufferGeometry;r.addAttribute("position",new n.Float32BufferAttribute(e,3));var a=new n.LineSegments(r,t?c:u);a.name="layer"+d,g.add(a)}var o={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},s=[],l=void 0,u=new n.LineBasicMaterial({color:16711680});u.name="path";var c=new n.LineBasicMaterial({color:65280});c.name="extruded";for(var h=e.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var p=h[d].split(" "),f=p[0].toUpperCase(),m={};if(p.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));m[t]=r}}),"G0"===f||"G1"===f){var v={x:void 0!==m.x?a(o.x,m.x):o.x,y:void 0!==m.y?a(o.y,m.y):o.y,z:void 0!==m.z?a(o.z,m.z):o.z,e:void 0!==m.e?a(o.e,m.e):o.e,f:void 0!==m.f?a(o.f,m.f):o.f};r(o.e,v.e)>0&&(v.extruding=r(o.e,v.e)>0,void 0!=l&&v.z==l.z||t(v)),function(e,r){void 0===l&&t(e),v.extruding?(l.vertex.push(e.x,e.y,e.z),l.vertex.push(r.x,r.y,r.z)):(l.pathVertex.push(e.x,e.y,e.z),l.pathVertex.push(r.x,r.y,r.z))}(o,v),o=v}else if("G2"===f||"G3"===f)console.warn("THREE.GCodeLoader: Arc command not supported");else if("G90"===f)o.relative=!1;else if("G91"===f)o.relative=!0;else if("G92"===f){var v=o;v.x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,o=v}else console.warn("THREE.GCodeLoader: Command not supported:"+f)}var g=new n.Group;if(g.name="gcode",this.splitLayer)for(var d=0;d<s.length;d++){var y=s[d];i(y.vertex,!0),i(y.pathVertex,!1)}else{for(var b=[],w=[],d=0;d<s.length;d++){var y=s[d];b=b.concat(y.vertex),w=w.concat(y.pathVertex)}i(b,!0),i(w,!1)}return g.rotation.set(-Math.PI/2,0,0),g},t.default=n.GCodeLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:n.DefaultLoadingManager}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}function r(e){this.name=f.KHR_LIGHTS,this.lights={};var t=e.extensions&&e.extensions[f.KHR_LIGHTS]||{},r=t.lights||{};for(var a in r){var i,o=r[a],s=(new n.Color).fromArray(o.color);switch(o.type){case"directional":i=new n.DirectionalLight(s),i.position.set(0,0,1);break;case"point":i=new n.PointLight(s);break;case"spot":i=new n.SpotLight(s),i.position.set(0,0,1);break;case"ambient":i=new n.AmbientLight(s)}i&&(void 0!==o.constantAttenuation&&(i.intensity=o.constantAttenuation),void 0!==o.linearAttenuation&&(i.distance=1/o.linearAttenuation),void 0!==o.quadraticAttenuation&&(i.decay=o.quadraticAttenuation),void 0!==o.fallOffAngle&&(i.angle=o.fallOffAngle),void 0!==o.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),i.name=o.name||"light_"+a,this.lights[a]=i)}}function a(e){this.name=f.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,v);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==m)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,v),a=0;a<r.byteLength;){var i=r.getUint32(a,!0);a+=4;var o=r.getUint32(a,!0);if(a+=4,o===g.JSON){var s=new Uint8Array(e,v+a,i);this.content=n.LoaderUtils.decodeText(s)}else if(o===g.BIN){var l=v+a;this.body=e.slice(l,l+i)}a+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function i(){return{name:f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return n.ShaderMaterial},extendParams:function(e,t,r){var a=t.extensions[this.name],i=n.ShaderLib.standard,o=n.UniformsUtils.clone(i.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),d=i.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",h);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new n.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=d,e.uniforms=o,e.defines={STANDARD:""},e.color=new n.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(a.diffuseFactor)){var f=a.diffuseFactor;e.color.fromArray(f),e.opacity=f[3]}if(void 0!==a.diffuseTexture&&p.push(r.assignTexture(e,"map",a.diffuseTexture.index)),e.emissive=new n.Color(0,0,0),e.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,e.specular=new n.Color(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var m=a.specularGlossinessTexture.index;p.push(r.assignTexture(e,"glossinessMap",m)),p.push(r.assignTexture(e,"specularMap",m))}return Promise.all(p)},createMaterial:function(e){var t=new n.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,a=0,n=r.length;a<n;a++)t[r[a]]=e[r[a]];return t},refreshUniforms:function(e,t,r,a,n,i){if(!0===n.isGLTFSpecularGlossinessMaterial){var o=n.uniforms,s=n.defines;o.opacity.value=n.opacity,o.diffuse.value.copy(n.color),o.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),o.map.value=n.map,o.specularMap.value=n.specularMap,o.alphaMap.value=n.alphaMap,o.lightMap.value=n.lightMap,o.lightMapIntensity.value=n.lightMapIntensity,o.aoMap.value=n.aoMap,o.aoMapIntensity.value=n.aoMapIntensity;var l;if(n.map?l=n.map:n.specularMap?l=n.specularMap:n.displacementMap?l=n.displacementMap:n.normalMap?l=n.normalMap:n.bumpMap?l=n.bumpMap:n.glossinessMap?l=n.glossinessMap:n.alphaMap?l=n.alphaMap:n.emissiveMap&&(l=n.emissiveMap),void 0!==l){l.isWebGLRenderTarget&&(l=l.texture);var u,c;if(void 0!==l.matrix){if(!0===l.matrixAutoUpdate){u=l.offset,c=l.repeat;var h=l.rotation,d=l.center;l.matrix.setUvTransform(u.x,u.y,c.x,c.y,h,d.x,d.y)}o.uvTransform.value.copy(l.matrix)}else u=l.offset,c=l.repeat,o.offsetRepeat.value.set(u.x,u.y,c.x,c.y)}o.envMap.value=n.envMap,o.envMapIntensity.value=n.envMapIntensity,o.flipEnvMap.value=n.envMap&&n.envMap.isCubeTexture?-1:1,o.refractionRatio.value=n.refractionRatio,o.specular.value.copy(n.specular),o.glossiness.value=n.glossiness,o.glossinessMap.value=n.glossinessMap,o.emissiveMap.value=n.emissiveMap,o.bumpMap.value=n.bumpMap,o.normalMap.value=n.normalMap,o.displacementMap.value=n.displacementMap,o.displacementScale.value=n.displacementScale,o.displacementBias.value=n.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function o(e,t,r,a){n.Interpolant.call(this,e,t,r,a)}function s(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function l(){return new n.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})}function u(e,t,r,a){var n=e.geometry,i=e.material,o=r.targets,s=n.morphAttributes;s.position=[],s.normal=[],i.morphTargets=!0;for(var l=0,u=o.length;l<u;l++){var c,h,p=o[l],f="morphTarget"+l;if(void 0!==p.POSITION){c=d(a[p.POSITION]);for(var m=n.attributes.position,v=0,g=c.count;v<g;v++)c.setXYZ(v,c.getX(v)+m.getX(v),c.getY(v)+m.getY(v),c.getZ(v)+m.getZ(v))}else n.attributes.position&&(c=d(n.attributes.position));if(void 0!==c&&(c.name=f,s.position.push(c)),void 0!==p.NORMAL){i.morphNormals=!0,h=d(a[p.NORMAL]);for(var y=n.attributes.normal,v=0,g=h.count;v<g;v++)h.setXYZ(v,h.getX(v)+y.getX(v),h.getY(v)+y.getY(v),h.getZ(v)+y.getZ(v))}else void 0!==n.attributes.normal&&(h=d(n.attributes.normal));void 0!==h&&(h.name=f,s.normal.push(h))}if(e.updateMorphTargets(),void 0!==t.weights)for(var l=0,u=t.weights.length;l<u;l++)e.morphTargetInfluences[l]=t.weights[l]}function c(e,t){if(e.indices!==t.indices)return!1;var r=e.attributes||{},a=t.attributes||{},n=Object.keys(r),i=Object.keys(a);if(n.length!==i.length)return!1;for(var o=0,s=n.length;o<s;o++){var l=n[o];if(r[l]!==a[l])return!1}return!0}function h(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];if(c(n.primitive,t))return n.geometry}return null}function d(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,a=e.array.slice(0,t*r),i=0;i<t;++i)a[i]=e.getX(i),r>=2&&(a[i+1]=e.getY(i)),r>=3&&(a[i+2]=e.getZ(i)),r>=4&&(a[i+3]=e.getW(i));return new n.BufferAttribute(a,r,e.normalized)}return e.clone()}function p(e,r,a){this.json=e||{},this.extensions=r||{},this.options=a||{},this.cache=new t,this.primitiveCache=[],this.textureLoader=new n.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new n.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this,o=void 0!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),s=new n.FileLoader(i.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){try{i.parse(e,o,t,a)}catch(e){if(void 0===a)throw e;a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},parse:function(e,t,o,s){var l,u={};if("string"==typeof e)l=e;else{if(n.LoaderUtils.decodeText(new Uint8Array(e,0,4))===m){try{u[f.KHR_BINARY_GLTF]=new a(e)}catch(e){return void(s&&s(e))}l=u[f.KHR_BINARY_GLTF].content}else l=n.LoaderUtils.decodeText(new Uint8Array(e))}var c=JSON.parse(l);if(void 0===c.asset||c.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")));c.extensionsUsed&&(c.extensionsUsed.indexOf(f.KHR_LIGHTS)>=0&&(u[f.KHR_LIGHTS]=new r(c)),c.extensionsUsed.indexOf(f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(u[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new i)),console.time("GLTFLoader"),new p(c,u,{path:t||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(e,t,r,a,n){console.timeEnd("GLTFLoader"),o({scene:e,scenes:t,cameras:r,animations:a,asset:n})},s)}};var f={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"},m="glTF",v=12,g={JSON:1313821514,BIN:5130562};o.prototype=Object.create(n.Interpolant.prototype),o.prototype.constructor=o,o.prototype.interpolate_=function(e,t,r,a){for(var n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=a-t,c=(r-t)/u,h=c*c,d=h*c,p=e*l,f=p-l,m=2*d-3*h+1,v=d-2*h+c,g=-2*d+3*h,y=d-h,b=0;b!==o;b++){var w=i[f+b+o],A=i[f+b+s]*u,M=i[p+b+o],x=i[p+b]*u;n[b]=m*w+v*A+g*M+y*x}return n};var y={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},b=(Number,n.Matrix3,n.Matrix4,n.Vector2,n.Vector3,n.Vector4,n.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),w={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipMapNearestFilter,9985:n.LinearMipMapNearestFilter,9986:n.NearestMipMapLinearFilter,9987:n.LinearMipMapLinearFilter},A={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},M={6406:n.AlphaFormat,6407:n.RGBFormat,6408:n.RGBAFormat,6409:n.LuminanceFormat,6410:n.LuminanceAlphaFormat},x={5121:n.UnsignedByteType,32819:n.UnsignedShort4444Type,32820:n.UnsignedShort5551Type,33635:n.UnsignedShort565Type},L=(n.BackSide,n.FrontSide,n.NeverDepth,n.LessDepth,n.EqualDepth,n.LessEqualDepth,n.GreaterEqualDepth,n.NotEqualDepth,n.GreaterEqualDepth,n.AlwaysDepth,n.AddEquation,n.SubtractEquation,n.ReverseSubtractEquation,n.ZeroFactor,n.OneFactor,n.SrcColorFactor,n.OneMinusSrcColorFactor,n.SrcAlphaFactor,n.OneMinusSrcAlphaFactor,n.DstAlphaFactor,n.OneMinusDstAlphaFactor,n.DstColorFactor,n.OneMinusDstColorFactor,n.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},T={CUBICSPLINE:n.InterpolateSmooth,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},k={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};return p.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var a=t.scenes||[],n=a[r.scene||0],i=t.animations||[],o=r.asset,s=t.cameras||[];e(n,a,s,i,o)}).catch(t)},p.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},n={},i=0,o=t.length;i<o;i++)for(var s=t[i].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var c=0,h=e.length;c<h;c++){var d=e[c];void 0!==d.mesh&&(void 0===a[d.mesh]&&(a[d.mesh]=n[d.mesh]=0),a[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=n},p.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){a=this["load"+e.charAt(0).toUpperCase()+e.slice(1)](t),this.cache.add(r,a)}return a},p.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map(function(t,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t},p.prototype.getMultiDependencies=function(e){for(var t={},r=[],a=0,n=e.length;a<n;a++){var i=e[a],o=this.getDependencies(i);o=o.then(function(e,r){t[e]=r}.bind(this,i+("mesh"===i?"es":"s"))),r.push(o)}return Promise.all(r).then(function(){return t})},p.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[f.KHR_BINARY_GLTF].body);var a=this.options;return new Promise(function(e,n){r.load(s(t.uri,a.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},p.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)})},p.prototype.loadAccessor=function(e){var t=this,r=this.json,a=this.json.accessors[e],i=[];return void 0!==a.bufferView?i.push(this.getDependency("bufferView",a.bufferView)):i.push(null),void 0!==a.sparse&&(i.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,o,s=e[0],l=L[a.type],u=b[a.componentType],c=u.BYTES_PER_ELEMENT,h=c*l,d=a.byteOffset||0,p=r.bufferViews[a.bufferView].byteStride,f=!0===a.normalized;if(p&&p!==h){var m="InterleavedBuffer:"+a.bufferView+":"+a.componentType,v=t.cache.get(m);v||(i=new u(s),v=new n.InterleavedBuffer(i,p/c),t.cache.add(m,v)),o=new n.InterleavedBufferAttribute(v,l,d/c,f)}else i=null===s?new u(a.count*l):new u(s,d,a.count*l),o=new n.BufferAttribute(i,l,f);if(void 0!==a.sparse){var g=L.SCALAR,y=b[a.sparse.indices.componentType],w=a.sparse.indices.byteOffset||0,A=a.sparse.values.byteOffset||0,M=new y(e[1],w,a.sparse.count*g),x=new u(e[2],A,a.sparse.count*l);null!==s&&o.setArray(o.array.slice());for(var E=0,T=M.length;E<T;E++){var k=M[E];if(o.setX(k,x[E*l]),l>=2&&o.setY(k,x[E*l+1]),l>=3&&o.setZ(k,x[E*l+2]),l>=4&&o.setW(k,x[E*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},p.prototype.loadTexture=function(e){var t=this,r=this.json,a=this.options,i=this.textureLoader,o=window.URL||window.webkitURL,l=r.textures[e],u=r.images[l.source],c=u.uri,h=!1;return void 0!==u.bufferView&&(c=t.getDependency("bufferView",u.bufferView).then(function(e){h=!0;var t=new Blob([e],{type:u.mimeType});return c=o.createObjectURL(t)})),Promise.resolve(c).then(function(e){var t=n.Loader.Handlers.get(e)||i;return new Promise(function(r,n){t.load(s(e,a.path),r,void 0,n)})}).then(function(e){!0===h&&o.revokeObjectURL(c),e.flipY=!1,void 0!==l.name&&(e.name=l.name),e.format=void 0!==l.format?M[l.format]:n.RGBAFormat,void 0!==l.internalFormat&&e.format!==M[l.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==l.type?x[l.type]:n.UnsignedByteType;var t=r.samplers||{},a=t[l.sampler]||{};return e.magFilter=w[a.magFilter]||n.LinearFilter,e.minFilter=w[a.minFilter]||n.LinearMipMapLinearFilter,e.wrapS=A[a.wrapS]||n.RepeatWrapping,e.wrapT=A[a.wrapT]||n.RepeatWrapping,e})},p.prototype.assignTexture=function(e,t,r){return this.getDependency("texture",r).then(function(r){e[t]=r})},p.prototype.loadMaterial=function(e){var t,r=this,a=(this.json,this.extensions),i=this.json.materials[e],o={},s=i.extensions||{},l=[];if(s[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=a[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(i),l.push(u.extendParams(o,i,r))}else if(void 0!==i.pbrMetallicRoughness){t=n.MeshStandardMaterial;var c=i.pbrMetallicRoughness;if(o.color=new n.Color(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){var h=c.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}if(void 0!==c.baseColorTexture&&l.push(r.assignTexture(o,"map",c.baseColorTexture.index)),o.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,o.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture){var d=c.metallicRoughnessTexture.index;l.push(r.assignTexture(o,"metalnessMap",d)),l.push(r.assignTexture(o,"roughnessMap",d))}}else t=n.MeshPhongMaterial;!0===i.doubleSided&&(o.side=n.DoubleSide);var p=i.alphaMode||k.OPAQUE;return p===k.BLEND?o.transparent=!0:(o.transparent=!1,p===k.MASK&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&(l.push(r.assignTexture(o,"normalMap",i.normalTexture.index)),o.normalScale=new n.Vector2(1,1),void 0!==i.normalTexture.scale&&o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&(l.push(r.assignTexture(o,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&(t===n.MeshBasicMaterial?o.color=(new n.Color).fromArray(i.emissiveFactor):o.emissive=(new n.Color).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&(t===n.MeshBasicMaterial?l.push(r.assignTexture(o,"map",i.emissiveTexture.index)):l.push(r.assignTexture(o,"emissiveMap",i.emissiveTexture.index))),Promise.all(l).then(function(){var e;return e=t===n.ShaderMaterial?a[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==i.name&&(e.name=i.name),e.normalScale&&(e.normalScale.x=-e.normalScale.x),e.map&&(e.map.encoding=n.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=n.sRGBEncoding),i.extras&&(e.userData=i.extras),e})},p.prototype.loadGeometries=function(e){var t=this.primitiveCache;return this.getDependencies("accessor").then(function(r){for(var a=[],i=0,o=e.length;i<o;i++){var s=e[i],l=h(t,s);if(l)a.push(l);else{var u=new n.BufferGeometry,c=s.attributes;for(var d in c){var p=c[d],f=r[p];switch(d){case"POSITION":u.addAttribute("position",f);break;case"NORMAL":u.addAttribute("normal",f);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":u.addAttribute("uv",f);break;case"TEXCOORD_1":u.addAttribute("uv2",f);break;case"COLOR_0":case"COLOR0":case"COLOR":u.addAttribute("color",f);break;case"WEIGHTS_0":case"WEIGHT":u.addAttribute("skinWeight",f);break;case"JOINTS_0":case"JOINT":u.addAttribute("skinIndex",f)}}void 0!==s.indices&&u.setIndex(r[s.indices]),t.push({primitive:s,geometry:u}),a.push(u)}}return a})},p.prototype.loadMesh=function(e){var t=this,r=(this.json,this.extensions),a=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(i){var o=new n.Group,s=a.primitives;return t.loadGeometries(s).then(function(c){for(var h=0,d=s.length;h<d;h++){var p=s[h],m=c[h],v=void 0===p.material?l():i.materials[p.material];v.aoMap&&void 0===m.attributes.uv2&&void 0!==m.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),m.addAttribute("uv2",new n.BufferAttribute(m.attributes.uv.array,2)));var g=void 0!==m.attributes.color,b=void 0===m.attributes.normal,w=!0===a.isSkinnedMesh,A=void 0!==p.targets;if(g||b||w||A)if(v.isGLTFSpecularGlossinessMaterial){var M=r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];v=M.cloneMaterial(v)}else v=v.clone();g&&(v.vertexColors=n.VertexColors,v.needsUpdate=!0),b&&(v.flatShading=!0);var x;if(p.mode===y.TRIANGLES||p.mode===y.TRIANGLE_STRIP||p.mode===y.TRIANGLE_FAN||void 0===p.mode)w?(x=new n.SkinnedMesh(m,v),v.skinning=!0):x=new n.Mesh(m,v),p.mode===y.TRIANGLE_STRIP?x.drawMode=n.TriangleStripDrawMode:p.mode===y.TRIANGLE_FAN&&(x.drawMode=n.TriangleFanDrawMode);else if(p.mode===y.LINES||p.mode===y.LINE_STRIP||p.mode===y.LINE_LOOP){var L="LineBasicMaterial:"+v.uuid,E=t.cache.get(L);E||(E=new n.LineBasicMaterial,n.Material.prototype.copy.call(E,v),E.color.copy(v.color),E.lights=!1,t.cache.add(L,E)),v=E,x=p.mode===y.LINES?new n.LineSegments(m,v):p.mode===y.LINE_STRIP?new n.Line(m,v):new n.LineLoop(m,v)}else{if(p.mode!==y.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);var L="PointsMaterial:"+v.uuid,T=t.cache.get(L);T||(T=new n.PointsMaterial,n.Material.prototype.copy.call(T,v),T.color.copy(v.color),T.map=v.map,T.lights=!1,t.cache.add(L,T)),v=T,x=new n.Points(m,v)}if(x.name=a.name||"mesh_"+e,A&&u(x,a,p,i.accessors),void 0!==a.extras&&(x.userData=a.extras),void 0!==p.extras&&(x.geometry.userData=p.extras),!0===v.isGLTFSpecularGlossinessMaterial&&(x.onBeforeRender=r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(s.length>1))return x;x.name+="_"+h,o.add(x)}return o})})},p.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],a=r[r.type];if(!a)return void console.warn("THREE.GLTFLoader: Missing camera parameters.");if("perspective"===r.type){var i=a.aspectRatio||1,o=a.yfov*i;t=new n.PerspectiveCamera(n.Math.radToDeg(o),i,a.znear||1,a.zfar||2e6)}else"orthographic"===r.type&&(t=new n.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar));return void 0!==r.name&&(t.name=r.name),r.extras&&(t.userData=r.extras),Promise.resolve(t)},p.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},p.prototype.loadAnimation=function(e){var t=(this.json,this.json.animations[e]);return this.getMultiDependencies(["accessor","node"]).then(function(r){for(var a=[],i=0,s=t.channels.length;i<s;i++){var l=t.channels[i],u=t.samplers[l.sampler];if(u){var c=l.target,h=void 0!==c.node?c.node:c.id,d=void 0!==t.parameters?t.parameters[u.input]:u.input,p=void 0!==t.parameters?t.parameters[u.output]:u.output,f=r.accessors[d],m=r.accessors[p],v=r.nodes[h];if(v){v.updateMatrix(),v.matrixAutoUpdate=!0;var g;switch(E[c.path]){case E.weights:g=n.NumberKeyframeTrack;break;case E.rotation:g=n.QuaternionKeyframeTrack;break;case E.position:case E.scale:default:g=n.VectorKeyframeTrack}var y=v.name?v.name:v.uuid,b=void 0!==u.interpolation?T[u.interpolation]:n.InterpolateLinear,w=[];E[c.path]===E.weights?v.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&w.push(e.name?e.name:e.uuid)}):w.push(y);for(var A=0,M=w.length;A<M;A++){var x=new g(w[A]+"."+E[c.path],n.AnimationUtils.arraySlice(f.array,0),n.AnimationUtils.arraySlice(m.array,0),b);"CUBICSPLINE"===u.interpolation&&(x.createInterpolant=function(e){return new o(this.times,this.values,this.getValueSize()/3,e)}),a.push(x)}}}}var h=void 0!==t.name?t.name:"animation_"+e;return new n.AnimationClip(h,void 0,a)})},p.prototype.loadNode=function(e){var t=(this.json,this.extensions),r=this.json.meshReferences,a=this.json.meshUses,i=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(e){var o;if(!0===i.isBone)o=new n.Bone;else if(void 0!==i.mesh){var s=e.meshes[i.mesh];if(o=s.clone(),!0===s.isGroup)for(var l=0,u=s.children.length;l<u;l++){var c=s.children[l];c.material&&!0===c.material.isGLTFSpecularGlossinessMaterial&&(o.children[l].onBeforeRender=c.onBeforeRender)}else s.material&&!0===s.material.isGLTFSpecularGlossinessMaterial&&(o.onBeforeRender=s.onBeforeRender);r[i.mesh]>1&&(o.name+="_instance_"+a[i.mesh]++)}else if(void 0!==i.camera)o=e.cameras[i.camera];else if(i.extensions&&i.extensions[f.KHR_LIGHTS]&&void 0!==i.extensions[f.KHR_LIGHTS].light){var h=t[f.KHR_LIGHTS].lights;o=h[i.extensions[f.KHR_LIGHTS].light]}else o=new n.Object3D;if(void 0!==i.name&&(o.name=n.PropertyBinding.sanitizeNodeName(i.name)),i.extras&&(o.userData=i.extras),void 0!==i.matrix){var d=new n.Matrix4;d.fromArray(i.matrix),o.applyMatrix(d)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return o})},p.prototype.loadScene=function(){function e(t,r,a,i,o){var s=i[t],l=a.nodes[t];if(void 0!==l.skin)for(var u=!0===s.isGroup?s.children:[s],c=0,h=u.length;c<h;c++){for(var d=u[c],p=o[l.skin],f=[],m=[],v=0,g=p.joints.length;v<g;v++){var y=p.joints[v],b=i[y];if(b){f.push(b);var w=new n.Matrix4;void 0!==p.inverseBindMatrices&&w.fromArray(p.inverseBindMatrices.array,16*v),m.push(w)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',y)}d.bind(new n.Skeleton(f,m),d.matrixWorld)}if(r.add(s),l.children)for(var A=l.children,c=0,h=A.length;c<h;c++){var M=A[c];e(M,s,a,i,o)}}return function(t){var r=this.json,a=this.extensions,i=this.json.scenes[t];return this.getMultiDependencies(["node","skin"]).then(function(t){var o=new n.Scene;void 0!==i.name&&(o.name=i.name),i.extras&&(o.userData=i.extras);for(var s=i.nodes||[],l=0,u=s.length;l<u;l++)e(s[l],o,r,t.nodes,t.skins);if(i.extensions&&i.extensions[f.KHR_LIGHTS]&&void 0!==i.extensions[f.KHR_LIGHTS].light){var c=a[f.KHR_LIGHTS].lights;o.add(c[i.extensions[f.KHR_LIGHTS].light])}return o})}}(),e}(),t.default=n.GLTFLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.HDRCubeTextureLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.hdrLoader=new n.RGBELoader},n.HDRCubeTextureLoader.prototype.load=function(e,t,r,a,i){var o=function(e,t,r,a){var n=e[t+3],i=Math.pow(2,n-128)/255;r[a+0]=e[t+0]*i,r[a+1]=e[t+1]*i,r[a+2]=e[t+2]*i},s=function(){function e(e){t[0]=e;var a=r[0],n=a>>16&32768,i=a>>12&2047,o=a>>23&255;return o<103?n:o>142?(n|=31744,n|=(255==o?0:1)&&8388607&a):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1)):(n|=o-112<<10|i>>1,n+=1&i)}var t=new Float32Array(1),r=new Int32Array(t.buffer);return function(t,r,a,n){var i=t[r+3],o=Math.pow(2,i-128)/255;a[n+0]=e(t[r+0]*o),a[n+1]=e(t[r+1]*o),a[n+2]=e(t[r+2]*o)}}(),l=new n.CubeTexture;l.type=e,l.encoding=e===n.UnsignedByteType?n.RGBEEncoding:n.LinearEncoding,l.format=e===n.UnsignedByteType?n.RGBAFormat:n.RGBFormat,l.minFilter=l.encoding===n.RGBEEncoding?n.NearestFilter:n.LinearFilter,l.magFilter=l.encoding===n.RGBEEncoding?n.NearestFilter:n.LinearFilter,l.generateMipmaps=l.encoding!==n.RGBEEncoding,l.anisotropy=0;for(var u=this.hdrLoader,c=0,h=0;h<t.length;h++)!function(r,a,i,h){var d=new n.FileLoader(this.manager);d.setResponseType("arraybuffer"),d.load(t[r],function(t){c++;var i=u._parser(t);if(i){if(e===n.FloatType){for(var h=i.data.length/4*3,d=new Float32Array(h),p=0;p<h;p++)o(i.data,4*p,d,3*p);i.data=d}else if(e===n.HalfFloatType){for(var h=i.data.length/4*3,f=new Uint16Array(h),p=0;p<h;p++)s(i.data,4*p,f,3*p);i.data=f}if(void 0!==i.image)l[r].images=i.image;else if(void 0!==i.data){var m=new n.DataTexture(i.data,i.width,i.height);m.format=l.format,m.type=l.type,m.encoding=l.encoding,m.minFilter=l.minFilter,m.magFilter=l.magFilter,m.generateMipmaps=l.generateMipmaps,l.images[r]=m}6===c&&(l.needsUpdate=!0,a&&a(l))}},i,h)}(h,r,a,i);return l},t.default=n.HDRCubeTextureLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.KMZLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.KMZLoader.prototype={constructor:n.KMZLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){var t=new JSZip(e),r=t.file(/dae$/i);if(r.length){var a=r[0],i=(new n.ColladaLoader).parse(a.asText()),o=i.library.images;for(var s in o)!function(e){var r=decodeURI(e.init_from);r=r.replace("../","");var a=new RegExp(r+"$"),n=t.file(a);if(n.length){var i=n[0],o=new Blob([i.asArrayBuffer()],{type:"application/octet-binary"});e.build.src=URL.createObjectURL(o)}}(o[s]);return i}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new n.Group}}},t.default=n.KMZLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.KTXLoader=function(){this._parser=n.KTXLoader.parse},n.KTXLoader.prototype=Object.create(n.CompressedTextureLoader.prototype),n.KTXLoader.prototype.constructor=n.KTXLoader,n.KTXLoader.parse=function(e,t){var r=new i(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}};var i=function(){function e(t,r,a,n){this.arrayBuffer=t;var i=new Uint8Array(this.arrayBuffer,0,12);if(171!==i[0]||75!==i[1]||84!==i[2]||88!==i[3]||32!==i[4]||49!==i[5]||49!==i[6]||187!==i[7]||13!==i[8]||10!==i[9]||26!==i[10]||10!==i[11])return void console.error("texture missing KTX identifier");var o=new Int32Array(this.arrayBuffer,12,13),s=16909060===o[0];return this.glType=s?this.switchEndainness(o[1]):o[1],this.glTypeSize=s?this.switchEndainness(o[2]):o[2],this.glFormat=s?this.switchEndainness(o[3]):o[3],this.glInternalFormat=s?this.switchEndainness(o[4]):o[4],this.glBaseInternalFormat=s?this.switchEndainness(o[5]):o[5],this.pixelWidth=s?this.switchEndainness(o[6]):o[6],this.pixelHeight=s?this.switchEndainness(o[7]):o[7],this.pixelDepth=s?this.switchEndainness(o[8]):o[8],this.numberOfArrayElements=s?this.switchEndainness(o[9]):o[9],this.numberOfFaces=s?this.switchEndainness(o[10]):o[10],this.numberOfMipmapLevels=s?this.switchEndainness(o[11]):o[11],this.bytesOfKeyValueData=s?this.switchEndainness(o[12]):o[12],0!==this.glType?void console.warn("only compressed formats currently supported"):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?void console.warn("only 2D textures currently supported"):0!==this.numberOfArrayElements?void console.warn("texture arrays not currently supported"):this.numberOfFaces!==r?void console.warn("number of faces expected"+r+", but found "+this.numberOfFaces):void(this.loadType=e.COMPRESSED_2D))}return e.prototype.switchEndainness=function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255},e.prototype.mipmaps=function(t){for(var r=[],a=e.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,i=this.pixelHeight,o=t?this.numberOfMipmapLevels:1,s=0;s<o;s++){for(var l=new Int32Array(this.arrayBuffer,a,1)[0],u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,a+4,l);r.push({data:c,width:n,height:i}),a+=l+4,a+=3-(l+3)%4}n=Math.max(1,.5*n),i=Math.max(1,.5*i)}return r},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}();t.default=n.KTXLoader()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);void 0===n.LoaderSupport&&(n.LoaderSupport={}),n.LoaderSupport.Validator={isValid:function(e){return null!==e&&void 0!==e},verifyInput:function(e,t){return null===e||void 0===e?t:e}},n.LoaderSupport.ConsoleLogger=function(){function e(e,t){this.enabled=!1!==e,this.debug=!0===t}return e.prototype.setDebug=function(e){this.debug=!0===e},e.prototype.isDebug=function(){return this.isEnabled()&&this.debug},e.prototype.setEnabled=function(e){this.enabled=!0===e},e.prototype.isEnabled=function(){return this.enabled},e.prototype.logDebug=function(e){this.enabled&&this.debug&&console.info(e)},e.prototype.logInfo=function(e){this.enabled&&console.info(e)},e.prototype.logWarn=function(e){console.warn(e)},e.prototype.logError=function(e){console.error(e)},e.prototype.logTimeStart=function(e){this.enabled&&console.time(e)},e.prototype.logTimeEnd=function(e){this.enabled&&console.timeEnd(e)},e}(),n.LoaderSupport.Callbacks=function(){function e(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}var t=n.LoaderSupport.Validator;return e.prototype.setCallbackOnProgress=function(e){this.onProgress=t.verifyInput(e,this.onProgress)},e.prototype.setCallbackOnMeshAlter=function(e){this.onMeshAlter=t.verifyInput(e,this.onMeshAlter)},e.prototype.setCallbackOnLoad=function(e){this.onLoad=t.verifyInput(e,this.onLoad)},e.prototype.setCallbackOnLoadMaterials=function(e){this.onLoadMaterials=t.verifyInput(e,this.onLoadMaterials)},e}(),n.LoaderSupport.LoadedMeshUserOverride=function(){function e(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]}return e.prototype.addMesh=function(e){this.meshes.push(e),this.alteredMesh=!0},e.prototype.isDisregardMesh=function(){return this.disregardMesh},e.prototype.providesAlteredMeshes=function(){return this.alteredMesh},e}(),n.LoaderSupport.ResourceDescriptor=function(){function e(e,r){var a=e.split("/");a.length<2?(this.path=null,this.name=e,this.url=e):(this.path=t.verifyInput(a.slice(0,a.length-1).join("/")+"/",null),this.name=t.verifyInput(a[a.length-1],null),this.url=e),this.extension=t.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}var t=n.LoaderSupport.Validator;return e.prototype.setContent=function(e){this.content=t.verifyInput(e,null)},e}(),n.LoaderSupport.PrepData=function(){function e(e){this.modelName=t.verifyInput(e,""),this.resources=[],this.streamMeshesTo=null,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.callbacks=new n.LoaderSupport.Callbacks,this.crossOrigin,this.useAsync=!1}var t=n.LoaderSupport.Validator;return e.prototype.setStreamMeshesTo=function(e){this.streamMeshesTo=t.verifyInput(e,null)},e.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=!0===e},e.prototype.setUseIndices=function(e){this.useIndices=!0===e},e.prototype.setDisregardNormals=function(e){this.disregardNormals=!0===e},e.prototype.getCallbacks=function(){return this.callbacks},e.prototype.setCrossOrigin=function(e){this.crossOrigin=e},e.prototype.addResource=function(e){this.resources.push(e)},e.prototype.setUseAsync=function(e){this.useAsync=!0===e},e.prototype.clone=function(){var e=new n.LoaderSupport.PrepData(this.modelName);return e.resources=this.resources,e.streamMeshesTo=this.streamMeshesTo,e.materialPerSmoothingGroup=this.materialPerSmoothingGroup,e.useIndices=this.useIndices,e.disregardNormals=this.disregardNormals,e.callbacks=this.callbacks,e.crossOrigin=this.crossOrigin,e.useAsync=this.useAsync,e},e}(),n.LoaderSupport.Builder=function(){function e(e){this.logger=r.verifyInput(e,new a),this.logger.logInfo("Using THREE.LoaderSupport.Builder version: "+t),this.callbacks=new n.LoaderSupport.Callbacks,this.materials=[]}var t="1.1.1",r=n.LoaderSupport.Validator,a=n.LoaderSupport.ConsoleLogger;return e.prototype.setMaterials=function(e){var t={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:r.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(t)},e.prototype._setCallbacks=function(e){r.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),r.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),r.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),r.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},e.prototype.processPayload=function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},e.prototype.buildMeshes=function(e){var t=e.params.meshName,a=new n.BufferGeometry;a.addAttribute("position",new n.BufferAttribute(new Float32Array(e.buffers.vertices),3)),r.isValid(e.buffers.indices)&&a.setIndex(new n.BufferAttribute(new Uint32Array(e.buffers.indices),1)),r.isValid(e.buffers.colors)&&a.addAttribute("color",new n.BufferAttribute(new Float32Array(e.buffers.colors),3)),r.isValid(e.buffers.normals)?a.addAttribute("normal",new n.BufferAttribute(new Float32Array(e.buffers.normals),3)):a.computeVertexNormals(),r.isValid(e.buffers.uvs)&&a.addAttribute("uv",new n.BufferAttribute(new Float32Array(e.buffers.uvs),2));var i,o,s,l=e.materials.materialNames,u=e.materials.multiMaterial,c=[];for(s in l)o=l[s],i=this.materials[o],u&&c.push(i);if(u){i=c;var h,d=e.materials.materialGroups;for(s in d)h=d[s],a.addGroup(h.start,h.count,h.index)}var p,f,m=[],v=this.callbacks.onMeshAlter,g=!0;if(r.isValid(v)&&(f=v({detail:{meshName:t,bufferGeometry:a,material:i}}),r.isValid(f))){if(!f.isDisregardMesh()&&f.providesAlteredMeshes())for(var y in f.meshes)m.push(f.meshes[y]);g=!1}g&&(p=new n.Mesh(a,i),p.name=t,m.push(p));var b;if(r.isValid(m)&&m.length>0){var w=[];for(var y in m)p=m[y],w[y]=p.name;b="Adding mesh(es) ("+w.length+": "+w+") from input mesh: "+t,b+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else b="Not adding mesh: "+t,b+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var A=this.callbacks.onProgress;if(r.isValid(A)){A(new CustomEvent("BuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:b,numericalValue:e.progress.numericalValue}}))}return m},e.prototype.updateMaterials=function(e){var t,a,i=e.materials.materialCloneInstructions;if(r.isValid(i)){var o=i.materialNameOrg;t=this.materials[o].clone(),a=i.materialName,t.name=a;var s=i.materialProperties;for(var l in s)t.hasOwnProperty(l)&&s.hasOwnProperty(l)&&(t[l]=s[l]);this.materials[a]=t}var u=e.materials.serializedMaterials;if(r.isValid(u)&&Object.keys(u).length>0){var c,h=new n.MaterialLoader;for(a in u)c=u[a],r.isValid(c)&&(t=h.parse(c),this.logger.logInfo('De-serialized material with name "'+a+'" will be added.'),this.materials[a]=t)}if(u=e.materials.runtimeMaterials,r.isValid(u)&&Object.keys(u).length>0)for(a in u)t=u[a],this.logger.logInfo('Material with name "'+a+'" will be added.'),this.materials[a]=t},e.prototype.getMaterialsJSON=function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},e.prototype.getMaterials=function(){return this.materials},e}(),n.LoaderSupport.LoaderBase=function(){function e(e,a){this.manager=t.verifyInput(e,n.DefaultLoadingManager),this.logger=t.verifyInput(a,new r),this.modelName="",this.instanceNo=0,this.path="",this.useIndices=!1,this.disregardNormals=!1,this.loaderRootNode=new n.Group,this.builder=new n.LoaderSupport.Builder(this.logger),this._createDefaultMaterials(),this.callbacks=new n.LoaderSupport.Callbacks}var t=n.LoaderSupport.Validator,r=n.LoaderSupport.ConsoleLogger;return e.prototype._createDefaultMaterials=function(){var e=new n.MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new n.MeshStandardMaterial({color:14479871});t.name="vertexColorMaterial",t.vertexColors=n.VertexColors;var r={};r[e.name]=e,r[t.name]=t,this.builder.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:r}})},e.prototype._applyPrepData=function(e){t.isValid(e)&&(this.setModelName(e.modelName),this.setStreamMeshesTo(e.streamMeshesTo),this.builder.setMaterials(e.materials),this.setUseIndices(e.useIndices),this.setDisregardNormals(e.disregardNormals),this._setCallbacks(e.getCallbacks()))},e.prototype._setCallbacks=function(e){t.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),t.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),t.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),t.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials),this.builder._setCallbacks(this.callbacks)},e.prototype.getLogger=function(){return this.logger},e.prototype.setModelName=function(e){this.modelName=t.verifyInput(e,this.modelName)},e.prototype.setPath=function(e){this.path=t.verifyInput(e,this.path)},e.prototype.setStreamMeshesTo=function(e){this.loaderRootNode=t.verifyInput(e,this.loaderRootNode)},e.prototype.setMaterials=function(e){this.builder.setMaterials(e)},e.prototype.setUseIndices=function(e){this.useIndices=!0===e},e.prototype.setDisregardNormals=function(e){this.disregardNormals=!0===e},e.prototype.onProgress=function(e,r,a){var n=t.isValid(r)?r:"",i={detail:{type:e,modelName:this.modelName,instanceNo:this.instanceNo,text:n,numericalValue:a}};t.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(i),this.logger.logDebug(n)},e}(),n.LoaderSupport.WorkerRunnerRefImpl=function(){function e(){var e=this,t=function(t){e.processMessage(t.data)};self.addEventListener("message",t,!1)}return e.prototype.applyProperties=function(e,t){var r,a,n;for(r in t)a="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),n=t[r],"function"==typeof e[a]?e[a](n):e.hasOwnProperty(r)&&(e[r]=n)},e.prototype.processMessage=function(e){var t=e.logger.enabled,r=e.logger.enabled;if("run"===e.cmd){var a={callbackBuilder:function(e){self.postMessage(e)},callbackProgress:function(e){t&&r&&console.debug("WorkerRunner: progress: "+e)}},n=new Parser;"function"==typeof n.setLogConfig&&n.setLogConfig(t,r),this.applyProperties(n,e.params),this.applyProperties(n,e.materials),this.applyProperties(n,a),n.workerScope=self,n.parse(e.data.input,e.data.options),t&&console.log("WorkerRunner: Run complete!"),a.callbackBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)},e}(),n.LoaderSupport.WorkerSupport=function(){function e(e){if(this.logger=r.verifyInput(e,new n.LoaderSupport.ConsoleLogger),this.logger.logInfo("Using THREE.LoaderSupport.WorkerSupport version: "+t),void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new a(this.logger)}var t="2.0.1",r=n.LoaderSupport.Validator,a=function(){function e(e){this.logger=r.verifyInput(e,new n.LoaderSupport.ConsoleLogger),this._reset()}return e.prototype._reset=function(){this.worker=null,this.runnerImplName=null,this.callbacks={builder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1},e.prototype.initWorker=function(e,t){this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},e.prototype._receiveWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.builder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logger.logInfo("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":this.runtimeRef.logger.logError("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logger.logInfo("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:this.runtimeRef.logger.logError("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},e.prototype.setCallbacks=function(e,t){this.callbacks.builder=r.verifyInput(e,this.callbacks.builder),this.callbacks.onLoad=r.verifyInput(t,this.callbacks.onLoad)},e.prototype.run=function(e){if(r.isValid(this.queuedMessage))return void console.warn("Already processing message. Rejecting new run instruction");if(this.queuedMessage=e,this.started=!0,!r.isValid(this.callbacks.builder))throw'Unable to run as no "builder" callback is set.';if(!r.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),r.isValid(e.logger)?(e.logger.enabled=r.verifyInput(e.logger.enabled,!0),e.logger.debug=r.verifyInput(e.logger.debug,!1)):e.logger={enabled:!0,debug:!1},this._postMessage()},e.prototype._postMessage=function(){r.isValid(this.queuedMessage)&&r.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?this.worker.postMessage(this.queuedMessage,[this.queuedMessage.data.input]):this.worker.postMessage(this.queuedMessage))},e.prototype.setTerminateRequested=function(e){this.terminateRequested=!0===e,this.terminateRequested&&r.isValid(this.worker)&&!r.isValid(this.queuedMessage)&&this.started&&(this.logger.logInfo("Worker is terminated immediately as it is not running!"),this._terminate())},e.prototype._terminate=function(){this.worker.terminate(),this._reset()},e}();e.prototype.validate=function(e,t,a,s){if(!r.isValid(this.loaderWorker.worker)){this.logger.logInfo("WorkerSupport: Building worker code..."),this.logger.logTimeStart("buildWebWorkerCode"),r.isValid(s)?this.logger.logInfo('WorkerSupport: Using "'+s.name+'" as Runncer class for worker.'):(s=n.LoaderSupport.WorkerRunnerRefImpl,this.logger.logInfo('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.WorkerRunnerRefImpl" as Runncer class for worker.'));var l=e(i,o);l+=o(s.name,s.name,s),l+="new "+s.name+"();\n\n";var u=this;if(r.isValid(t)&&t.length>0){var c="";!function e(t,r){if(0===r.length)u.loaderWorker.initWorker(c+l,u.logger,s.name),u.logger.logTimeEnd("buildWebWorkerCode");else{var a=function(a){c+=a,e(t,r)},i=new n.FileLoader;i.setPath(t),i.setResponseType("text"),i.load(r[0],a),r.shift()}}(a,t)}else this.loaderWorker.initWorker(l,this.logger,s.name),this.logger.logTimeEnd("buildWebWorkerCode")}},e.prototype.setCallbacks=function(e,t){this.loaderWorker.setCallbacks(e,t)},e.prototype.run=function(e){this.loaderWorker.run(e)},e.prototype.setTerminateRequested=function(e){this.loaderWorker.setTerminateRequested(e)};var i=function(e,t){var r,a=e+" = {\n";for(var n in t)r=t[n],"string"==typeof r||r instanceof String?(r=r.replace("\n","\\n"),r=r.replace("\r","\\r"),a+="\t"+n+': "'+r+'",\n'):r instanceof Array?a+="\t"+n+": ["+r+"],\n":Number.isInteger(r)?a+="\t"+n+": "+r+",\n":"function"==typeof r&&(a+="\t"+n+": "+r+",\n");return a+="}\n\n"},o=function(e,t,r){var a=e+" = (function () {\n\n";a+="\t"+r.prototype.constructor.toString()+"\n\n",a=a.replace(r.name,t);var n,i;for(var o in r.prototype)"function"==typeof(i=r.prototype[o])&&(n=i.toString(),a+="\t"+t+".prototype."+o+" = "+n+";\n\n");return a+="\treturn "+t+";\n",a+="})();\n\n"};return e}(),n.LoaderSupport.WorkerDirector=function(){function e(e,o){if(this.logger=r.verifyInput(o,new n.LoaderSupport.ConsoleLogger),this.logger.logInfo("Using THREE.LoaderSupport.WorkerDirector version: "+t),this.maxQueueSize=i,this.maxWebWorkers=a,this.crossOrigin=null,!r.isValid(e))throw"Provided invalid classDef: "+e;this.workerDescription={classDef:e,globalCallbacks:{},workerSupports:{}},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}var t="2.1.0",r=n.LoaderSupport.Validator,a=16,i=8192;return e.prototype.getMaxQueueSize=function(){return this.maxQueueSize},e.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},e.prototype.setCrossOrigin=function(e){this.crossOrigin=e},e.prototype.prepareWorkers=function(e,t,o){r.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(t,i),this.maxWebWorkers=Math.min(o,a),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var s=0;s<this.maxWebWorkers;s++)this.workerDescription.workerSupports[s]={instanceNo:s,inUse:!1,terminateRequested:!1,workerSupport:new n.LoaderSupport.WorkerSupport(this.logger),loader:null}},e.prototype.enqueueForRun=function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},e.prototype.isRunning=function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},e.prototype.processQueue=function(){var e,t;for(var r in this.workerDescription.workerSupports)t=this.workerDescription.workerSupports[r],t.inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},e.prototype._kickWorkerRun=function(e,t){t.inUse=!0,t.workerSupport.setTerminateRequested(t.terminateRequested),this.logger.logInfo("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var a=this,i=e.getCallbacks(),o=this.workerDescription.globalCallbacks,s=function(e){r.isValid(o.onLoad)&&o.onLoad(e),r.isValid(i.onLoad)&&i.onLoad(e),a.objectsCompleted++,t.inUse=!1,a.processQueue()},l=function(e){r.isValid(o.onProgress)&&o.onProgress(e),r.isValid(i.onProgress)&&i.onProgress(e)},u=function(e){r.isValid(o.onMeshAlter)&&o.onMeshAlter(e),r.isValid(i.onMeshAlter)&&i.onMeshAlter(e)};t.loader=this._buildLoader(t.instanceNo);var c=new n.LoaderSupport.Callbacks;c.setCallbackOnLoad(s),c.setCallbackOnProgress(l),c.setCallbackOnMeshAlter(u),e.callbacks=c,t.loader.run(e,t.workerSupport)},e.prototype._buildLoader=function(e){var t=this.workerDescription.classDef,a=Object.create(t.prototype);if(this.workerDescription.classDef.call(a,n.DefaultLoadingManager,this.logger),!a.hasOwnProperty("instanceNo"))throw t.name+' has no property "instanceNo".';if(a.instanceNo=e,!a.hasOwnProperty("workerSupport"))throw t.name+' has no property "workerSupport".';if("function"!=typeof a.run)throw t.name+' has no function "run".';return a.hasOwnProperty("callbacks")&&r.isValid(a.callbacks)||(this.logger.logWarn(t.name+' has an invalid property "callbacks". Will change to "THREE.LoaderSupport.Callbacks"'),a.callbacks=new n.LoaderSupport.Callbacks),a},e.prototype._deregister=function(e){if(r.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logger.logInfo("Requested termination of worker #"+e.instanceNo+".");var t=e.loader.callbacks;r.isValid(t.onProgress)&&t.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},e.prototype.tearDown=function(e){this.logger.logInfo("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=r.verifyInput(e,null);for(var t in this.workerDescription.workerSupports)this.workerDescription.workerSupports[t].terminateRequested=!0},e}(),t.default=n.LoaderSupport},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.MD2Loader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.MD2Loader.prototype={constructor:n.MD2Loader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(){var e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(t){console.time("MD2Loader");for(var r=new DataView(t),a={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],o=0;o<i.length;o++)a[i[o]]=r.getInt32(4*o,!0);if(844121161!==a.ident||8!==a.version)return void console.error("Not a valid MD2 file");if(a.offset_end!==r.byteLength)return void console.error("Corrupted MD2 file");for(var s=new n.Geometry,l=[],u=a.offset_st,o=0,c=a.num_st;o<c;o++){var h=r.getInt16(u+0,!0),d=r.getInt16(u+2,!0);l.push(new n.Vector2(h/a.skinwidth,1-d/a.skinheight)),u+=4}for(var u=a.offset_tris,o=0,c=a.num_tris;o<c;o++){var p=r.getUint16(u+0,!0),f=r.getUint16(u+2,!0),m=r.getUint16(u+4,!0);s.faces.push(new n.Face3(p,f,m)),s.faceVertexUvs[0].push([l[r.getUint16(u+6,!0)],l[r.getUint16(u+8,!0)],l[r.getUint16(u+10,!0)]]),u+=12}for(var v=new n.Vector3,g=new n.Vector3,y=[],u=a.offset_frames,o=0,c=a.num_frames;o<c;o++){g.set(r.getFloat32(u+0,!0),r.getFloat32(u+4,!0),r.getFloat32(u+8,!0)),v.set(r.getFloat32(u+12,!0),r.getFloat32(u+16,!0),r.getFloat32(u+20,!0)),u+=24;for(var b=0;b<16;b++){var w=r.getUint8(u+b,!0);if(0===w)break;y[b]=w}var A={name:String.fromCharCode.apply(null,y),vertices:[],normals:[]};u+=16;for(var b=0;b<a.num_vertices;b++){var M=r.getUint8(u++,!0),x=r.getUint8(u++,!0),L=r.getUint8(u++,!0),E=e[r.getUint8(u++,!0)],T=new n.Vector3(M*g.x+v.x,L*g.z+v.z,x*g.y+v.y),k=new n.Vector3(E[0],E[2],E[1]);A.vertices.push(T),A.normals.push(k)}s.morphTargets.push(A)}s.vertices=s.morphTargets[0].vertices;for(var _=s.morphTargets[0],b=0,N=s.faces.length;b<N;b++){var C=s.faces[b];C.vertexNormals=[_.normals[C.a],_.normals[C.b],_.normals[C.c]]}for(var o=0,c=s.morphTargets.length;o<c;o++){for(var _=s.morphTargets[o],S=[],b=0,N=s.faces.length;b<N;b++){var C=s.faces[b];S.push({a:_.normals[C.a],b:_.normals[C.b],c:_.normals[C.c]})}s.morphNormals.push({vertexNormals:S})}return s.animations=n.AnimationClip.CreateClipsFromMorphTargetSequences(s.morphTargets,10),console.timeEnd("MD2Loader"),s}}()},t.default=n.MD2Loader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.MMDLoader=function(e){n.Loader.call(this),this.manager=void 0!==e?e:n.DefaultLoadingManager,this.parser=new MMDParser.Parser,this.textureCrossOrigin=null},n.MMDLoader.prototype=Object.create(n.Loader.prototype),n.MMDLoader.prototype.constructor=n.MMDLoader,n.MMDLoader.prototype.defaultToonTextures=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],n.MMDLoader.prototype.setTextureCrossOrigin=function(e){this.textureCrossOrigin=e},n.MMDLoader.prototype.load=function(e,t,r,a,n){var i=this;this.loadModel(e,function(e){i.loadVmds(t,function(t){i.pourVmdIntoModel(e,t),r(e)},a,n)},a,n)},n.MMDLoader.prototype.loadModel=function(e,t,r,a){var i=this,o=n.LoaderUtils.extractUrlBase(e),s=this.extractExtension(e);this.loadFileAsBuffer(e,function(e){t(i.createModel(e,s,o,r,a))},r,a)},n.MMDLoader.prototype.createModel=function(e,t,r,a,n){return this.createMesh(this.parseModel(e,t),r,a,n)},n.MMDLoader.prototype.loadVmd=function(e,t,r,a){var n=this;this.loadFileAsBuffer(e,function(e){t(n.parseVmd(e))},r,a)},n.MMDLoader.prototype.loadVmds=function(e,t,r,a){function n(){var s=e.shift();i.loadVmd(s,function(r){o.push(r),e.length>0?n():t(i.mergeVmds(o))},r,a)}var i=this,o=[];e=e.slice(),n()},n.MMDLoader.prototype.loadAudio=function(e,t,r,a){var i=new n.AudioListener,o=new n.Audio(i);new n.AudioLoader(this.manager).load(e,function(e){o.setBuffer(e),t(o,i)},r,a)},n.MMDLoader.prototype.loadVpd=function(e,t,r,a,n){var i=this;(n&&"unicode"===n.charcode?this.loadFileAsText:this.loadFileAsShiftJISText).bind(this)(e,function(e){t(i.parseVpd(e))},r,a)},n.MMDLoader.prototype.parseModel=function(e,t){switch(t.toLowerCase()){case"pmd":return this.parsePmd(e);case"pmx":return this.parsePmx(e);default:throw"extension "+t+" is not supported."}},n.MMDLoader.prototype.parsePmd=function(e){return this.parser.parsePmd(e,!0)},n.MMDLoader.prototype.parsePmx=function(e){return this.parser.parsePmx(e,!0)},n.MMDLoader.prototype.parseVmd=function(e){return this.parser.parseVmd(e,!0)},n.MMDLoader.prototype.parseVpd=function(e){return this.parser.parseVpd(e,!0)},n.MMDLoader.prototype.mergeVmds=function(e){return this.parser.mergeVmds(e)},n.MMDLoader.prototype.pourVmdIntoModel=function(e,t,r){this.createAnimation(e,t,r)},n.MMDLoader.prototype.pourVmdIntoCamera=function(e,t,r){var a=new n.MMDLoader.DataCreationHelper;!function(){for(var i=a.createOrderedMotionArray(t.cameras),o=[],s=[],l=[],u=[],c=[],h=[],d=[],p=[],f=[],m=new n.Quaternion,v=new n.Euler,g=new n.Vector3,y=new n.Vector3,b=function(e,t){e.push(t.x),e.push(t.y),e.push(t.z)},w=function(e,t,r){e.push(t[4*r+0]/127),e.push(t[4*r+1]/127),e.push(t[4*r+2]/127),e.push(t[4*r+3]/127)},A=function(e,t,r,a,i){if(r.length>2){r=r.slice(),a=a.slice(),i=i.slice();for(var o=a.length/r.length,s=3===o?12:4,l=1,u=2,c=r.length;u<c;u++){for(var h=0;h<o;h++)if(a[l*o+h]!==a[(l-1)*o+h]||a[l*o+h]!==a[u*o+h]){l++;break}if(u>l){r[l]=r[u];for(var h=0;h<o;h++)a[l*o+h]=a[u*o+h];for(var h=0;h<s;h++)i[l*s+h]=i[u*s+h]}}r.length=l+1,a.length=(l+1)*o,i.length=(l+1)*s}return new n.MMDLoader[t](e,r,a,i)},M=0;M<i.length;M++){var x=i[M],L=x.frameNum/30,E=x.position,T=x.rotation,k=x.distance,_=x.fov,N=x.interpolation;g.set(0,0,-k),y.set(E[0],E[1],E[2]),v.set(-T[0],-T[1],-T[2]),m.setFromEuler(v),g.add(y),g.applyQuaternion(m),o.length>0&&L<o[o.length-1]+.05&&(o[o.length-1]=L-1e-13),o.push(L),b(s,y),function(e,t){e.push(t.x),e.push(t.y),e.push(t.z),e.push(t.w)}(l,m),b(u,g),c.push(_);for(var C=0;C<3;C++)w(h,N,C);w(d,N,3);for(var C=0;C<3;C++)w(p,N,4);w(f,N,5)}if(0!==o.length){var S=[];S.push(A(".center","VectorKeyframeTrackEx",o,s,h)),S.push(A(".quaternion","QuaternionKeyframeTrackEx",o,l,d)),S.push(A(".position","VectorKeyframeTrackEx",o,u,p)),S.push(A(".fov","NumberKeyframeTrackEx",o,c,f));var O=new n.AnimationClip(void 0===r?n.Math.generateUUID():r,-1,S);void 0===e.center&&(e.center=new n.Vector3(0,0,0)),void 0===e.animations&&(e.animations=[]),e.animations.push(O)}}()},n.MMDLoader.prototype.extractExtension=function(e){var t=e.lastIndexOf(".");return t<0?null:e.slice(t+1)},n.MMDLoader.prototype.loadFile=function(e,t,r,a,i,o){var s=new n.FileLoader(this.manager);return void 0!==o&&s.setMimeType(o),s.setResponseType(i),s.load(e,function(e){t(e)},r,a)},n.MMDLoader.prototype.loadFileAsBuffer=function(e,t,r,a){this.loadFile(e,t,r,a,"arraybuffer")},n.MMDLoader.prototype.loadFileAsText=function(e,t,r,a){this.loadFile(e,t,r,a,"text")},n.MMDLoader.prototype.loadFileAsShiftJISText=function(e,t,r,a){this.loadFile(e,t,r,a,"text","text/plain; charset=shift_jis")},n.MMDLoader.prototype.createMesh=function(e,t,r,a){var i=this,o=new n.BufferGeometry,s=[],l={};l.vertices=[],l.uvs=[],l.normals=[],l.skinIndices=[],l.skinWeights=[],l.indices=[];return function(){for(var t=0;t<e.metadata.vertexCount;t++){for(var r=e.vertices[t],a=0,n=r.position.length;a<n;a++)l.vertices.push(r.position[a]);for(var a=0,n=r.normal.length;a<n;a++)l.normals.push(r.normal[a]);for(var a=0,n=r.uv.length;a<n;a++)l.uvs.push(r.uv[a]);for(var a=0;a<4;a++)l.skinIndices.push(r.skinIndices.length-1>=a?r.skinIndices[a]:0);for(var a=0;a<4;a++)l.skinWeights.push(r.skinWeights.length-1>=a?r.skinWeights[a]:0)}}(),function(){for(var t=0;t<e.metadata.faceCount;t++)for(var r=e.faces[t],a=0,n=r.indices.length;a<n;a++)l.indices.push(r.indices[a])}(),function(){for(var t=[],r=e.rigidBodies,a={},n=0,i=r.length;n<i;n++){var s=r[n],l=a[s.boneIndex];l=void 0===l?s.type:Math.max(s.type,l),a[s.boneIndex]=l}for(var n=0;n<e.metadata.boneCount;n++){var u={},c=e.bones[n];u.parent=c.parentIndex,u.name=c.name,u.pos=[c.position[0],c.position[1],c.position[2]],u.rotq=[0,0,0,1],u.scl=[1,1,1],-1!==u.parent&&(u.pos[0]-=e.bones[u.parent].position[0],u.pos[1]-=e.bones[u.parent].position[1],u.pos[2]-=e.bones[u.parent].position[2]),u.rigidBodyType=void 0!==a[n]?a[n]:-1,t.push(u)}o.bones=t}(),function(){var t=[];if("pmd"===e.metadata.format)for(var r=0;r<e.metadata.ikCount;r++){var a=e.iks[r],i={};i.target=a.target,i.effector=a.effector,i.iteration=a.iteration,i.maxAngle=4*a.maxAngle,i.links=[];for(var s=0;s<a.links.length;s++){var l={};l.index=a.links[s].index,e.bones[l.index].name.indexOf("")>=0&&(l.limitation=new n.Vector3(1,0,0)),i.links.push(l)}t.push(i)}else for(var r=0;r<e.metadata.boneCount;r++){var u=e.bones[r],a=u.ik;if(void 0!==a){var i={};i.target=r,i.effector=a.effector,i.iteration=a.iteration,i.maxAngle=a.maxAngle,i.links=[];for(var s=0;s<a.links.length;s++){var l={};l.index=a.links[s].index,l.enabled=!0,1===a.links[s].angleLimitation&&(l.limitation=new n.Vector3(1,0,0)),i.links.push(l)}t.push(i)}}o.iks=t}(),function(){if("pmd"!==e.metadata.format){for(var t=[],r=0;r<e.metadata.boneCount;r++){var a=e.bones[r],n=a.grant;if(void 0!==n){var i={};i.index=r,i.parentIndex=n.parentIndex,i.ratio=n.ratio,i.isLocal=n.isLocal,i.affectRotation=n.affectRotation,i.affectPosition=n.affectPosition,i.transformationClass=a.transformationClass,t.push(i)}}t.sort(function(e,t){return e.transformationClass-t.transformationClass}),o.grants=t}}(),function(){function t(e,t,r,a){e.array[3*t+0]+=r.position[0]*a,e.array[3*t+1]+=r.position[1]*a,e.array[3*t+2]+=r.position[2]*a}function r(r,a,n){for(var i=0;i<a.elementCount;i++){var o,s=a.elements[i];o="pmd"===e.metadata.format?e.morphs[0].elements[s.index].index:s.index,t(r,o,s,n)}}for(var a=[],i=[],s=0;s<e.metadata.morphCount;s++){var u=e.morphs[s],c={name:u.name},h=new n.Float32BufferAttribute(3*e.metadata.vertexCount,3);h.name=u.name;for(var d=0;d<3*e.metadata.vertexCount;d++)h.array[d]=l.vertices[d];if("pmd"===e.metadata.format)0!==s&&r(h,u,1);else if(0===u.type)for(var d=0;d<u.elementCount;d++){var p=e.morphs[u.elements[d].index],f=u.elements[d].ratio;1===p.type&&r(h,p,f)}else 1===u.type?r(h,u,1):2===u.type||3===u.type||4===u.type||5===u.type||6===u.type||7===u.type||u.type;a.push(c),i.push(h)}o.morphTargets=a,o.morphAttributes.position=i}(),function(){function l(e,o){void 0===o&&(o={});var s;if(!0===o.defaultTexturePath)try{s=i.defaultToonTextures[parseInt(e.match("toon([0-9]{2}).bmp$")[1])]}catch(t){console.warn("THREE.MMDLoader: "+e+" seems like not right default texture path. Using toon00.bmp instead."),s=i.defaultToonTextures[0]}else s=t+e;if(void 0!==c[s])return s;var l=n.Loader.Handlers.get(s);null===l&&(l=e.indexOf(".tga")>=0?d:h);var u=l.load(s,function(e){if(!0===o.isToonTexture){var t=e.image,r=t.width,a=t.height;p.width=r,p.height=a,f.clearRect(0,0,r,a),f.translate(r/2,a/2),f.rotate(.5*Math.PI),f.translate(-r/2,-a/2),f.drawImage(t,0,0),e.image=f.getImageData(0,0,r,a)}e.flipY=!1,e.wrapS=n.RepeatWrapping,e.wrapT=n.RepeatWrapping;for(var i=0;i<u.readyCallbacks.length;i++)u.readyCallbacks[i](u);delete u.readyCallbacks},r,a);return!0===o.sphericalReflectionMapping&&(u.mapping=n.SphericalReflectionMapping),u.readyCallbacks=[],c[s]=u,s}function u(e,t){return void 0===t[e]&&console.warn("THREE.MMDLoader: Undefined texture",e),t[e]}var c={},h=new n.TextureLoader(i.manager),d=new n.TGALoader(i.manager),p=document.createElement("canvas"),f=p.getContext("2d"),m=0,v=[];null!==i.textureCrossOrigin&&h.setCrossOrigin(i.textureCrossOrigin);for(var g=0;g<e.metadata.materialCount;g++){var y=e.materials[g],b={};if(b.faceOffset=m,b.faceNum=y.faceCount,m+=y.faceCount,b.name=y.name,b.color=new n.Color(y.diffuse[0],y.diffuse[1],y.diffuse[2]),b.opacity=y.diffuse[3],b.specular=new n.Color(y.specular[0],y.specular[1],y.specular[2]),b.shininess=y.shininess,1===b.opacity?(b.side=n.FrontSide,b.transparent=!1):(b.side=n.DoubleSide,b.transparent=!0),"pmd"===e.metadata.format){if(y.fileName){var w=y.fileName,A=[],M=w.lastIndexOf("*");M>=0?(A.push(w.slice(0,M)),A.push(w.slice(M+1))):A.push(w);for(var x=0;x<A.length;x++){var L=A[x];L.indexOf(".sph")>=0||L.indexOf(".spa")>=0?(b.envMap=l(L,{sphericalReflectionMapping:!0}),L.indexOf(".sph")>=0?b.envMapType=n.MultiplyOperation:b.envMapType=n.AddOperation):b.map=l(L)}}}else{if(-1!==y.textureIndex){var L=e.textures[y.textureIndex];b.map=l(L)}if(-1!==y.envTextureIndex&&(1===y.envFlag||2==y.envFlag)){var L=e.textures[y.envTextureIndex];b.envMap=l(L,{sphericalReflectionMapping:!0}),1===y.envFlag?b.envMapType=n.MultiplyOperation:b.envMapType=n.AddOperation}}var E=void 0===b.map?1:.2;b.emissive=new n.Color(y.ambient[0]*E,y.ambient[1]*E,y.ambient[2]*E),v.push(b)}for(var g=0;g<v.length;g++){var T=v[g],k=e.materials[g],y=new n.MeshToonMaterial;if(o.addGroup(3*T.faceOffset,3*T.faceNum,g),void 0!==T.name&&(y.name=T.name),y.skinning=o.bones.length>0,y.morphTargets=o.morphTargets.length>0,y.lights=!0,y.side="pmx"===e.metadata.format&&1==(1&k.flag)?n.DoubleSide:T.side,y.transparent=T.transparent,y.fog=!0,y.blending=n.CustomBlending,y.blendSrc=n.SrcAlphaFactor,y.blendDst=n.OneMinusSrcAlphaFactor,y.blendSrcAlpha=n.SrcAlphaFactor,y.blendDstAlpha=n.DstAlphaFactor,void 0!==T.map){y.faceOffset=T.faceOffset,y.faceNum=T.faceNum,y.map=u(T.map,c),function(e){e.map.readyCallbacks.push(function(t){function r(e,t){var r=e.width,a=e.height,n=Math.round(t.x*r)%r,i=Math.round(t.y*a)%a;n<0&&(n+=r),i<0&&(i+=a);var o=i*r+n;return e.data[4*o+3]}var a=void 0!==t.image.data?t.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,t.width,t.height)}(t.image),n=o.index.array.slice(3*e.faceOffset,3*e.faceOffset+3*e.faceNum);(function(e,t,a){var n=e.width,i=e.height,o=e.data;if(o.length/(n*i)!=4)return!1;for(var s=0;s<a.length;s+=3){for(var l={x:0,y:0},u=0;u<3;u++){var c=a[3*s+u],h={x:t[2*c+0],y:t[2*c+1]};if(r(e,h)<253)return!0;l.x+=h.x,l.y+=h.y}if(l.x/=3,l.y/=3,r(e,l)<253)return!0}return!1})(a,o.attributes.uv.array,n)&&(e.transparent=!0),delete e.faceOffset,delete e.faceNum})}(y)}if(void 0!==T.envMap&&(y.envMap=u(T.envMap,c),y.combine=T.envMapType),y.opacity=T.opacity,y.color=T.color,void 0!==T.emissive&&(y.emissive=T.emissive),y.specular=T.specular,y.shininess=Math.max(T.shininess,1e-4),"pmd"===e.metadata.format){y.outlineParameters={thickness:1===k.edgeFlag?.003:0,color:new n.Color(0,0,0),alpha:1},0===y.outlineParameters.thickness&&(y.outlineParameters.visible=!1);var _=-1===k.toonIndex?"toon00.bmp":e.toonTextures[k.toonIndex].fileName,N=l(_,{isToonTexture:!0,defaultTexturePath:function(e){return 10===e.length&&null!==e.match(/toon(10|0[0-9]).bmp/)}(_)});y.gradientMap=u(N,c)}else{y.outlineParameters={thickness:k.edgeSize/300,color:new n.Color(k.edgeColor[0],k.edgeColor[1],k.edgeColor[2]),alpha:k.edgeColor[3]},0!=(16&k.flag)&&0!==y.outlineParameters.thickness||(y.outlineParameters.visible=!1);var _,C;if(-1===k.toonIndex||0!==k.toonFlag){var S=k.toonIndex+1;_="toon"+(S<10?"0"+S:S)+".bmp",C=!0}else _=e.textures[k.toonIndex],C=!1;var N=l(_,{isToonTexture:!0,defaultTexturePath:C});y.gradientMap=u(N,c)}s.push(y)}if("pmx"===e.metadata.format)for(var O=function(e,t){if(8===e.type)for(var r=0;r<t.length;r++){var a=t[r];if(-1!==a.index){var n=s[a.index];n.opacity!==a.diffuse[3]&&(n.transparent=!0)}}},g=0;g<e.morphs.length;g++){var F=e.morphs[g],P=F.elements;if(0===F.type)for(var x=0;x<P.length;x++){var R=e.morphs[P[x].index],I=R.elements;O(R,I)}else O(F,P)}}(),function(){for(var t=[],r=[],a=0;a<e.metadata.rigidBodyCount;a++){for(var n=e.rigidBodies[a],i=Object.keys(n),s={},l=0;l<i.length;l++){var u=i[l];s[u]=n[u]}if("pmx"===e.metadata.format&&-1!==s.boneIndex){var c=e.bones[s.boneIndex];s.position[0]-=c.position[0],s.position[1]-=c.position[1],s.position[2]-=c.position[2]}t.push(s)}for(var a=0;a<e.metadata.constraintCount;a++){for(var h=e.constraints[a],i=Object.keys(h),s={},l=0;l<i.length;l++){var u=i[l];s[u]=h[u]}var d=t[s.rigidBodyIndex1],p=t[s.rigidBodyIndex2];0!==d.type&&2===p.type&&-1!==d.boneIndex&&-1!==p.boneIndex&&e.bones[p.boneIndex].parentIndex===d.boneIndex&&(p.type=1),r.push(s)}o.rigidBodies=t,o.constraints=r}(),function(){o.setIndex(l.indices),o.addAttribute("position",new n.Float32BufferAttribute(l.vertices,3)),o.addAttribute("normal",new n.Float32BufferAttribute(l.normals,3)),o.addAttribute("uv",new n.Float32BufferAttribute(l.uvs,2)),o.addAttribute("skinIndex",new n.Float32BufferAttribute(l.skinIndices,4)),o.addAttribute("skinWeight",new n.Float32BufferAttribute(l.skinWeights,4)),o.computeBoundingSphere(),o.mmdFormat=e.metadata.format}(),new n.SkinnedMesh(o,s)},n.MMDLoader.prototype.createAnimation=function(e,t,r){var a=new n.MMDLoader.DataCreationHelper;!function(){if(0!==t.metadata.motionCount){for(var i=e.geometry.bones,o=a.createOrderedMotionArrays(i,t.motions,"boneName"),s=[],l=function(e,t,r){e.push(t[r+0]/127),e.push(t[r+8]/127),e.push(t[r+4]/127),e.push(t[r+12]/127)},u=0;u<o.length;u++){for(var c=[],h=[],d=[],p=[],f=[],m=i[u],v=o[u],g=0;g<v.length;g++){var y=v[g].frameNum/30,b=v[g].position,w=v[g].rotation,A=v[g].interpolation;c.push(y);for(var M=0;M<3;M++)h.push(m.pos[M]+b[M]);for(var M=0;M<4;M++)d.push(w[M]);for(var M=0;M<3;M++)l(p,A,M);l(f,A,3)}if(0!==c.length){var x=".bones["+m.name+"]";s.push(new n.MMDLoader.VectorKeyframeTrackEx(x+".position",c,h,p)),s.push(new n.MMDLoader.QuaternionKeyframeTrackEx(x+".quaternion",c,d,f))}}var L=new n.AnimationClip(void 0===r?n.Math.generateUUID():r,-1,s);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(L)}}(),function(){if(0!==t.metadata.morphCount){for(var i=a.createOrderedMotionArrays(e.geometry.morphTargets,t.morphs,"morphName"),o=[],s=0;s<i.length;s++){for(var l=[],u=[],c=i[s],h=0;h<c.length;h++)l.push(c[h].frameNum/30),u.push(c[h].weight);0!==l.length&&o.push(new n.NumberKeyframeTrack(".morphTargetInfluences["+s+"]",l,u))}var d=new n.AnimationClip(void 0===r?n.Math.generateUUID():r+"Morph",-1,o);void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(d)}}()},n.MMDLoader.DataCreationHelper=function(){},n.MMDLoader.DataCreationHelper.prototype={constructor:n.MMDLoader.DataCreationHelper,toCharcodeStrings:function(e){for(var t="",r=0;r<e.length;r++)t+="0x"+("0000"+e[r].charCodeAt().toString(16)).substr(-4);return t},createDictionary:function(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=r;return t},initializeMotionArrays:function(e){for(var t=[],r=0;r<e.length;r++)t[r]=[];return t},sortMotionArray:function(e){e.sort(function(e,t){return e.frameNum-t.frameNum})},sortMotionArrays:function(e){for(var t=0;t<e.length;t++)this.sortMotionArray(e[t])},createMotionArray:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},createMotionArrays:function(e,t,r,a){for(var n=0;n<e.length;n++){var i=e[n],o=r[i[a]];void 0!==o&&t[o].push(i)}},createOrderedMotionArray:function(e){var t=this.createMotionArray(e);return this.sortMotionArray(t),t},createOrderedMotionArrays:function(e,t,r){var a=this.createDictionary(e),n=this.initializeMotionArrays(e);return this.createMotionArrays(t,n,a,r),this.sortMotionArrays(n),n}},n.MMDLoader.VectorKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),n.VectorKeyframeTrack.call(this,e,t,r)},n.MMDLoader.VectorKeyframeTrackEx.prototype=Object.create(n.VectorKeyframeTrack.prototype),n.MMDLoader.VectorKeyframeTrackEx.prototype.constructor=n.MMDLoader.VectorKeyframeTrackEx,n.MMDLoader.VectorKeyframeTrackEx.prototype.TimeBufferType=Float64Array,n.MMDLoader.VectorKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new n.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},n.MMDLoader.VectorKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},n.MMDLoader.QuaternionKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),n.QuaternionKeyframeTrack.call(this,e,t,r)},n.MMDLoader.QuaternionKeyframeTrackEx.prototype=Object.create(n.QuaternionKeyframeTrack.prototype),n.MMDLoader.QuaternionKeyframeTrackEx.prototype.constructor=n.MMDLoader.QuaternionKeyframeTrackEx,n.MMDLoader.QuaternionKeyframeTrackEx.prototype.TimeBufferType=Float64Array,n.MMDLoader.QuaternionKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new n.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},n.MMDLoader.QuaternionKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},n.MMDLoader.NumberKeyframeTrackEx=function(e,t,r,a){this.interpolationParameters=new Float32Array(a),n.NumberKeyframeTrack.call(this,e,t,r)},n.MMDLoader.NumberKeyframeTrackEx.prototype=Object.create(n.NumberKeyframeTrack.prototype),n.MMDLoader.NumberKeyframeTrackEx.prototype.constructor=n.MMDLoader.NumberKeyframeTrackEx,n.MMDLoader.NumberKeyframeTrackEx.prototype.TimeBufferType=Float64Array,n.MMDLoader.NumberKeyframeTrackEx.prototype.InterpolantFactoryMethodCubicBezier=function(e){return new n.MMDLoader.CubicBezierInterpolation(this.times,this.values,this.getValueSize(),e,this.interpolationParameters)},n.MMDLoader.NumberKeyframeTrackEx.prototype.setInterpolation=function(e){this.createInterpolant=this.InterpolantFactoryMethodCubicBezier},n.MMDLoader.CubicBezierInterpolation=function(e,t,r,a,i){n.Interpolant.call(this,e,t,r,a),this.params=i},n.MMDLoader.CubicBezierInterpolation.prototype=Object.create(n.LinearInterpolant.prototype),n.MMDLoader.CubicBezierInterpolation.prototype.constructor=n.MMDLoader.CubicBezierInterpolation,n.MMDLoader.CubicBezierInterpolation.prototype.interpolate_=function(e,t,r,a){var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,l=e*s,u=l-s,c=(r-t)/(a-t);if(4===s){var h=this.params[4*e+0],d=this.params[4*e+1],p=this.params[4*e+2],f=this.params[4*e+3],m=this._calculate(h,d,p,f,c);n.Quaternion.slerpFlat(i,0,o,u,o,l,m)}else if(3===s)for(var v=0;v!==s;++v){var h=this.params[12*e+4*v+0],d=this.params[12*e+4*v+1],p=this.params[12*e+4*v+2],f=this.params[12*e+4*v+3],m=this._calculate(h,d,p,f,c);i[v]=o[u+v]*(1-m)+o[l+v]*m}else{var h=this.params[4*e+0],d=this.params[4*e+1],p=this.params[4*e+2],f=this.params[4*e+3],m=this._calculate(h,d,p,f,c);i[0]=o[u]*(1-m)+o[l]*m}return i},n.MMDLoader.CubicBezierInterpolation.prototype._calculate=function(e,t,r,a,n){for(var i,o,s,l=.5,u=l,c=1-u,h=Math,d=0;d<15;d++){i=3*c*c*u,o=3*c*u*u,s=u*u*u;var p=i*e+o*t+s-n;if(h.abs(p)<1e-5)break;l/=2,u+=p<0?l:-l,c=1-u}return i*r+o*a+s},n.MMDAudioManager=function(e,t,r){var a=null===r||void 0===r?{}:r;this.audio=e,this.listener=t,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==a.delayTime?a.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime},n.MMDAudioManager.prototype={constructor:n.MMDAudioManager,control:function(e){this.elapsed+=e,this.currentTime+=e,this.checkIfStopAudio()&&this.audio.stop(),this.checkIfStartAudio()&&this.audio.play()},checkIfStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&(this.audio.startTime=this.currentTime-this.delayTime,!0)},checkIfStopAudio:function(){return!!this.audio.isPlaying&&this.currentTime>=this.duration}},n.MMDGrantSolver=function(e){this.mesh=e},n.MMDGrantSolver.prototype={constructor:n.MMDGrantSolver,update:function(){var e=new n.Quaternion;return function(){for(var t=0;t<this.mesh.geometry.grants.length;t++){var r=this.mesh.geometry.grants[t],a=this.mesh.skeleton.bones[r.index],n=this.mesh.skeleton.bones[r.parentIndex];r.isLocal?(r.affectPosition,r.affectRotation):(r.affectPosition,r.affectRotation&&(e.set(0,0,0,1),e.slerp(n.quaternion,r.ratio),a.quaternion.multiply(e)))}}}()},n.MMDHelper=function(){this.meshes=[],this.doAnimation=!0,this.doIk=!0,this.doGrant=!0,this.doPhysics=!0,this.doCameraAnimation=!0,this.sharedPhysics=!1,this.masterPhysics=null,this.audioManager=null,this.camera=null},n.MMDHelper.prototype={constructor:n.MMDHelper,add:function(e){if(!(e instanceof n.SkinnedMesh))throw new Error("THREE.MMDHelper.add() accepts only THREE.SkinnedMesh instance.");void 0===e.mixer&&(e.mixer=null),void 0===e.ikSolver&&(e.ikSolver=null),void 0===e.grantSolver&&(e.grantSolver=null),void 0===e.physics&&(e.physics=null),void 0===e.looped&&(e.looped=!1),this.meshes.push(e),this.initBackupBones(e)},setAudio:function(e,t,r){this.audioManager=new n.MMDAudioManager(e,t,r)},setCamera:function(e){e.mixer=null,this.camera=e},setPhysicses:function(e){for(var t=0;t<this.meshes.length;t++)this.setPhysics(this.meshes[t],e)},setPhysics:function(e,t){if(t=void 0===t?{}:Object.assign({},t),void 0===t.world&&this.sharedPhysics){var r=this.getMasterPhysics();null!==r&&(t.world=r.world)}var a=void 0!==t.warmup?t.warmup:60,i=new n.MMDPhysics(e,t);null!==e.mixer&&void 0!==e.mixer&&!0!==t.preventAnimationWarmup&&(this.animateOneMesh(0,e),i.reset()),i.warmup(a),this.updateIKParametersDependingOnPhysicsEnabled(e,!0),e.physics=i},getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var e=0,t=this.meshes.length;e<t;e++){var r=this.meshes[e].physics;if(void 0!==r&&null!==r)return this.masterPhysics=r,this.masterPhysics}return null},enablePhysics:function(e){this.doPhysics=!0===e;for(var t=0,r=this.meshes.length;t<r;t++)this.updateIKParametersDependingOnPhysicsEnabled(this.meshes[t],e)},updateIKParametersDependingOnPhysicsEnabled:function(e,t){for(var r=e.geometry.iks,a=e.geometry.bones,n=0,i=r.length;n<i;n++)for(var o=r[n],s=o.links,l=0,u=s.length;l<u;l++){var c=s[l];c.enabled=!0!==t||!(a[c.index].rigidBodyType>0)}},setAnimations:function(){for(var e=0;e<this.meshes.length;e++)this.setAnimation(this.meshes[e])},setAnimation:function(e){if(void 0!==e.geometry.animations){e.mixer=new n.AnimationMixer(e),e.mixer.addEventListener("loop",function(e){if(!(e.action._clip.tracks.length>0&&0!==e.action._clip.tracks[0].name.indexOf(".bones"))){e.target._root.looped=!0}});for(var t=!1,r=!1,a=0;a<e.geometry.animations.length;a++){var i=e.geometry.animations[a],o=e.mixer.clipAction(i);i.tracks.length>0&&0===i.tracks[0].name.indexOf(".morphTargetInfluences")?r||(o.play(),r=!0):t||(o.play(),t=!0)}t&&(e.ikSolver=new n.CCDIKSolver(e),void 0!==e.geometry.grants&&(e.grantSolver=new n.MMDGrantSolver(e)))}},setCameraAnimation:function(e){void 0!==e.animations&&(e.mixer=new n.AnimationMixer(e),e.mixer.clipAction(e.animations[0]).play())},unifyAnimationDuration:function(e){e=void 0===e?{}:e;for(var t=0,r=this.camera,a=this.audioManager,n=0;n<this.meshes.length;n++){var i=this.meshes[n],o=i.mixer;if(null!==o)for(var s=0;s<o._actions.length;s++){var l=o._actions[s];t=Math.max(t,l._clip.duration)}}if(null!==r&&null!==r.mixer)for(var o=r.mixer,n=0;n<o._actions.length;n++){var l=o._actions[n];t=Math.max(t,l._clip.duration)}null!==a&&(t=Math.max(t,a.duration)),void 0!==e.afterglow&&(t+=e.afterglow);for(var n=0;n<this.meshes.length;n++){var i=this.meshes[n],o=i.mixer;if(null!==o)for(var s=0;s<o._actions.length;s++){var l=o._actions[s];l._clip.duration=t}}if(null!==r&&null!==r.mixer)for(var o=r.mixer,n=0;n<o._actions.length;n++){var l=o._actions[n];l._clip.duration=t}null!==a&&(a.duration=t)},controlAudio:function(e){null!==this.audioManager&&this.audioManager.control(e)},animate:function(e){this.controlAudio(e);for(var t=0;t<this.meshes.length;t++)this.animateOneMesh(e,this.meshes[t]);this.sharedPhysics&&this.updateSharedPhysics(e),this.animateCamera(e)},animateOneMesh:function(e,t){var r=t.mixer,a=t.ikSolver,n=t.grantSolver,i=t.physics;null!==r&&!0===this.doAnimation&&(this.restoreBones(t),r.update(e),this.backupBones(t)),null!==a&&!0===this.doIk&&a.update(),null!==n&&!0===this.doGrant&&n.update(),!0===t.looped&&(null!==i&&i.reset(),t.looped=!1),null!==i&&this.doPhysics&&!this.sharedPhysics&&i.update(e)},updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.doPhysics&&this.sharedPhysics){var t=this.getMasterPhysics();if(null!==t){for(var r=0,a=this.meshes.length;r<a;r++){var n=this.meshes[r].physics;null!==n&&void 0!==n&&n.updateRigidBodies()}t.stepSimulation(e);for(var r=0,a=this.meshes.length;r<a;r++){var n=this.meshes[r].physics;null!==n&&void 0!==n&&n.updateBones()}}}},animateCamera:function(e){if(null!==this.camera){var t=this.camera.mixer;null!==t&&void 0!==this.camera.center&&!0===this.doCameraAnimation&&(t.update(e),this.camera.updateProjectionMatrix(),this.camera.up.set(0,1,0),this.camera.up.applyQuaternion(this.camera.quaternion),this.camera.lookAt(this.camera.center))}},poseAsVpd:function(e,t,r){void 0===r&&(r={}),!0!==r.preventResetPose&&e.pose();for(var a=e.skeleton.bones,i=t.bones,o={},s=0;s<a.length;s++)o[a[s].name]=s;for(var l=new n.Vector3,u=new n.Quaternion,s=0;s<i.length;s++){var c=i[s],h=o[c.name];if(void 0!==h){var d=a[h],p=c.translation,f=c.quaternion;l.set(p[0],p[1],p[2]),u.set(f[0],f[1],f[2],f[3]),d.position.add(l),d.quaternion.multiply(u)}}if(e.updateMatrixWorld(!0),!0!==r.preventIk){var m=new n.CCDIKSolver(e);m.update(r.saveOriginalBonesBeforeIK)}if(!0!==r.preventGrant&&void 0!==e.geometry.grants){var m=new n.MMDGrantSolver(e);m.update()}},initBackupBones:function(e){e.skeleton.backupBones=[];for(var t=0;t<e.skeleton.bones.length;t++)e.skeleton.backupBones.push(e.skeleton.bones[t].clone())},backupBones:function(e){e.skeleton.backupBoneIsSaved=!0;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.backupBones[t],a=e.skeleton.bones[t];r.position.copy(a.position),r.quaternion.copy(a.quaternion)}},restoreBones:function(e){if(!0===e.skeleton.backupBoneIsSaved){e.skeleton.backupBoneIsSaved=!1;for(var t=0;t<e.skeleton.bones.length;t++){var r=e.skeleton.bones[t],a=e.skeleton.backupBones[t];r.position.copy(a.position),r.quaternion.copy(a.quaternion)}}}},t.default=n.MMDLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.MTLLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.MTLLoader.prototype={constructor:n.MTLLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e))},r,a)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setBaseUrl:function(e){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},a=/\s+/,i={},o=0;o<t.length;o++){var s=t[o];if(s=s.trim(),0!==s.length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),u=l>=0?s.substring(0,l):s;u=u.toLowerCase();var c=l>=0?s.substring(l+1):"";if(c=c.trim(),"newmtl"===u)r={name:c},i[c]=r;else if(r)if("ka"===u||"kd"===u||"ks"===u){var h=c.split(a,3);r[u]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else r[u]=c}}var d=new n.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(i),d}},n.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:n.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:n.RepeatWrapping},n.MTLLoader.MaterialCreator.prototype={constructor:n.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var a=e[r],n={};t[r]=n;for(var i in a){var o=!0,s=a[i],l=i.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(n[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){function t(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}function r(e,r){if(!o[e]){var n=a.getTextureParams(r,o),i=a.loadTexture(t(a.baseUrl,n.url));i.repeat.copy(n.scale),i.offset.copy(n.offset),i.wrapS=a.wrap,i.wrapT=a.wrap,o[e]=i}}var a=this,i=this.materialsInfo[e],o={name:e,side:this.side};for(var s in i){var l,u=i[s];if(""!==u)switch(s.toLowerCase()){case"kd":o.color=(new n.Color).fromArray(u);break;case"ks":o.specular=(new n.Color).fromArray(u);break;case"map_kd":r("map",u);break;case"map_ks":r("specularMap",u);break;case"norm":r("normalMap",u);break;case"map_bump":case"bump":r("bumpMap",u);break;case"ns":o.shininess=parseFloat(u);break;case"d":l=parseFloat(u),l<1&&(o.opacity=l,o.transparent=!0);break;case"tr":l=parseFloat(u),this.options&&this.options.invertTrProperty&&(l=1-l),l<1&&(o.opacity=l,o.transparent=!0)}}return this.materials[e]=new n.MeshPhongMaterial(o),this.materials[e]},getTextureParams:function(e,t){var r,a={scale:new n.Vector2(1,1),offset:new n.Vector2(0,0)},i=e.split(/\s+/);return r=i.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),r=i.indexOf("-s"),r>=0&&(a.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),r=i.indexOf("-o"),r>=0&&(a.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),a.url=i.join(" ").trim(),a},loadTexture:function(e,t,r,a,i){var o,s=n.Loader.Handlers.get(e),l=void 0!==this.manager?this.manager:n.DefaultLoadingManager;return null===s&&(s=new n.TextureLoader(l)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(e,r,a,i),void 0!==t&&(o.mapping=t),o}},t.default=n.MTLLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=r(0),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);i.NodeMaterialLoader=function(e,t){this.manager=void 0!==e?e:i.DefaultLoadingManager,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}},i.NodeMaterialLoaderUtils={replaceUUIDObject:function(e,t,r,n){if(n=void 0===n||n,"object"===(void 0===t?"undefined":a(t))&&(t=t.uuid),"object"===(void 0===e?"undefined":a(e)))for(var i=Object.keys(e),o=0;o<i.length;o++){var s=i[o];n&&(e[s]=this.replaceUUIDObject(e[s],t,r)),s===t&&(e[t]=e[s],delete e[s])}return e===t?r:e},replaceUUID:function(e,t,r){return this.replaceUUIDObject(e,t,r,!1),this.replaceUUIDObject(e.nodes,t,r),this.replaceUUIDObject(e.materials,t,r),this.replaceUUIDObject(e.passes,t,r),this.replaceUUIDObject(e.library,t,r,!1),e}},Object.assign(i.NodeMaterialLoader.prototype,{load:function(e,t,r,a){var n=this;return new i.FileLoader(n.manager).load(e,function(e){t(n.parse(JSON.parse(e)))},r,a),this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.names[e]},getNode:function(e){var t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t},parse:function(e){var t,r,a,n,o;for(t in e.nodes)r=e.nodes[t],a=new i[r.type],r.name&&(a.name=r.name,this.names[a.name]=a),this.nodes[t]=a;for(t in e.materials)r=e.materials[t],a=new i[r.type],r.name&&(a.name=r.name,this.names[a.name]=a),this.materials[t]=a;for(t in e.passes)r=e.passes[t],a=new i[r.type],r.name&&(a.name=r.name,this.names[a.name]=a),this.passes[t]=a;e.material&&(this.material=this.materials[t]),e.pass&&(this.pass=this.passes[t]);for(t in e.nodes)switch(r=e.nodes[t],a=this.nodes[t],r.type){case"FloatNode":a.number=r.number;break;case"ColorNode":a.value.copy(r);break;case"Vector2Node":a.x=r.x,a.y=r.y;break;case"Vector3Node":a.x=r.x,a.y=r.y,a.z=r.z;break;case"Vector4Node":a.x=r.x,a.y=r.y,a.z=r.z,a.w=r.w;break;case"Matrix3Node":case"Matrix4Node":a.value.fromArray(r.elements);break;case"OperatorNode":a.a=this.getNode(r.a),a.b=this.getNode(r.b),a.op=r.op;break;case"Math1Node":a.a=this.getNode(r.a),a.method=r.method;break;case"Math2Node":a.a=this.getNode(r.a),a.b=this.getNode(r.b),a.method=r.method;break;case"Math3Node":a.a=this.getNode(r.a),a.b=this.getNode(r.b),a.c=this.getNode(r.c),a.method=r.method;break;case"UVNode":case"ColorsNode":a.index=r.index;break;case"LuminanceNode":a.rgb=this.getNode(r.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":a.scope=r.scope;break;case"SwitchNode":a.node=this.getNode(r.node),a.components=r.components;break;case"JoinNode":for(n in r.inputs)a[n]=this.getNode(r.inputs[n]);break;case"CameraNode":switch(a.setScope(r.scope),r.camera&&a.setCamera(this.getNode(r.camera)),r.scope){case i.CameraNode.DEPTH:a.near.number=r.near,a.far.number=r.far}break;case"ColorAdjustmentNode":a.rgb=this.getNode(r.rgb),a.adjustment=this.getNode(r.adjustment),a.method=r.method;break;case"UVTransformNode":a.uv=this.getNode(r.uv),a.transform=this.getNode(r.transform);break;case"BumpNode":a.value=this.getNode(r.value),a.coord=this.getNode(r.coord),a.scale=this.getNode(r.scale);break;case"BlurNode":a.value=this.getNode(r.value),a.coord=this.getNode(r.coord),a.scale=this.getNode(r.scale),a.value=this.getNode(r.value),a.coord=this.getNode(r.coord),a.radius=this.getNode(r.radius),void 0!==r.size&&(a.size=new i.Vector2(r.size.x,r.size.y)),a.blurX=r.blurX,a.blurY=r.blurY;break;case"ResolutionNode":a.renderer=this.getNode(r.renderer);break;case"ScreenUVNode":a.resolution=this.getNode(r.resolution);break;case"VelocityNode":r.target&&a.setTarget(this.getNode(r.target)),a.setParams(r.params);break;case"TimerNode":a.scale=r.scale;break;case"ConstNode":a.name=r.name,a.type=r.out,a.value=r.value,a.useDefine=!0===r.useDefine;break;case"AttributeNode":case"VarNode":a.type=r.out;break;case"ReflectorNode":a.setMirror(this.getNode(r.mirror)),r.offset&&(a.offset=this.getNode(r.offset));break;case"NoiseNode":a.coord=this.getNode(r.coord);break;case"FunctionNode":a.isMethod=r.isMethod,a.useKeywords=r.useKeywords,a.extensions=r.extensions,a.keywords={};for(n in r.keywords)a.keywords[n]=this.getNode(r.keywords[n]);if(r.includes)for(o=0;o<r.includes.length;o++)a.includes.push(this.getNode(r.includes[o]));a.eval(r.src,a.includes,a.extensions,a.keywords),a.isMethod||(a.type=r.out);break;case"FunctionCallNode":for(n in r.inputs)a.inputs[n]=this.getNode(r.inputs[n]);a.value=this.getNode(r.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":r.value&&(a.value=this.getNode(r.value)),a.coord=this.getNode(r.coord),r.bias&&(a.bias=this.getNode(r.bias)),void 0!==a.project&&(a.project=r.project);break;case"LightNode":case"RoughnessToBlinnExponentNode":break;case"RawNode":a.value=this.getNode(r.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":a.color=this.getNode(r.color),r.alpha&&(a.alpha=this.getNode(r.alpha)),r.specular&&(a.specular=this.getNode(r.specular)),r.shininess&&(a.shininess=this.getNode(r.shininess)),r.roughness&&(a.roughness=this.getNode(r.roughness)),r.metalness&&(a.metalness=this.getNode(r.metalness)),r.reflectivity&&(a.reflectivity=this.getNode(r.reflectivity)),r.clearCoat&&(a.clearCoat=this.getNode(r.clearCoat)),r.clearCoatRoughness&&(a.clearCoatRoughness=this.getNode(r.clearCoatRoughness)),r.normal&&(a.normal=this.getNode(r.normal)),r.normalScale&&(a.normalScale=this.getNode(r.normalScale)),r.emissive&&(a.emissive=this.getNode(r.emissive)),r.ambient&&(a.ambient=this.getNode(r.ambient)),r.shadow&&(a.shadow=this.getNode(r.shadow)),r.light&&(a.light=this.getNode(r.light)),r.ao&&(a.ao=this.getNode(r.ao)),r.environment&&(a.environment=this.getNode(r.environment)),r.environmentAlpha&&(a.environmentAlpha=this.getNode(r.environmentAlpha)),r.transform&&(a.transform=this.getNode(r.transform)),!1===r.spherical&&(a.spherical=!1);break;default:console.warn(r.type,"not supported.")}for(t in e.materials)r=e.materials[t],a=this.materials[t],void 0!==r.name&&(a.name=r.name),void 0!==r.blending&&(a.blending=r.blending),void 0!==r.flatShading&&(a.flatShading=r.flatShading),void 0!==r.side&&(a.side=r.side),a.depthFunc=r.depthFunc,a.depthTest=r.depthTest,a.depthWrite=r.depthWrite,void 0!==r.wireframe&&(a.wireframe=r.wireframe),void 0!==r.wireframeLinewidth&&(a.wireframeLinewidth=r.wireframeLinewidth),void 0!==r.wireframeLinecap&&(a.wireframeLinecap=r.wireframeLinecap),void 0!==r.wireframeLinejoin&&(a.wireframeLinejoin=r.wireframeLinejoin),void 0!==r.skinning&&(a.skinning=r.skinning),void 0!==r.morphTargets&&(a.morphTargets=r.morphTargets),void 0!==r.visible&&(a.visible=r.visible),void 0!==r.userData&&(a.userData=r.userData),a.vertex=this.getNode(r.vertex),a.fragment=this.getNode(r.fragment),a.vertex===a.fragment&&(a.node=a.vertex),a.build(),void 0!==r.fog&&(a.fog=r.fog),void 0!==r.lights&&(a.lights=r.lights),void 0!==r.transparent&&(a.transparent=r.transparent);for(t in e.passes)r=e.passes[t],a=this.passes[t],a.value=this.getNode(r.value),a.build();return this.material||this.pass||this}}),t.default=i.NodeMaterialLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.NRRDLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.NRRDLoader.prototype={constructor:n.NRRDLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=0;a<e.byteLength;a+=t)for(var n=a+t-1,i=a;n>i;n--,i++){var o=r[i];r[i]=r[n],r[n]=o}return e}var r,a=e,i=0,o=new Int8Array(new Int16Array([1]).buffer)[0]>0,s=!0,l={},u=function(e,r){void 0!==r&&null!==r||(r=1);var n=1,l=Uint8Array;switch(e){case"uchar":break;case"schar":l=Int8Array;break;case"ushort":l=Uint16Array,n=2;break;case"sshort":l=Int16Array,n=2;break;case"uint":l=Uint32Array,n=4;break;case"sint":l=Int32Array,n=4;break;case"float":l=Float32Array,n=4;break;case"complex":case"double":l=Float64Array,n=8}var u=new l(a.slice(i,i+=r*n));return o!=s&&(u=t(u,n)),1==r?u[0]:u}("uchar",e.byteLength),c=u.length,h=null,d=0;for(r=1;r<c;r++)if(10==u[r-1]&&10==u[r]){h=this.parseChars(u,0,r-2),d=r+1;break}!function(e){var t,r,a,i,o,s,u,c,h;for(s=e.split(/\r?\n/),c=0,h=s.length;c<h;c++)o=s[c],o.match(/NRRD\d+/)?l.isNrrd=!0:o.match(/^#/)||(u=o.match(/(.*):(.*)/))&&(r=u[1].trim(),t=u[2].trim(),a=n.NRRDLoader.prototype.fieldFunctions[r],a?a.call(l,t):l[r]=t);if(!l.isNrrd)throw new Error("Not an NRRD file");if("bz2"===l.encoding||"bzip2"===l.encoding)throw new Error("Bzip is not supported");if(!l.vectors&&(l.vectors=[new n.Vector3(1,0,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1)],l.spacings))for(i=0;i<=2;i++)isNaN(l.spacings[i])||l.vectors[i].multiplyScalar(l.spacings[i])}(h);var a=u.subarray(d);if("gzip"===l.encoding||"gz"===l.encoding){var p=new Zlib.Gunzip(new Uint8Array(a));a=p.decompress()}else if("ascii"===l.encoding||"text"===l.encoding||"txt"===l.encoding||"hex"===l.encoding)a=function(e,t,r){var a="";t=t||0,r=r||e.length;var n,i=l.sizes.reduce(function(e,t){return e*t},1),o=10;"hex"===l.encoding&&(o=16);var s=new l.__array(i),u=0,c=parseInt;l.__array!==Float32Array&&l.__array!==Float64Array||(c=parseFloat);for(var h=t;h<r;h++)n=e[h],(n<9||n>13)&&32!==n?a+=String.fromCharCode(n):(""!==a&&(s[u]=c(a,o),u++),a="");return""!==a&&(s[u]=c(a,o),u++),s}(a);else if("raw"===l.encoding){for(var f=new Uint8Array(a.length),r=0;r<a.length;r++)f[r]=a[r];a=f}a=a.buffer;var m=new n.Volume;m.header=l,m.data=new l.__array(a);var v=m.computeMinMax(),g=v[0],y=v[1];m.windowLow=g,m.windowHigh=y,m.dimensions=[l.sizes[0],l.sizes[1],l.sizes[2]],m.xLength=m.dimensions[0],m.yLength=m.dimensions[1],m.zLength=m.dimensions[2];var b=new n.Vector3(l.vectors[0][0],l.vectors[0][1],l.vectors[0][2]).length(),w=new n.Vector3(l.vectors[1][0],l.vectors[1][1],l.vectors[1][2]).length(),A=new n.Vector3(l.vectors[2][0],l.vectors[2][1],l.vectors[2][2]).length();m.spacing=[b,w,A],m.matrix=new n.Matrix4;var M=1,x=1;if("left-posterior-superior"==l.space?(M=-1,x=-1):"left-anterior-superior"===l.space&&(M=-1),l.vectors){var L=l.vectors;m.matrix.set(M*L[0][0],M*L[1][0],M*L[2][0],0,x*L[0][1],x*L[1][1],x*L[2][1],0,1*L[0][2],1*L[1][2],1*L[2][2],0,0,0,0,1)}else m.matrix.set(M,0,0,0,0,x,0,0,0,0,1,0,0,0,0,1);return m.inverseMatrix=new n.Matrix4,m.inverseMatrix.getInverse(m.matrix),m.RASDimensions=new n.Vector3(m.xLength,m.yLength,m.zLength).applyMatrix4(m.matrix).round().toArray().map(Math.abs),m.lowerThreshold===-1/0&&(m.lowerThreshold=g),m.upperThreshold===1/0&&(m.upperThreshold=y),m},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var a="",n=0;for(n=t;n<r;++n)a+=String.fromCharCode(e[n]);return a},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,a,n,i;for(n=e.split(/\s+/),i=[],r=0,a=n.length;r<a;r++)t=n[r],i.push(parseInt(t,10));return i}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,a;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,n,i;for(i=[],e=0,n=r.length;e<n;e++)a=r[e],i.push(function(){var e,r,n,i;for(n=a.slice(1,-1).split(/,/),i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(parseFloat(t));return i}());return i}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,a,n=[];for(e=0,a=r.length;e<a;e++)t=r[e],n.push(parseFloat(t));return n}()}}},t.default=n.NRRDLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.OBJLoader=function(){function e(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,n=this.object.geometry.vertices;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var a=this.normals,n=this.object.geometry.normals;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addColor:function(e,t,r){var a=this.colors,n=this.object.geometry.colors;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addUV:function(e,t,r){var a=this.uvs,n=this.object.geometry.uvs;n.push(a[e+0],a[e+1]),n.push(a[t+0],a[t+1]),n.push(a[r+0],a[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,a,n,i,o,s,l){var u=this.vertices.length,c=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),d=this.parseVertexIndex(r,u);if(this.addVertex(c,h,d),void 0!==a){var p=this.uvs.length;c=this.parseUVIndex(a,p),h=this.parseUVIndex(n,p),d=this.parseUVIndex(i,p),this.addUV(c,h,d)}if(void 0!==o){var f=this.normals.length;c=this.parseNormalIndex(o,f),h=o===s?c:this.parseNormalIndex(s,f),d=o===l?c:this.parseNormalIndex(l,f),this.addNormal(c,h,d)}this.colors.length>0&&this.addColor(c,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,a=e.length;r<a;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));for(var o=0,i=t.length;o<i;o++)this.addUVLine(this.parseUVIndex(t[o],a))}};return e.startObject("",!1),e}function t(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.materials=null}var r=/^[og]\s*(.+)?/,a=/^mtllib /,i=/^usemtl /;return t.prototype={constructor:t,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){return this.materials=e,this},parse:function(t){console.time("OBJLoader");var o=new e;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));for(var s=t.split("\n"),l="",u="",c=[],h="function"==typeof"".trimLeft,d=0,p=s.length;d<p;d++)if(l=s[d],l=h?l.trimLeft():l.trim(),0!==l.length&&"#"!==(u=l.charAt(0)))if("v"===u){var f=l.split(/\s+/);switch(f[0]){case"v":o.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),8===f.length&&o.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":o.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":o.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===u){for(var m=l.substr(1).trim(),v=m.split(/\s+/),g=[],y=0,b=v.length;y<b;y++){var w=v[y];if(w.length>0){var A=w.split("/");g.push(A)}}for(var M=g[0],y=1,b=g.length-1;y<b;y++){var x=g[y],L=g[y+1];o.addFace(M[0],x[0],L[0],M[1],x[1],L[1],M[2],x[2],L[2])}}else if("l"===u){var E=l.substring(1).trim().split(" "),T=[],k=[];if(-1===l.indexOf("/"))T=E;else for(var _=0,N=E.length;_<N;_++){var C=E[_].split("/");""!==C[0]&&T.push(C[0]),""!==C[1]&&k.push(C[1])}o.addLineGeometry(T,k)}else if("p"===u){var m=l.substr(1).trim(),S=m.split(" ");o.addPointGeometry(S)}else if(null!==(c=r.exec(l))){var O=(" "+c[0].substr(1).trim()).substr(1);o.startObject(O)}else if(i.test(l))o.object.startMaterial(l.substring(7).trim(),o.materialLibraries);else if(a.test(l))o.materialLibraries.push(l.substring(7).trim());else{if("s"!==u){if("\0"===l)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+l+'"')}if(c=l.split(" "),c.length>1){var F=c[1].trim().toLowerCase();o.object.smooth="0"!==F&&"off"!==F}else o.object.smooth=!0;var P=o.object.currentMaterial();P&&(P.smooth=o.object.smooth)}o.finalize();var R=new n.Group;R.materialLibraries=[].concat(o.materialLibraries);for(var d=0,p=o.objects.length;d<p;d++){var I=o.objects[d],B=I.geometry,D=I.materials,V="Line"===B.type,j="Points"===B.type,U=!1;if(0!==B.vertices.length){var G=new n.BufferGeometry;G.addAttribute("position",new n.Float32BufferAttribute(B.vertices,3)),B.normals.length>0?G.addAttribute("normal",new n.Float32BufferAttribute(B.normals,3)):G.computeVertexNormals(),B.colors.length>0&&(U=!0,G.addAttribute("color",new n.Float32BufferAttribute(B.colors,3))),B.uvs.length>0&&G.addAttribute("uv",new n.Float32BufferAttribute(B.uvs,2));for(var z=[],H=0,Y=D.length;H<Y;H++){var X=D[H],P=void 0;if(null!==this.materials)if(P=this.materials.create(X.name),!V||!P||P instanceof n.LineBasicMaterial){if(j&&P&&!(P instanceof n.PointsMaterial)){var W=new n.PointsMaterial({size:10,sizeAttenuation:!1});K.copy(P),P=W}}else{var K=new n.LineBasicMaterial;K.copy(P),K.lights=!1,P=K}P||(P=V?new n.LineBasicMaterial:j?new n.PointsMaterial({size:1,sizeAttenuation:!1}):new n.MeshPhongMaterial,P.name=X.name),P.flatShading=!X.smooth,P.vertexColors=U?n.VertexColors:n.NoColors,z.push(P)}var Q;if(z.length>1){for(var H=0,Y=D.length;H<Y;H++){var X=D[H];G.addGroup(X.groupStart,X.groupCount,H)}Q=V?new n.LineSegments(G,z):j?new n.Points(G,z):new n.Mesh(G,z)}else Q=V?new n.LineSegments(G,z[0]):j?new n.Points(G,z[0]):new n.Mesh(G,z[0]);Q.name=I.name,R.add(Q)}}return console.timeEnd("OBJLoader"),R}},t}(),t.default=n.OBJLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);void 0===n.OBJLoader2&&(n.OBJLoader2={}),void 0===n.LoaderSupport&&console.error('"THREE.LoaderSupport" is not available. "THREE.OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),n.OBJLoader2=function(){function e(e,r){n.LoaderSupport.LoaderBase.call(this,e,r),this.logger.logInfo("Using THREE.OBJLoader2 version: "+t),this.materialPerSmoothingGroup=!1,this.fileLoader=a.verifyInput(this.fileLoader,new n.FileLoader(this.manager)),this.workerSupport=null,this.terminateWorkerOnLoad=!0}var t="2.2.1",r=n.LoaderSupport.LoaderBase,a=n.LoaderSupport.Validator,i=n.LoaderSupport.ConsoleLogger;e.prototype=Object.create(n.LoaderSupport.LoaderBase.prototype),e.prototype.constructor=e,e.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=!0===e},e.prototype.load=function(e,t,r,i,o,s){var l=this;if(!a.isValid(r)){var u=0,c=0;r=function(t){if(t.lengthComputable&&(c=t.loaded/t.total)>u){u=c;var r='Download of "'+e+'": '+(100*c).toFixed(2)+"%";l.onProgress("progressLoad",r,c)}}}a.isValid(i)||(i=function(t){var r='Error occurred while downloading "'+e+'"';l.logger.logError(r+": "+t),l.onProgress("error",r,-1)}),this.fileLoader.setPath(this.path),this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(e,function(e){if(s)l.parseAsync(e,t);else{var r=new n.LoaderSupport.Callbacks;r.setCallbackOnMeshAlter(o),l._setCallbacks(r),t({detail:{loaderRootNode:l.parse(e),modelName:l.modelName,instanceNo:l.instanceNo}})}},r,i)},e.prototype.run=function(e,t){this._applyPrepData(e);var r=this._checkFiles(e.resources);a.isValid(t)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=t,this.logger=t.logger);var n=this,i=function(t){n.builder.setMaterials(t),a.isValid(r.obj.content)?e.useAsync?n.parseAsync(r.obj.content,n.callbacks.onLoad):n.parse(r.obj.content):(n.setPath(r.obj.path),n.load(r.obj.name,n.callbacks.onLoad,null,null,n.callbacks.onMeshAlter,e.useAsync))};this._loadMtl(r.mtl,i,e.crossOrigin)},e.prototype._applyPrepData=function(e){n.LoaderSupport.LoaderBase.prototype._applyPrepData.call(this,e),a.isValid(e)&&this.setMaterialPerSmoothingGroup(e.materialPerSmoothingGroup)},e.prototype.parse=function(e){this.logger.logTimeStart("OBJLoader2 parse: "+this.modelName);var t=new s;t.setLogConfig(this.logger.enabled,this.logger.debug),t.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),t.setUseIndices(this.useIndices),t.setDisregardNormals(this.disregardNormals),t.setMaterials(this.builder.getMaterials());var r=this,a=function(e){var t,a=r.builder.processPayload(e);for(var n in a)t=a[n],r.loaderRootNode.add(t)};t.setCallbackBuilder(a);var n=function(e,t){r.onProgress("progressParse",e,t)};if(t.setCallbackProgress(n),e instanceof ArrayBuffer||e instanceof Uint8Array)this.logger.logInfo("Parsing arrayBuffer..."),t.parse(e);else{if(!("string"==typeof e||e instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logger.logInfo("Parsing text..."),t.parseText(e)}return this.logger.logTimeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},e.prototype.parseAsync=function(e,t){this.logger.logTimeStart("OBJLoader2 parseAsync: "+this.modelName);var c=this,h=function(){t({detail:{loaderRootNode:c.loaderRootNode,modelName:c.modelName,instanceNo:c.instanceNo}}),c.logger.logTimeEnd("OBJLoader2 parseAsync: "+c.modelName)},d=function(e){var t,r=c.builder.processPayload(e);for(var a in r)t=r[a],c.loaderRootNode.add(t)};this.workerSupport=a.verifyInput(this.workerSupport,new n.LoaderSupport.WorkerSupport(this.logger));var p=function(e,t){var n="";return n+="/**\n",n+="  * This code was constructed by OBJLoader2 buildCode.\n",n+="  */\n\n",n+=e("Validator",a),n+=t("ConsoleLogger","ConsoleLogger",i),n+=t("LoaderBase","LoaderBase",r),n+=e("Consts",o),n+=t("Parser","Parser",s),n+=t("RawMesh","RawMesh",l),n+=t("RawMeshSubGroup","RawMeshSubGroup",u)};this.workerSupport.validate(p,!1),this.workerSupport.setCallbacks(d,h),c.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var f={},m=this.builder.getMaterials();for(var v in m)f[v]=v;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logger:{debug:this.logger.debug,enabled:this.logger.enabled},materials:{materials:f},data:{input:e,options:null}})};var o={CODE_LF:10,CODE_CR:13,CODE_SPACE:32,CODE_SLASH:47,STRING_LF:"\n",STRING_CR:"\r",STRING_SPACE:" ",STRING_SLASH:"/",LINE_F:"f",LINE_G:"g",LINE_L:"l",LINE_O:"o",LINE_S:"s",LINE_V:"v",LINE_VT:"vt",LINE_VN:"vn",LINE_MTLLIB:"mtllib",LINE_USEMTL:"usemtl"},s=function(){function e(){this.callbackProgress=null,this.callbackBuilder=null,this.materials={},this.rawMesh=null,this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.inputObjectCount=1,this.outputObjectCount=1,this.counts={vertices:0,faces:0,doubleIndicesCount:0},this.logger=new t,this.totalBytes=0}var t=n.LoaderSupport.ConsoleLogger;return e.prototype.setUseAsync=function(e){this.useAsync=e},e.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=e},e.prototype.setUseIndices=function(e){this.useIndices=e},e.prototype.setDisregardNormals=function(e){this.disregardNormals=e},e.prototype.setMaterials=function(e){this.materials=a.verifyInput(e,this.materials),this.materials=a.verifyInput(this.materials,{})},e.prototype.setCallbackBuilder=function(e){if(this.callbackBuilder=e,!a.isValid(this.callbackBuilder))throw'Unable to run as no "builder" callback is set.'},e.prototype.setCallbackProgress=function(e){this.callbackProgress=e},e.prototype.setLogConfig=function(e,t){this.logger.setEnabled(e),this.logger.setDebug(t)},e.prototype.configure=function(){if(this.rawMesh=new l(this.materialPerSmoothingGroup,this.useIndices,this.disregardNormals),this.logger.isEnabled()){var e=Object.keys(this.materials),t=e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None",r="OBJLoader2.Parser configuration:"+t+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackBuilderName: "+this.callbackBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name;this.logger.logInfo(r)}},e.prototype.parse=function(e){this.logger.logTimeStart("OBJLoader2.Parser.parse"),this.configure();var t=new Uint8Array(e),r=t.byteLength;this.totalBytes=r;for(var a,n=new Array(128),i=0,s=new Array(16),l=0,u="",c=0;c<r;c++)switch(a=t[c]){case o.CODE_SPACE:u.length>0&&(n[i++]=u),s[l++]=0,u="";break;case o.CODE_SLASH:u.length>0&&(n[i++]=u),s[l++]=1,u="";break;case o.CODE_LF:u.length>0&&(n[i++]=u),u="",this.processLine(n,i,s,l,c),i=0,l=0;break;case o.CODE_CR:break;default:u+=String.fromCharCode(a)}this.finalize(c),this.logger.logTimeEnd("OBJLoader2.Parser.parse")},e.prototype.parseText=function(e){this.logger.logTimeStart("OBJLoader2.Parser.parseText"),this.configure();var t=e.length;this.totalBytes=t;for(var r,a=new Array(128),n=0,i=new Array(16),s=0,l="",u=0;u<t;u++)switch(r=e[u]){case o.STRING_SPACE:l.length>0&&(a[n++]=l),i[s++]=0,l="";break;case o.STRING_SLASH:l.length>0&&(a[n++]=l),i[s++]=1,l="";break;case o.STRING_LF:l.length>0&&(a[n++]=l),l="",this.processLine(a,n,i,s,u),n=0,s=0;break;case o.STRING_CR:break;default:l+=r}this.finalize(u),this.logger.logTimeEnd("OBJLoader2.Parser.parseText")},e.prototype.processLine=function(e,t,r,a,n){if(!(t<1)){var i=function(e,t){for(var r=0,a=0;a<t;a++)r+=e[a];return r},s=function(e,t,r){var a="";if(2===t)a=e[1];else{for(var n=t-1,i=1;i<n;i++)a+=e[i]+(0===r[i]?" ":"/");a+=e[n]}return a},l=function(e,t){for(var r=0;r<t;r++)e[r]=""};switch(e[0]){case o.LINE_V:this.rawMesh.pushVertex(e,t>4);break;case o.LINE_VT:this.rawMesh.pushUv(e);break;case o.LINE_VN:this.rawMesh.pushNormal(e);break;case o.LINE_F:this.rawMesh.processFaces(e,t,i(r,a));break;case o.LINE_L:this.rawMesh.processLines(e,t,i(r,a));break;case o.LINE_S:this.rawMesh.pushSmoothingGroup(e[1]),l(e,t);break;case o.LINE_G:this.processCompletedMesh(n),this.rawMesh.pushGroup(s(e,t,r)),l(e,t);break;case o.LINE_O:this.rawMesh.pushObject(s(e,t,r)),l(e,t);break;case o.LINE_MTLLIB:this.rawMesh.pushMtllib(s(e,t,r)),l(e,t);break;case o.LINE_USEMTL:this.rawMesh.pushUsemtl(s(e,t,r)),l(e,t)}}},e.prototype.createRawMeshReport=function(e,t){var r=e.createReport(t);return"Input Object number: "+t+"\n\tObject name: "+r.objectName+"\n\tGroup name: "+r.groupName+"\n\tMtllib name: "+r.mtllibName+"\n\tVertex count: "+r.vertexCount+"\n\tNormal count: "+r.normalCount+"\n\tUV count: "+r.uvCount+"\n\tSmoothingGroup count: "+r.smoothingGroupCount+"\n\tMaterial count: "+r.mtlCount+"\n\tReal RawMeshSubGroup count: "+r.subGroups},e.prototype.processCompletedMesh=function(e){var t=this.rawMesh.finalize();if(a.isValid(t)){if(this.rawMesh.colors.length>0&&this.rawMesh.colors.length!==this.rawMesh.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logger.isDebug()&&this.logger.logDebug(this.createRawMeshReport(this.rawMesh,this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(t,e);var r=e/this.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*r).toFixed(2)+"%",r),this.rawMesh.reset(this.rawMesh.smoothingGroup.splitMaterials),!0}return!1},e.prototype.finalize=function(e){if(this.logger.logInfo("Global output object count: "+this.outputObjectCount),this.processCompletedMesh(e)&&this.logger.isEnabled()){var t="Overall counts: \n\tVertices: "+this.counts.vertices+"\n\tFaces: "+this.counts.faces+"\n\tMultiple definitions: "+this.counts.doubleIndicesCount;this.logger.logInfo(t)}},e.prototype.buildMesh=function(e,t){var r=e.subGroups,n=new Float32Array(e.absoluteVertexCount);this.counts.vertices+=e.absoluteVertexCount/3,this.counts.faces+=e.faceCount,this.counts.doubleIndicesCount+=e.doubleIndicesCount;var i,o,s,l,u,c,h,d=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,p=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,f=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,m=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,v=a.isValid(p),g=[],y=r.length>1,b=0,w=[],A=[],M=0,x=0,L=0,E=0,T=0,k=0,_=0;for(var N in r)if(r.hasOwnProperty(N)){if(i=r[N],h=i.materialName,c=h+(v?"_vertexColor":"")+(0===i.smoothingGroup?"_flat":""),l=this.materials[h],u=this.materials[c],!a.isValid(l)&&!a.isValid(u)){var C=v?"vertexColorMaterial":"defaultMaterial";l=this.materials[C],this.logger.logWarn('object_group "'+i.objectName+"_"+i.groupName+'" was defined with unresolvable material "'+h+'"! Assigning "'+C+'".'),h=C,h===c&&(u=l,c=C)}if(!a.isValid(u)){var S={materialNameOrg:h,materialName:c,materialProperties:{vertexColors:v?2:0,flatShading:0===i.smoothingGroup}},O={cmd:"materialData",materials:{materialCloneInstructions:S}};this.callbackBuilder(O),this.useAsync&&(this.materials[c]=S)}if(y?(o=w[c],o||(o=b,w[c]=b,g.push(c),b++),_=this.useIndices?i.indices.length:i.vertices.length/3,s={start:k,count:_,index:o},A.push(s),k+=_):g.push(c),n.set(i.vertices,M),M+=i.vertices.length,d&&(d.set(i.indices,x),x+=i.indices.length),p&&(p.set(i.colors,L),L+=i.colors.length),f&&(f.set(i.normals,E),E+=i.normals.length),m&&(m.set(i.uvs,T),T+=i.uvs.length),this.logger.isDebug()){var F=a.isValid(o)?"\n\t\tmaterialIndex: "+o:"",P="Output Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+i.groupName+F+"\n\t\tmaterialName: "+i.materialName+"\n\t\tsmoothingGroup: "+i.smoothingGroup+"\n\t\tobjectName: "+i.objectName+"\n\t\t#vertices: "+i.vertices.length/3+"\n\t\t#indices: "+i.indices.length+"\n\t\t#colors: "+i.colors.length/3+"\n\t\t#uvs: "+i.uvs.length/2+"\n\t\t#normals: "+i.normals.length/3;this.logger.logDebug(P)}}this.outputObjectCount++,this.callbackBuilder({cmd:"meshData",progress:{numericalValue:t/this.totalBytes},params:{meshName:e.name},materials:{multiMaterial:y,materialNames:g,materialGroups:A},buffers:{vertices:n,indices:d,colors:p,normals:f,uvs:m}},[n.buffer],a.isValid(d)?[d.buffer]:null,a.isValid(p)?[p.buffer]:null,a.isValid(f)?[f.buffer]:null,a.isValid(m)?[m.buffer]:null)},e}(),l=function(){function e(e,t,r){this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.useIndices=!0===t,this.disregardNormals=!0===r,this.objectName="",this.groupName="",this.activeMtlName="",this.mtllibName="",this.reset(e)}return e.prototype.reset=function(e){this.subGroups=[],this.subGroupInUse=null,this.smoothingGroup={splitMaterials:!0===e,normalized:-1,real:-1},this.pushSmoothingGroup(1),this.doubleIndicesCount=0,this.faceCount=0,this.mtlCount=0,this.smoothingGroupCount=0},e.prototype.pushVertex=function(e,t){this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])))},e.prototype.pushUv=function(e){this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]))},e.prototype.pushNormal=function(e){this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]))},e.prototype.pushGroup=function(e){this.groupName=a.verifyInput(e,"")},e.prototype.pushObject=function(e){this.objectName=a.verifyInput(e,"")},e.prototype.pushMtllib=function(e){this.mtllibName=a.verifyInput(e,"")},e.prototype.pushUsemtl=function(e){this.activeMtlName!==e&&a.isValid(e)&&(this.activeMtlName=e,this.mtlCount++,this.verifyIndex())},e.prototype.pushSmoothingGroup=function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var r=this.smoothingGroup.normalized;this.smoothingGroup.normalized=this.smoothingGroup.splitMaterials?t:0===t?0:1,this.smoothingGroup.real=t,r!==t&&(this.smoothingGroupCount++,this.verifyIndex())},e.prototype.verifyIndex=function(){var e=this.activeMtlName+"|"+this.smoothingGroup.normalized;this.subGroupInUse=this.subGroups[e],a.isValid(this.subGroupInUse)||(this.subGroupInUse=new u(this.objectName,this.groupName,this.activeMtlName,this.smoothingGroup.normalized),this.subGroups[e]=this.subGroupInUse)},e.prototype.processFaces=function(e,t,r){var a,n,i=t-1;if(0===r)for(a=2,n=i;a<n;a++)this.buildFace(e[1]),this.buildFace(e[a]),this.buildFace(e[a+1]);else if(i===2*r)for(a=3,n=i-2;a<n;a+=2)this.buildFace(e[1],e[2]),this.buildFace(e[a],e[a+1]),this.buildFace(e[a+2],e[a+3]);else if(2*i==3*r)for(a=4,n=i-3;a<n;a+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[a],e[a+1],e[a+2]),this.buildFace(e[a+3],e[a+4],e[a+5]);else for(a=3,n=i-2;a<n;a+=2)this.buildFace(e[1],void 0,e[2]),this.buildFace(e[a],void 0,e[a+1]),this.buildFace(e[a+2],void 0,e[a+3])},e.prototype.buildFace=function(e,t,r){var n=this.subGroupInUse;this.disregardNormals&&(r=void 0);var i=this,o=function(){var a=parseInt(e),o=3*(a>0?a-1:a+i.vertices.length/3),s=n.vertices;s.push(i.vertices[o++]),s.push(i.vertices[o++]),s.push(i.vertices[o]);var l=i.colors.length>0?o:null;if(null!==l){var u=n.colors;u.push(i.colors[l++]),u.push(i.colors[l++]),u.push(i.colors[l])}if(t){var c=parseInt(t),h=2*(c>0?c-1:c+i.uvs.length/2),d=n.uvs;d.push(i.uvs[h++]),d.push(i.uvs[h])}if(r){var p=parseInt(r),f=3*(p>0?p-1:p+i.normals.length/3),m=n.normals;m.push(i.normals[f++]),m.push(i.normals[f++]),m.push(i.normals[f])}};if(this.useIndices){var s=e+(t?"_"+t:"_n")+(r?"_"+r:"_n"),l=n.indexMappings[s];a.isValid(l)?this.doubleIndicesCount++:(l=n.vertices.length/3,o(),n.indexMappings[s]=l,n.indexMappingsCount++),n.indices.push(l)}else o();this.faceCount++},e.prototype.processLines=function(e,t,r){var a,n=1,i=t-1;if(i===2*r)for(a=i-2;n<a;n+=2)this.vertices.push(parseInt(e[n])),this.uvs.push(parseInt(e[n+1]));else for(a=i-1;n<a;n++)this.vertices.push(parseInt(e[n]))},e.prototype.finalize=function(){var e,t,r=[],a=0,n=0,i=0,o=0,s=0,l=0;for(var u in this.subGroups)if(e=this.subGroups[u],e.vertices.length>0){if(t=e.indices,t.length>0&&n>0)for(var c in t)t[c]=t[c]+n;r.push(e),a+=e.vertices.length,n+=e.indexMappingsCount,i+=e.indices.length,o+=e.colors.length,l+=e.uvs.length,s+=e.normals.length}var h=null;return r.length>0&&(h={name:""!==this.groupName?this.groupName:this.objectName,subGroups:r,absoluteVertexCount:a,absoluteIndexCount:i,absoluteColorCount:o,absoluteNormalCount:s,absoluteUvCount:l,faceCount:this.faceCount,doubleIndicesCount:this.doubleIndicesCount}),h},e.prototype.createReport=function(){return{objectName:this.objectName,groupName:this.groupName,mtllibName:this.mtllibName,vertexCount:this.vertices.length/3,normalCount:this.normals.length/3,uvCount:this.uvs.length/2,smoothingGroupCount:this.smoothingGroupCount,mtlCount:this.mtlCount,subGroups:this.subGroups.length}},e}(),u=function(){function e(e,t,r,a){this.objectName=e,this.groupName=t,this.materialName=r,this.smoothingGroup=a,this._init()}return e.prototype._init=function(){this.vertices=[],this.indexMappingsCount=0,this.indexMappings=[],this.indices=[],this.colors=[],this.uvs=[],this.normals=[]},e}();return e.prototype._checkFiles=function(e){var t,r={mtl:null,obj:null};for(var n in e)if(t=e[n],a.isValid(t.name))if(a.isValid(t.content)){if("OBJ"===t.extension){if(!(t.content instanceof Uint8Array))throw"Provided content is not of type arraybuffer! Aborting...";r.obj=t}else if("MTL"===t.extension&&a.isValid(t.name)){if(!("string"==typeof t.content||t.content instanceof String))throw"Provided  content is not of type String! Aborting...";r.mtl=t}else if("ZIP"!==t.extension)throw'Unidentified resource "'+t.name+'": '+t.url}else{if(!("string"==typeof t.name||t.name instanceof String))throw"Provided file is not properly defined! Aborting...";if("OBJ"===t.extension)r.obj=t;else if("MTL"===t.extension)r.mtl=t;else if("ZIP"!==t.extension)throw'Unidentified resource "'+t.name+'": '+t.url}return r},e.prototype.loadMtl=function(e,t,r,a){var i=new n.LoaderSupport.ResourceDescriptor(e,"MTL");i.setContent(t),this._loadMtl(i,r,a)},e.prototype._loadMtl=function(e,t,r){void 0===n.MTLLoader&&console.error('"THREE.MTLLoader" is not available. "THREE.OBJLoader2" requires it for loading MTL files.'),a.isValid(e)&&this.logger.logTimeStart("Loading MTL: "+e.name);var i=[],o=this,s=function(r){var n=[];if(a.isValid(r)){r.preload(),n=r.materials;for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s])}a.isValid(e)&&o.logger.logTimeEnd("Loading MTL: "+e.name),t(i)},l=new n.MTLLoader(this.manager);if(r=a.verifyInput(r,"anonymous"),l.setCrossOrigin(r),a.isValid(e)&&(a.isValid(e.content)||a.isValid(e.url))){if(l.setPath(e.path),a.isValid(e.content))s(a.isValid(e.content)?l.parse(e.content):null);else if(a.isValid(e.url)){var u=function(t){var r='Error occurred while downloading "'+e.url+'"';throw o.logger.logError(r+": "+t),r};l.load(e.name,s,void 0,u)}}else s()},e}(),t.default=n.OBJLoader2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PCDLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.littleEndian=!0},n.PCDLoader.prototype={constructor:n.PCDLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(r){t(i.parse(r,e))},r,a)},parse:function(e,t){var r=n.LoaderUtils.decodeText(e),a=function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),a=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=a[1],t.headerLen=a[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),null!==t.count)t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)});else{t.count=[];for(var n=0,i=t.fields.length;n<i;n++)t.count.push(1)}t.offset={};for(var o=0,n=0,i=t.fields.length;n<i;n++)"ascii"===t.data?t.offset[t.fields[n]]=n:(t.offset[t.fields[n]]=o,o+=t.size[n]);return t.rowSize=o,t}(r),i=[],o=[],s=[];if("ascii"===a.data)for(var l=a.offset,u=r.substr(a.headerLen),c=u.split("\n"),h=0,d=c.length;h<d;h++){var p=c[h].split(" ");if(void 0!==l.x&&(i.push(parseFloat(p[l.x])),i.push(parseFloat(p[l.y])),i.push(parseFloat(p[l.z]))),void 0!==l.rgb){var f=new Float32Array([parseFloat(p[l.rgb])]),m=new DataView(f.buffer,0);s.push(m.getUint8(0)/255),s.push(m.getUint8(1)/255),s.push(m.getUint8(2)/255)}void 0!==l.normal_x&&(o.push(parseFloat(p[l.normal_x])),o.push(parseFloat(p[l.normal_y])),o.push(parseFloat(p[l.normal_z])))}if("binary_compressed"===a.data)return void console.error("THREE.PCDLoader: binary_compressed files are not supported");if("binary"===a.data)for(var m=new DataView(e,a.headerLen),l=a.offset,h=0,v=0;h<a.points;h++,v+=a.rowSize)void 0!==l.x&&(i.push(m.getFloat32(v+l.x,this.littleEndian)),i.push(m.getFloat32(v+l.y,this.littleEndian)),i.push(m.getFloat32(v+l.z,this.littleEndian))),void 0!==l.rgb&&(s.push(m.getUint8(v+l.rgb+0)/255),s.push(m.getUint8(v+l.rgb+1)/255),s.push(m.getUint8(v+l.rgb+2)/255)),void 0!==l.normal_x&&(o.push(m.getFloat32(v+l.normal_x,this.littleEndian)),o.push(m.getFloat32(v+l.normal_y,this.littleEndian)),o.push(m.getFloat32(v+l.normal_z,this.littleEndian)));var g=new n.BufferGeometry;i.length>0&&g.addAttribute("position",new n.Float32BufferAttribute(i,3)),o.length>0&&g.addAttribute("normal",new n.Float32BufferAttribute(o,3)),s.length>0&&g.addAttribute("color",new n.Float32BufferAttribute(s,3)),g.computeBoundingSphere();var y=new n.PointsMaterial({size:.005});s.length>0?y.vertexColors=!0:y.color.setHex(16777215*Math.random());var b=new n.Points(g,y),w=t.split("").reverse().join("");return w=/([^\/]*)/.exec(w),w=w[1].split("").reverse().join(""),b.name=w,b}},t.default=n.PCDLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PDBLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.PDBLoader.prototype={constructor:n.PDBLoader,load:function(e,t,r,a){var i=this;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e,t){return"s"+Math.min(e,t)+"e"+Math.max(e,t)}function a(e,t){var a=parseInt(m[v].substr(e,t));if(a){var n=r(y,a);void 0===f[n]&&(d.push([y-1,a-1,1]),f[n]=d.length-1)}}for(var i,o,s,l,u,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},h=[],d=[],p={},f={},m=e.split("\n"),v=0,g=m.length;v<g;v++)if("ATOM"===m[v].substr(0,4)||"HETATM"===m[v].substr(0,6))i=parseFloat(m[v].substr(30,7)),o=parseFloat(m[v].substr(38,7)),s=parseFloat(m[v].substr(46,7)),l=parseInt(m[v].substr(6,5))-1,u=t(m[v].substr(76,2)).toLowerCase(),""===u&&(u=t(m[v].substr(12,2)).toLowerCase()),h[l]=[i,o,s,c[u],function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}(u)],void 0===p[u]?p[u]=1:p[u]+=1;else if("CONECT"===m[v].substr(0,6)){var y=parseInt(m[v].substr(6,5));a(11,5),a(16,5),a(21,5),a(26,5)}return function(){var e,t,r={geometryAtoms:new n.BufferGeometry,geometryBonds:new n.BufferGeometry,json:{atoms:h,bonds:d}},a=r.geometryAtoms,i=r.geometryBonds,o=[],s=[],l=[];for(e=0,t=h.length;e<t;e++){var u=h[e],c=u[0],p=u[1],f=u[2];o.push(c,p,f);var m=u[3][0]/255,v=u[3][1]/255,g=u[3][2]/255;s.push(m,v,g)}for(e=0,t=d.length;e<t;e++){var y=d[e],b=y[0],w=y[1];l.push(o[3*b+0]),l.push(o[3*b+1]),l.push(o[3*b+2]),l.push(o[3*w+0]),l.push(o[3*w+1]),l.push(o[3*w+2])}return a.addAttribute("position",new n.Float32BufferAttribute(o,3)),a.addAttribute("color",new n.Float32BufferAttribute(s,3)),i.addAttribute("position",new n.Float32BufferAttribute(l,3)),r}()}},t.default=n.PDBLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PlayCanvasLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.PlayCanvasLoader.prototype={constructor:n.PlayCanvasLoader,load:function(e,t,r,a){var i=this;new n.FileLoader(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,a)},parse:function(e){for(var t=e.model,r=0,a=t.vertices.length;r<a;r++)!function(e){var t={};for(var r in e){var a,i=e[r],o=i.type,s=i.components;switch(o){case"float32":a=new n.Float32BufferAttribute(i.data,s);break;case"uint8":a=new n.Uint8BufferAttribute(i.data,s);break;case"uint16":a=new n.Uint16BufferAttribute(i.data,s);break;default:console.log('THREE.PlayCanvasLoader: Array type "%s" not yet supported.',o)}t[r]=a}e._attributes=t}(t.vertices[r]);for(var r=0,a=t.meshes.length;r<a;r++)!function(e){var r=new n.BufferGeometry;r.setIndex(e.indices);var a=t.vertices[e.vertices]._attributes;for(var i in a){var o=a[i];"texCoord0"===i&&(i="uv"),r.addAttribute(i,o)}e._geometry=r}(t.meshes[r]);for(var r=0,a=t.meshInstances.length;r<a;r++)!function(e){var r=t.nodes[e.node],a=t.meshes[e.mesh];void 0===r._geometries&&(r._geometries=[]),r._geometries.push(a._geometry)}(t.meshInstances[r]);for(var r=0,a=t.nodes.length;r<a;r++)!function(e){var t=new n.Group,r=e._geometries;if(void 0!==r)for(var a=new n.MeshPhongMaterial,i=0,o=r.length;i<o;i++){var s=r[i];t.add(new n.Mesh(s,a))}for(var i=0,o=e.rotation.length;i<o;i++)e.rotation[i]*=Math.PI/180;t.name=e.name,t.position.fromArray(e.position),t.rotation.fromArray(e.rotation),t.scale.fromArray(e.scale),e._object=t}(t.nodes[r]);for(var r=0,a=t.parents.length;r<a;r++){var i=t.parents[r];-1!==i&&t.nodes[i]._object.add(t.nodes[r]._object)}return t.nodes[0]._object}},t.default=n.PlayCanvasLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PLYLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.propertyNameMapping={}},n.PLYLoader.prototype={constructor:n.PLYLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t=/ply([\s\S]*)end_header\s/,r="",a=0,n=t.exec(e);null!==n&&(r=n[1],a=n[0].length);for(var i,o,s,l={comments:[],elements:[],headerLength:a},u=r.split("\n"),c=0;c<u.length;c++){var d=u[c];if(""!==(d=d.trim()))switch(s=d.split(/\s+/),o=s.shift(),d=s.join(" "),o){case"format":l.format=s[0],l.version=s[1];break;case"comment":l.comments.push(d);break;case"element":void 0!==i&&l.elements.push(i),i={},i.name=s[0],i.count=parseInt(s[1]),i.properties=[];break;case"property":i.properties.push(function(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}(s,h.propertyNameMapping));break;default:console.log("unhandled",o,s)}}return void 0!==i&&l.elements.push(i),l}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){for(var a=t.split(/\s+/),n={},i=0;i<e.length;i++)if("list"===e[i].type){for(var o=[],s=r(a.shift(),e[i].countType),l=0;l<s;l++)o.push(r(a.shift(),e[i].itemType));n[e[i].name]=o}else n[e[i].name]=r(a.shift(),e[i].type);return n}function i(e,t){var r,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},i=/end_header\s([\s\S]*)$/,l="";null!==(r=i.exec(e))&&(l=r[1]);for(var u=l.split("\n"),c=0,h=0,d=0;d<u.length;d++){var p=u[d];if(""!==(p=p.trim())){h>=t.elements[c].count&&(c++,h=0);var f=a(t.elements[c].properties,p);s(n,t.elements[c].name,f),h++}}return o(n)}function o(e){var t=new n.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new n.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new n.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new n.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new n.Float32BufferAttribute(e.colors,3)),t.computeBoundingSphere(),t}function s(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var a=r.vertex_indices||r.vertex_index;3===a.length?e.indices.push(a[0],a[1],a[2]):4===a.length&&(e.indices.push(a[0],a[1],a[3]),e.indices.push(a[1],a[2],a[3]))}}function l(e,t,r,a){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,a),2];case"uint16":case"ushort":return[e.getUint16(t,a),2];case"int32":case"int":return[e.getInt32(t,a),4];case"uint32":case"uint":return[e.getUint32(t,a),4];case"float32":case"float":return[e.getFloat32(t,a),4];case"float64":case"double":return[e.getFloat64(t,a),8]}}function u(e,t,r,a){for(var n,i={},o=0,s=0;s<r.length;s++)if("list"===r[s].type){var u=[];n=l(e,t+o,r[s].countType,a);var c=n[0];o+=n[1];for(var h=0;h<c;h++)n=l(e,t+o,r[s].itemType,a),u.push(n[0]),o+=n[1];i[r[s].name]=u}else n=l(e,t+o,r[s].type,a),i[r[s].name]=n[0],o+=n[1];return[i,o]}var c,h=this;if(e instanceof ArrayBuffer){var d=n.LoaderUtils.decodeText(new Uint8Array(e)),p=t(d);c="ascii"===p.format?i(d,p):function(e,t){for(var r,a={indices:[],vertices:[],normals:[],uvs:[],colors:[]},n="binary_little_endian"===t.format,i=new DataView(e,t.headerLength),l=0,c=0;c<t.elements.length;c++)for(var h=0;h<t.elements[c].count;h++){r=u(i,l,t.elements[c].properties,n),l+=r[1];var d=r[0];s(a,t.elements[c].name,d)}return o(a)}(e,p)}else c=i(e,t(e));return c}},t.default=n.PLYLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);!function(e){function t(){if(null===n){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);t[0]=170,t[1]=187,n=43707===r[0]}return n}function r(e,r,a,n,i){var s,l=r.BYTES_PER_ELEMENT;if(i===t()||1===l)s=new r(e,a,n);else{var u=new DataView(e,a,n*l),c=o[r.name],h=!i,d=0;for(s=new r(n);d<n;d++)s[d]=u[c](d*l,h)}return s}function a(e){var t=new Uint8Array(e),a=t[0],n=t[1],o=!!(n>>7&1),s=n>>6&1,l=1==(n>>5&1),u=31&n,c=0,h=0;if(l?(c=(t[2]<<16)+(t[3]<<8)+t[4],h=(t[5]<<16)+(t[6]<<8)+t[7]):(c=t[2]+(t[3]<<8)+(t[4]<<16),h=t[5]+(t[6]<<8)+(t[7]<<16)),0===a)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==a)throw new Error("PRWM decoder: Unsupported format version: "+a);if(!o){if(0!==s)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==h)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var d,p,f,m,v,g,y,b,w,A=8,M={};for(w=0;w<u;w++){for(d="";A<t.length&&(p=t[A],A++,0!==p);)d+=String.fromCharCode(p);n=t[A],f=n>>7&1,m=1+(n>>4&3),v=15&n,g=i[v],A++,A=4*Math.ceil(A/4),y=r(e,g,A,m*c,l),A+=g.BYTES_PER_ELEMENT*m*c,M[d]={type:f,cardinality:m,values:y}}return A=4*Math.ceil(A/4),b=null,o&&(b=r(e,1===s?Uint32Array:Uint16Array,A,h,l)),{version:a,attributes:M,indices:b}}var n=null,i=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],o={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};e.PRWMLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.PRWMLoader.prototype={constructor:e.PRWMLoader,load:function(r,a,n,i){var o=this,s=new e.FileLoader(o.manager);s.setResponseType("arraybuffer"),r=r.replace(/\*/g,t()?"be":"le"),s.load(r,function(e){a(o.parse(e))},n,i)},parse:function(t){console.time("PRWMLoader");var r,n,i=a(t),o=Object.keys(i.attributes),s=new e.BufferGeometry;for(n=0;n<o.length;n++)r=i.attributes[o[n]],s.addAttribute(o[n],new e.BufferAttribute(r.values,r.cardinality,r.normalized));return null!==i.indices&&s.setIndex(new e.BufferAttribute(i.indices,1)),console.timeEnd("PRWMLoader"),s}},e.PRWMLoader.isBigEndianPlatform=function(){return t()}}(n),t.default=n.PRWMLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.PVRLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this._parser=n.PVRLoader.parse},n.PVRLoader.prototype=Object.create(n.CompressedTextureLoader.prototype),n.PVRLoader.prototype.constructor=n.PVRLoader,n.PVRLoader.parse=function(e,t){var r=new Uint32Array(e,0,13),a={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?n.PVRLoader._parseV3(a):559044176===r[11]?n.PVRLoader._parseV2(a):void console.error("THREE.PVRLoader: Unknown PVR format.")},n.PVRLoader._parseV3=function(e){var t,r,a=e.header,i=a[12],o=a[2],s=a[6],l=a[7],u=a[10],c=a[11];switch(o){case 0:t=2,r=n.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,r=n.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,r=n.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,r=n.RGBA_PVRTC_4BPPV1_Format;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",o)}return e.dataPtr=52+i,e.bpp=t,e.format=r,e.width=l,e.height=s,e.numSurfaces=u,e.numMipmaps=c,e.isCubemap=6===u,n.PVRLoader._extract(e)},n.PVRLoader._parseV2=function(e){var t,r,a=e.header,i=a[0],o=a[1],s=a[2],l=a[3],u=a[4],c=a[10],h=a[12],d=255&u,p=c>0;return 25===d?(r=p?n.RGBA_PVRTC_4BPPV1_Format:n.RGB_PVRTC_4BPPV1_Format,t=4):24===d?(r=p?n.RGBA_PVRTC_2BPPV1_Format:n.RGB_PVRTC_2BPPV1_Format,t=2):console.error("THREE.PVRLoader: Unknown PVR format:",d),e.dataPtr=i,e.bpp=t,e.format=r,e.width=s,e.height=o,e.numSurfaces=h,e.numMipmaps=l+1,e.isCubemap=6===h,n.PVRLoader._extract(e)},n.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,a=e.dataPtr,n=e.bpp,i=e.numSurfaces,o=0,s=0,l=0,u=0,c=0,h=0;2===n?(l=8,u=4):(l=4,u=4),s=l*u*n/8,t.mipmaps.length=e.numMipmaps*i;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,f=e.height>>d;c=p/l,h=f/u,c<2&&(c=2),h<2&&(h=2),o=c*h*s;for(var m=0;m<i;m++){var v=new Uint8Array(r,a,o),g={data:v,width:p,height:f};t.mipmaps[m*e.numMipmaps+d]=g,a+=o}d++}return t},t.default=n.PVRLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.HDRLoader=n.RGBELoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.RGBELoader.prototype=Object.create(n.DataTextureLoader.prototype),n.RGBELoader.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var a=e.pos,n=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));0>(n=s.indexOf("\n"))&&i<t&&a<e.byteLength;)o+=s,i+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return-1<n&&(!1!==r&&(e.pos+=i+n+1),o+s.slice(0,n))},a=new Uint8Array(e);a.byteLength;a.pos=0;var i=function(e){var a,n,i=/^#\?(\S+)$/,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(a=r(e)))return t(1,"no header found");if(!(n=a.match(i)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=n[1],c.string+=a+"\n";;){if(!1===(a=r(e)))break;if(c.string+=a+"\n","#"!==a.charAt(0)){if((n=a.match(o))&&(c.gamma=parseFloat(n[1],10)),(n=a.match(s))&&(c.exposure=parseFloat(n[1],10)),(n=a.match(l))&&(c.valid|=2,c.format=n[1]),(n=a.match(u))&&(c.valid|=4,c.height=parseInt(n[1],10),c.width=parseInt(n[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=a+"\n"}return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==i){var o=i.width,s=i.height,l=function(e,r,a){var n,i,o,s,l,u,c,h,d,p,f,m,v,g=r,y=a;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(n=new Uint8Array(4*r*a))||!n.length)return t(4,"unable to allocate buffer space");for(i=0,o=0,h=4*g,v=new Uint8Array(4),u=new Uint8Array(h);y>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(v[0]=e[o++],v[1]=e[o++],v[2]=e[o++],v[3]=e[o++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(c=0;c<h&&o<e.byteLength;){if(s=e[o++],m=s>128,m&&(s-=128),0===s||c+s>h)return t(3,"bad scanline data");if(m)for(l=e[o++],d=0;d<s;d++)u[c++]=l;else u.set(e.subarray(o,o+s),c),c+=s,o+=s}for(p=g,d=0;d<p;d++)f=0,n[i]=u[d+f],f+=g,n[i+1]=u[d+f],f+=g,n[i+2]=u[d+f],f+=g,n[i+3]=u[d+f],i+=4;y--}return n}(a.subarray(a.pos),o,s);if(-1!==l)return{width:o,height:s,data:l,header:i.string,gamma:i.gamma,exposure:i.exposure,format:n.RGBEFormat,type:n.UnsignedByteType}}return null},t.default=n.RGBELoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.STLLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.STLLoader.prototype={constructor:n.STLLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){try{t(i.parse(e))}catch(e){a&&a(e)}},r,a)},parse:function(e){var t=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var t,r,a;if(a=new DataView(e),t=50,r=a.getUint32(80,!0),84+r*t===a.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(n[i]!=a.getUint8(i,!1))return!0;return!1}(t)?function(e){for(var t,r,a,i,o,s,l,u,c=new DataView(e),h=c.getUint32(80,!0),d=!1,p=0;p<70;p++)1129270351==c.getUint32(p,!1)&&82==c.getUint8(p+4)&&61==c.getUint8(p+5)&&(d=!0,i=[],o=c.getUint8(p+6)/255,s=c.getUint8(p+7)/255,l=c.getUint8(p+8)/255,u=c.getUint8(p+9)/255);for(var f=new n.BufferGeometry,m=[],v=[],g=0;g<h;g++){var y=84+50*g,b=c.getFloat32(y,!0),w=c.getFloat32(y+4,!0),A=c.getFloat32(y+8,!0);if(d){var M=c.getUint16(y+48,!0);0==(32768&M)?(t=(31&M)/31,r=(M>>5&31)/31,a=(M>>10&31)/31):(t=o,r=s,a=l)}for(var x=1;x<=3;x++){var L=y+12*x;m.push(c.getFloat32(L,!0)),m.push(c.getFloat32(L+4,!0)),m.push(c.getFloat32(L+8,!0)),v.push(b,w,A),d&&i.push(t,r,a)}}return f.addAttribute("position",new n.BufferAttribute(new Float32Array(m),3)),f.addAttribute("normal",new n.BufferAttribute(new Float32Array(v),3)),d&&(f.addAttribute("color",new n.BufferAttribute(new Float32Array(i),3)),f.hasColors=!0,f.alpha=u),f}(t):function(e){for(var t,r=new n.BufferGeometry,a=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),u=[],c=[],h=new n.Vector3;null!==(t=a.exec(e));){for(var d=0,p=0,f=t[0];null!==(t=l.exec(f));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),p++;for(;null!==(t=s.exec(f));)u.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),c.push(h.x,h.y,h.z),d++;1!==p&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==d&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new n.Float32BufferAttribute(u,3)),r.addAttribute("normal",new n.Float32BufferAttribute(c,3)),r}(function(e){return"string"!=typeof e?n.LoaderUtils.decodeText(new Uint8Array(e)):e}(e))}},t.default=n.STLLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.SVGLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.SVGLoader.prototype={constructor:n.SVGLoader,load:function(e,t,r,a){var i=this,o=new DOMParser;new n.FileLoader(i.manager).load(e,function(e){var r=o.parseFromString(e,"image/svg+xml");t(r.documentElement)},r,a)}},t.default=n.SVGLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.TDSLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]},n.TDSLoader.prototype={constructor:n.TDSLoader,load:function(e,t,r,a){var i=this,o=void 0!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),s=new n.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(i.parse(e,o))},r,a)},parse:function(e,t){this.group=new n.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(e,t){var r=new DataView(e),a=this.readChunk(r);if(a.id===o||a.id===s||a.id===i)for(var n=this.nextChunk(r,a);0!==n;){if(n===l){var u=this.readDWord(r);this.debugMessage("3DS file version: "+u)}else n===p?(this.resetPosition(r),this.readMeshData(r,t)):this.debugMessage("Unknown main chunk: "+n.toString(16));n=this.nextChunk(r,a)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var r=this.readChunk(e),a=this.nextChunk(e,r);0!==a;){if(a===f){var n=+this.readDWord(e);this.debugMessage("Mesh Version: "+n)}else if(a===m){var i=this.readFloat(e);this.debugMessage("Master scale: "+i),this.group.scale.set(i,i,i)}else a===R?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):a===v?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+a.toString(16));a=this.nextChunk(e,r)}},readNamedObject:function(e){var t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;for(var a=this.nextChunk(e,t);0!==a;){if(a===I){this.resetPosition(e);var n=this.readMesh(e);n.name=r,this.meshes.push(n)}else this.debugMessage("Unknown named object chunk: "+a.toString(16));a=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var r=this.readChunk(e),a=this.nextChunk(e,r),i=new n.MeshPhongMaterial;0!==a;){if(a===g)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(a===L)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(a===E){var o=this.readByte(e);i.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(a===M)i.side=n.DoubleSide,this.debugMessage("   DoubleSided");else if(a===x)this.debugMessage("   Additive Blending"),i.blending=n.AdditiveBlending;else if(a===b)this.debugMessage("   Diffuse Color"),i.color=this.readColor(e);else if(a===w)this.debugMessage("   Specular Color"),i.specular=this.readColor(e);else if(a===y)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(a===A){var s=this.readWord(e);i.shininess=s,this.debugMessage("   Shininess : "+s)}else a===T?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):a===_?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):a===k?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):a===N?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+a.toString(16));a=this.nextChunk(e,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(e){var t=this.readChunk(e),r=this.nextChunk(e,t),a=null,i=[];a=new n.Geometry;var o=new n.MeshPhongMaterial,s=new n.Mesh(a,o);for(s.name="mesh";0!==r;){if(r===B){var l=this.readWord(e);this.debugMessage("   Vertex: "+l);for(var u,u=0;u<l;u++)a.vertices.push(new n.Vector3(this.readFloat(e),this.readFloat(e),this.readFloat(e)))}else if(r===D)this.resetPosition(e),this.readFaceArray(e,s);else if(r===j){var c=this.readWord(e);this.debugMessage("   UV: "+c);var i,u;i=[];for(var u=0;u<c;u++)i.push(new n.Vector2(this.readFloat(e),this.readFloat(e)))}else if(r===U){this.debugMessage("   Tranformation Matrix (TODO)");for(var h=[],u=0;u<12;u++)h[u]=this.readFloat(e);var d=new n.Matrix4;d.elements[0]=h[0],d.elements[1]=h[6],d.elements[2]=h[3],d.elements[3]=h[9],d.elements[4]=h[2],d.elements[5]=h[8],d.elements[6]=h[5],d.elements[7]=h[11],d.elements[8]=h[1],d.elements[9]=h[7],d.elements[10]=h[4],d.elements[11]=h[10],d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,d.transpose();var p=new n.Matrix4;p.getInverse(d,!0),a.applyMatrix(p),d.decompose(s.position,s.quaternion,s.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}if(this.endChunk(t),i.length>0){for(var f=[],u=0;u<a.faces.length;u++)f.push([i[a.faces[u].a],i[a.faces[u].b],i[a.faces[u].c]]);a.faceVertexUvs[0]=f}return a.computeVertexNormals(),s},readFaceArray:function(e,t){var r=this.readChunk(e),a=this.readWord(e);this.debugMessage("   Faces: "+a);for(var i=0;i<a;++i){t.geometry.faces.push(new n.Face3(this.readWord(e),this.readWord(e),this.readWord(e)));this.readWord(e)}for(;this.position<r.end;){var r=this.readChunk(e);if(r.id===V){this.debugMessage("      Material Group"),this.resetPosition(e);var o=this.readMaterialGroup(e),s=this.materials[o.name];void 0!==s&&(t.material=s,""===s.name&&(s.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(e,t){var r=this.readChunk(e),a=this.nextChunk(e,r),i={},o=new n.TextureLoader(this.manager);for(o.setPath(t);0!==a;){if(a===C){var s=this.readString(e,128);i=o.load(s),this.debugMessage("      File: "+t+s)}else a===F?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):a===P?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):a===S?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):a===O?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+a.toString(16));a=this.nextChunk(e,r)}return this.endChunk(r),i},readMaterialGroup:function(e){var t=(this.readChunk(e),this.readString(e,64)),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);for(var a=[],n=0;n<r;++n)a.push(this.readWord(e));return{name:t,index:a}},readColor:function(e){var t=this.readChunk(e),r=new n.Color;if(t.id===c||t.id===h){var a=this.readByte(e),i=this.readByte(e),o=this.readByte(e);r.setRGB(a/255,i/255,o/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===u||t.id===d){var a=this.readFloat(e),i=this.readFloat(e),o=this.readFloat(e);r.setRGB(a,i,o),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var r="",a=0;a<t;a++){var n=this.readByte(e);if(!n)break;r+=String.fromCharCode(n)}return r},setPath:function(e){return this.path=e,this},debugMessage:function(e){this.debug&&console.log(e)}};var i=19789,o=15786,s=49725,l=2,u=16,c=17,h=18,d=19,p=15677,f=15678,m=256,v=45055,g=40960,y=40976,b=40992,w=41008,A=41024,M=41089,x=41091,L=41093,E=41095,T=41472,k=41488,_=41520,N=41476,C=41728,S=41812,O=41814,F=41816,P=41818,R=16384,I=16640,B=16656,D=16672,V=16688,j=16704,U=16736;t.default=n.TDSLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.TGALoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.TGALoader.prototype={constructor:n.TGALoader,load:function(e,t,r,a){var i=this,o=new n.Texture,s=new n.FileLoader(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){o.image=i.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)},r,a),o},parse:function(e){function t(e,t,r,a,n,i,o,s,l){var u,c,h,d=l,p=0,f=M.width;for(h=t;h!==a;h+=r)for(c=n;c!==o;c+=i,p++)u=s[p],e[4*(c+f*h)+3]=255,e[4*(c+f*h)+2]=d[3*u+0],e[4*(c+f*h)+1]=d[3*u+1],e[4*(c+f*h)+0]=d[3*u+2];return e}function r(e,t,r,a,n,i,o,s){var l,u,c,h=0,d=M.width;for(c=t;c!==a;c+=r)for(u=n;u!==o;u+=i,h+=2)l=s[h+0]+(s[h+1]<<8),e[4*(u+d*c)+0]=(31744&l)>>7,e[4*(u+d*c)+1]=(992&l)>>2,e[4*(u+d*c)+2]=(31&l)>>3,e[4*(u+d*c)+3]=32768&l?0:255;return e}function a(e,t,r,a,n,i,o,s){var l,u,c=0,h=M.width;for(u=t;u!==a;u+=r)for(l=n;l!==o;l+=i,c+=3)e[4*(l+h*u)+3]=255,e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+1]=s[c+1],e[4*(l+h*u)+0]=s[c+2];return e}function n(e,t,r,a,n,i,o,s){var l,u,c=0,h=M.width;for(u=t;u!==a;u+=r)for(l=n;l!==o;l+=i,c+=4)e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+1]=s[c+1],e[4*(l+h*u)+0]=s[c+2],e[4*(l+h*u)+3]=s[c+3];return e}function i(e,t,r,a,n,i,o,s){var l,u,c,h=0,d=M.width;for(c=t;c!==a;c+=r)for(u=n;u!==o;u+=i,h++)l=s[h],e[4*(u+d*c)+0]=l,e[4*(u+d*c)+1]=l,e[4*(u+d*c)+2]=l,e[4*(u+d*c)+3]=255;return e}function o(e,t,r,a,n,i,o,s){var l,u,c=0,h=M.width;for(u=t;u!==a;u+=r)for(l=n;l!==o;l+=i,c+=2)e[4*(l+h*u)+0]=s[c+0],e[4*(l+h*u)+1]=s[c+0],e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+3]=s[c+1];return e}var s=0,l=1,u=2,c=3,h=9,d=10,p=11,f=48,m=4,v=0,g=1,y=2,b=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var w=new Uint8Array(e),A=0,M={id_length:w[A++],colormap_type:w[A++],image_type:w[A++],colormap_index:w[A++]|w[A++]<<8,colormap_length:w[A++]|w[A++]<<8,colormap_size:w[A++],origin:[w[A++]|w[A++]<<8,w[A++]|w[A++]<<8],width:w[A++]|w[A++]<<8,height:w[A++]|w[A++]<<8,pixel_size:w[A++],flags:w[A++]};!function(e){switch(e.image_type){case l:case h:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case u:case c:case d:case p:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case s:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(M),M.id_length+A>e.length&&console.error("THREE.TGALoader: No data."),A+=M.id_length;var x=!1,L=!1,E=!1;switch(M.image_type){case h:x=!0,L=!0;break;case l:L=!0;break;case d:x=!0;break;case u:break;case p:x=!0,E=!0;break;case c:E=!0}var T=document.createElement("canvas");T.width=M.width,T.height=M.height;var k=T.getContext("2d"),_=k.createImageData(M.width,M.height),N=function(e,t,r,a,n){var i,o,s,l;if(o=r.pixel_size>>3,s=r.width*r.height*o,t&&(l=n.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){i=new Uint8Array(s);for(var u,c,h,d=0,p=new Uint8Array(o);d<s;)if(u=n[a++],c=1+(127&u),128&u){for(h=0;h<o;++h)p[h]=n[a++];for(h=0;h<c;++h)i.set(p,d+h*o);d+=o*c}else{for(c*=o,h=0;h<c;++h)i[d+h]=n[a++];d+=c}}else i=n.subarray(a,a+=t?r.width*r.height:s);return{pixel_data:i,palettes:l}}(x,L,M,A,w);!function(e,s,l,u,c){var h,d,p,w,A,x;switch((M.flags&f)>>m){default:case y:h=0,p=1,A=s,d=0,w=1,x=l;break;case v:h=0,p=1,A=s,d=l-1,w=-1,x=-1;break;case b:h=s-1,p=-1,A=-1,d=0,w=1,x=l;break;case g:h=s-1,p=-1,A=-1,d=l-1,w=-1,x=-1}if(E)switch(M.pixel_size){case 8:i(e,d,w,x,h,p,A,u);break;case 16:o(e,d,w,x,h,p,A,u);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(M.pixel_size){case 8:t(e,d,w,x,h,p,A,u,c);break;case 16:r(e,d,w,x,h,p,A,u);break;case 24:a(e,d,w,x,h,p,A,u);break;case 32:n(e,d,w,x,h,p,A,u);break;default:console.error("THREE.TGALoader: Format not supported.")}}(_.data,M.width,M.height,N.pixel_data,N.palettes);return k.putImageData(_,0,0),T}},t.default=n.TGALoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.TTFLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.reversed=!1},n.TTFLoader.prototype={constructor:n.TTFLoader,load:function(e,t,r,a){var i=this,o=new n.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e){var t,r=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var a=[];return r.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};a.push(t);for(var r=e.length-1;r>0;r--){var n=e[r],t={type:n.type};void 0!==n.x2&&void 0!==n.y2?(t.x1=n.x2,t.y1=n.y2,t.x2=n.x1,t.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(t.x1=n.x1,t.y1=n.y1),t.x=e[r-1].x,t.y=e[r-1].y,a.push(t)}}),a}return"undefined"==typeof opentype?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){for(var a=Math.round,n={},i=1e5/(72*(e.unitsPerEm||2048)),o=0;o<e.glyphs.length;o++){var s=e.glyphs.glyphs[o];if(void 0!==s.unicode){var l={ha:a(s.advanceWidth*i),x_min:a(s.xMin*i),x_max:a(s.xMax*i),o:""};r&&(s.path.commands=t(s.path.commands)),s.path.commands.forEach(function(e,t){"c"===e.type.toLowerCase()&&(e.type="b"),l.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(l.o+=a(e.x*i)+" "+a(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(l.o+=a(e.x1*i)+" "+a(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(l.o+=a(e.x2*i)+" "+a(e.y2*i)+" ")}),n[String.fromCharCode(s.unicode)]=l}}return{glyphs:n,familyName:e.familyName,ascender:a(e.ascender*i),descender:a(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}},t.default=n.TTFLoader},function(e,t,r){"use strict";function a(e,t,r){(new o.FileLoader).load(e,t,r)}function n(e,t){a(e,function(e){t(JSON.parse(e))},function(){})}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(i);o.UTF8Loader=function(){},o.UTF8Loader.prototype.load=function(e,t,r){this.downloadModelJson(e,t,r)},o.UTF8Loader.BufferGeometryCreator=function(){},o.UTF8Loader.BufferGeometryCreator.prototype.create=function(e,t){var r,a,n,i=t.length/3,s=new o.BufferGeometry,l=new Float32Array(3*i*3),u=new Float32Array(3*i*3),c=new Float32Array(3*i*2),h=e.length;for(a=0,n=0,r=n;r<h;r+=8)l[a++]=e[r],l[a++]=e[r+1],l[a++]=e[r+2];for(a=0,n=3,r=n;r<h;r+=8)c[a++]=e[r],c[a++]=e[r+1];for(a=0,n=5,r=n;r<h;r+=8)u[a++]=e[r],u[a++]=e[r+1],u[a++]=e[r+2];return s.setIndex(new o.BufferAttribute(t,1)),s.addAttribute("position",new o.BufferAttribute(l,3)),s.addAttribute("normal",new o.BufferAttribute(u,3)),s.addAttribute("uv",new o.BufferAttribute(c,2)),s.computeBoundingSphere(),s};var s={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};o.UTF8Loader.prototype.decompressAttribsInner_=function(e,t,r,a,n,i,o,s){for(var l=0,u=t;u<r;u++){var c=e.charCodeAt(u);l+=c>>1^-(1&c),a[n]=s*(l+o),n+=i}},o.UTF8Loader.prototype.decompressIndices_=function(e,t,r,a,n){for(var i=0,o=0;o<r;o++){var s=e.charCodeAt(t++);a[n++]=i-s,0===s&&i++}},o.UTF8Loader.prototype.decompressAABBs_=function(e,t,r,a,n){for(var i=6*r,o=t+i,s=0,l=new Float32Array(i),u=t;u<o;u+=6){var c=e.charCodeAt(u+0)+a[0],h=e.charCodeAt(u+1)+a[1],d=e.charCodeAt(u+2)+a[2],p=e.charCodeAt(u+3)+1>>1,f=e.charCodeAt(u+4)+1>>1,m=e.charCodeAt(u+5)+1>>1;l[s++]=n[0]*(c+p),l[s++]=n[1]*(h+f),l[s++]=n[2]*(d+m),l[s++]=n[0]*p,l[s++]=n[1]*f,l[s++]=n[2]*m}return l},o.UTF8Loader.prototype.decompressMesh=function(e,t,r,a,n,i){for(var o=r.decodeScales.length,s=r.decodeOffsets,l=r.decodeScales,u=t.attribRange[0],c=t.attribRange[1],h=u,d=new Float32Array(o*c),p=0;p<o;p++){var f=h+c,m=l[p];m&&this.decompressAttribsInner_(e,h,f,d,p,o,s[p],m),h=f}var v=3*t.indexRange[1],g=new Uint16Array(v);this.decompressIndices_(e,h,v,g,0);var y=void 0,b=t.bboxes;b&&(y=this.decompressAABBs_(e,b,t.names.length,s,l)),i(a,n,d,g,y,t)},o.UTF8Loader.prototype.copyAttrib=function(e,t,r,a){for(var n=0;n<e;n++)r[n]=t[e*a+n]},o.UTF8Loader.prototype.decodeAttrib2=function(e,t,r,a,n,i,o,s,l,u){for(var c=0;c<5;c++){var h=e.charCodeAt(n+i*c+u),d=h>>1^-(1&h);l[c]+=d,s[t*u+c]=l[c],o[t*u+c]=a[c]*(l[c]+r[c])}},o.UTF8Loader.prototype.accumulateNormal=function(e,t,r,a,n){var i=a[8*e],o=a[8*e+1],s=a[8*e+2],l=a[8*t],u=a[8*t+1],c=a[8*t+2],h=a[8*r],d=a[8*r+1],p=a[8*r+2];l-=i,u-=o,c-=s,h-=i,d-=o,p-=s,i=u*p-c*d,o=c*h-l*p,s=l*d-u*h,n[3*e]+=i,n[3*e+1]+=o,n[3*e+2]+=s,n[3*t]+=i,n[3*t+1]+=o,n[3*t+2]+=s,n[3*r]+=i,n[3*r+1]+=o,n[3*r+2]+=s},o.UTF8Loader.prototype.decompressMesh2=function(e,t,r,a,n,i){for(var o=r.decodeScales.length,s=r.decodeOffsets,l=r.decodeScales,u=t.attribRange[0],c=t.attribRange[1],h=t.codeRange[0],d=3*t.codeRange[2],p=new Uint16Array(d),f=new Int32Array(3*c),m=new Uint16Array(o),v=new Uint16Array(o*c),g=new Float32Array(o*c),y=0,b=0,w=0;w<d;w+=3){var A=e.charCodeAt(h++),M=Math.min(w,96);if(A<M){var x,L,E,T=A%3,k=w-(A-T);switch(T){case 0:x=p[k+2],L=p[k+1],E=p[k+0];break;case 1:x=p[k+0],L=p[k+2],E=p[k+1];break;case 2:x=p[k+1],L=p[k+0],E=p[k+2]}p[b++]=x,p[b++]=L,A=e.charCodeAt(h++);var _=y-A;if(p[b++]=_,0===A){for(var N=0;N<5;N++){var C=e.charCodeAt(u+c*N+y),S=(C>>1^-(1&C))+v[o*x+N]+v[o*L+N]-v[o*E+N];m[N]=S,v[o*y+N]=S,g[o*y+N]=l[N]*(S+s[N])}y++}else this.copyAttrib(o,v,m,_);this.accumulateNormal(x,L,_,v,f)}else{var O=y-(A-M);p[b++]=O,A===M?this.decodeAttrib2(e,o,s,l,u,c,g,v,m,y++):this.copyAttrib(o,v,m,O),A=e.charCodeAt(h++);var F=y-A;p[b++]=F,0===A?this.decodeAttrib2(e,o,s,l,u,c,g,v,m,y++):this.copyAttrib(o,v,m,F),A=e.charCodeAt(h++);var P=y-A;if(p[b++]=P,0===A){for(var N=0;N<5;N++)m[N]=(v[o*O+N]+v[o*F+N])/2;this.decodeAttrib2(e,o,s,l,u,c,g,v,m,y++)}else this.copyAttrib(o,v,m,P);this.accumulateNormal(O,F,P,v,f)}}for(var w=0;w<c;w++){var R=f[3*w],I=f[3*w+1],B=f[3*w+2],D=511/Math.sqrt(R*R+I*I+B*B),V=e.charCodeAt(u+5*c+w),j=e.charCodeAt(u+6*c+w),U=e.charCodeAt(u+7*c+w);g[o*w+5]=D*R+(V>>1^-(1&V)),g[o*w+6]=D*I+(j>>1^-(1&j)),g[o*w+7]=D*B+(U>>1^-(1&U))}i(a,n,g,p,void 0,t)},o.UTF8Loader.prototype.downloadMesh=function(e,t,r,n,i){function o(e){for(;l<r.length;){var a=r[l],o=a.indexRange;if(o){var u=o[0]+3*o[1];if(e.length<u)break;s.decompressMesh(e,a,n,t,l,i)}else{var c=a.codeRange,u=c[0]+c[1];if(e.length<u)break;s.decompressMesh2(e,a,n,t,l,i)}++l}}var s=this,l=0;a(e,function(e){o(e)})},o.UTF8Loader.prototype.downloadMeshes=function(e,t,r,a){for(var n in t){var i=t[n];this.downloadMesh(e+n,n,i,r,a)}},o.UTF8Loader.prototype.createMeshCallback=function(e,t,r){var a=0,n=0,i={},s={},l={},u=t.urls;for(var c in u)i[c]=u[c].length,s[c]=0,n++,l[c]=new o.Object3D;var h=new o.Object3D,d=new o.MTLLoader.MaterialCreator(e,t.options);d.setMaterials(t.materials),d.preload();var p=new o.UTF8Loader.BufferGeometryCreator;return function(e,t,u,c,f,m){var v=p.create(u,c),g=d.create(m.material),y=new o.Mesh(v,g);l[e].add(y),++s[e]===i[e]&&(a++,h.add(l[e]),a===n&&r(h))}},o.UTF8Loader.prototype.downloadModel=function(e,t,r,a){var n=this.createMeshCallback(t,r,a);this.downloadMeshes(e,r.urls,r.decodeParams,n)},o.UTF8Loader.prototype.downloadModelJson=function(e,t,r){n(e,function(a){a.decodeParams||(r&&r.decodeParams?a.decodeParams=r.decodeParams:a.decodeParams=s),a.options=r;var n=e.substr(0,e.lastIndexOf("/")+1),i=n;r&&r.geometryBase&&(n=r.geometryBase,"/"!==n.charAt(n.length-1)&&(n+="/")),r&&r.materialBase&&(i=r.materialBase,"/"!==i.charAt(i.length-1)&&(i+="/")),this.downloadModel(n,i,a,t)}.bind(this))},t.default=o.UTF8Loader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.VRMLLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},n.VRMLLoader.prototype={constructor:n.VRMLLoader,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"Anonymous",load:function(e,t,r,a){var i=this;new n.FileLoader(this.manager).load(e,function(e){t(i.parse(e))},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.texturePath||"",r=new n.TextureLoader(this.manager);r.setCrossOrigin(this.crossOrigin);for(var a=new n.Scene,i=e.split("\n"),o=i.length-1;o>-1;o--){var s=i[o];if(/{.*[{\[]/.test(s)){var l=s.split("{").join("{\n").split("\n");l.unshift(1),l.unshift(o),i.splice.apply(i,l)}else if(/\].*}/.test(s)){var l=s.split("]").join("]\n").split("\n");l.unshift(1),l.unshift(o),i.splice.apply(i,l)}if(/}.*}/.test(s)){var l=s.split("}").join("}\n").split("\n");l.unshift(1),l.unshift(o),i.splice.apply(i,l)}/^\b[^\s]+\b$/.test(s.trim())?(i[o+1]=s+" "+i[o+1].trim(),i.splice(o,1)):s.indexOf("coord")>-1&&s.indexOf("[")<0&&s.indexOf("{")<0&&(i[o]+=" Coordinate {}")}var u=i.shift();return/V1.0/.exec(u)?function(){console.warn("THREE.VRMLLoader: V1.0 not supported yet.")}():/V2.0/.exec(u)&&function(e,a){function i(e,t,r,a,i){for(var o=!0===i?1:-1,s=[],l={},u={},c=0;c<r.length;c++){var h={x:o*(Math.cos(r[c])*t),y:o*(Math.sin(r[c])*t)};s.push(h)}for(var d=e.index,p=e.attributes.position,f=new n.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),m=new n.Vector3,v=new n.Color,g=0;g<d.count;g++){var y=d.getX(g);m.fromBufferAttribute(p,y);for(var b=0;b<a.length;b++)if(0===b?(l.x=0,l.y=!0===i?t:-1*t):(l.x=s[b-1].x,l.y=s[b-1].y),void 0!==(u=s[b]))if(!0==(!0===i?m.y<=l.y&&m.y>u.y:m.y>=l.y&&m.y<u.y)){var w=a[b],A=a[b+1],M=Math.abs(m.y-l.y)/(l.y-u.y);v.copy(w).lerp(A,M),f.setXYZ(y,v.r,v.g,v.b)}else{var x=!0===i?a.length-1:0,L=a[x];f.setXYZ(y,L.r,L.g,L.b)}}e.addAttribute("color",f)}function o(e,t){for(var r,a,n,i=[],o={},s=/[^\s,\[\]]+/g;null!==(r=s.exec(t));)i.push(r[0]);switch(a=i[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=a,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=a,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=a,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":case"texCoordIndex":this.recordingFieldname=a,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(i.length>0)for(var l=0;l<i.length;l++)/(-?\d+)/.test(i[l])&&("-1"===i[l]?(d.length>0&&this.indexes.push(d),d=[]):d.push(parseInt(i[l])));/]/.exec(t)&&(d.length>0&&this.indexes.push(d),d=[],this.isRecordingFaces=!1,e[this.recordingFieldname]=this.indexes)}else if(this.isRecordingPoints){if("Coordinate"==e.nodeType)for(;null!==(i=h.exec(t));)n={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3])},this.points.push(n);if("TextureCoordinate"==e.nodeType)for(;null!==(i=c.exec(t));)n={x:parseFloat(i[1]),y:parseFloat(i[2])},this.points.push(n);/]/.exec(t)&&(this.isRecordingPoints=!1,e.points=this.points)}else if(this.isRecordingAngles){if(i.length>0)for(var l=0;l<i.length;l++)u.test(i[l])&&this.angles.push(parseFloat(i[l]));/]/.exec(t)&&(this.isRecordingAngles=!1,e[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(i=h.exec(t));){var p={r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])};this.colors.push(p)}/]/.exec(t)&&(this.isRecordingColors=!1,e[this.recordingFieldname]=this.colors)}else if("NULL"!==i[i.length-1]&&"children"!==a){switch(a){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==i.length){console.warn("THREE.VRMLLoader: Invalid color format detected for %s.",a);break}o={r:parseFloat(i[1]),g:parseFloat(i[2]),b:parseFloat(i[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==i.length){console.warn("THREE.VRMLLoader: Invalid vector format detected for %s.",a);break}o={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!==i.length){console.warn("THREE.VRMLLoader: Invalid single float value specification detected for %s.",a);break}o=parseFloat(i[1]);break;case"rotation":if(5!==i.length){console.warn("THREE.VRMLLoader: Invalid quaternion format detected for %s.",a);break}o={x:parseFloat(i[1]),y:parseFloat(i[2]),z:parseFloat(i[3]),w:parseFloat(i[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==i.length){console.warn("THREE.VRMLLoader: Invalid format detected for %s.",a);break}o="TRUE"===i[1]}e[a]=o}return o}function s(e,o){var u;if("string"!=typeof e){u=o,e.string.indexOf("AmbientLight")>-1&&"PointLight"===e.nodeType&&(e.nodeType="AmbientLight");var c=void 0===e.on||e.on,h=void 0!==e.intensity?e.intensity:1,d=new n.Color;if(e.color&&d.copy(e.color),"AmbientLight"===e.nodeType)u=new n.AmbientLight(d,h),u.visible=c,o.add(u);else if("PointLight"===e.nodeType){var p=0;void 0!==e.radius&&e.radius<1e3&&(p=e.radius),u=new n.PointLight(d,h,p),u.visible=c,o.add(u)}else if("SpotLight"===e.nodeType){var h=1,p=0,f=Math.PI/3,c=!0;void 0!==e.radius&&e.radius<1e3&&(p=e.radius),void 0!==e.cutOffAngle&&(f=e.cutOffAngle),u=new n.SpotLight(d,h,p,f,0),u.visible=c,o.add(u)}else if("Transform"===e.nodeType||"Group"===e.nodeType){if(u=new n.Object3D,/DEF/.exec(e.string)&&(u.name=/DEF\s+([^\s]+)/.exec(e.string)[1],l[u.name]=u),void 0!==e.translation){var m=e.translation;u.position.set(m.x,m.y,m.z)}if(void 0!==e.rotation){var v=e.rotation;u.quaternion.setFromAxisAngle(new n.Vector3(v.x,v.y,v.z),v.w)}if(void 0!==e.scale){var g=e.scale;u.scale.set(g.x,g.y,g.z)}o.add(u)}else if("Shape"===e.nodeType)u=new n.Mesh,/DEF/.exec(e.string)&&(u.name=/DEF\s+([^\s]+)/.exec(e.string)[1],l[u.name]=u),o.add(u);else if("Background"===e.nodeType){var y=2e4,b=new n.SphereBufferGeometry(y,20,20),w=new n.MeshBasicMaterial({fog:!1,side:n.BackSide});if(e.skyColor.length>1)i(b,y,e.skyAngle,e.skyColor,!0),w.vertexColors=n.VertexColors;else{var A=e.skyColor[0];w.color.setRGB(A.r,A.b,A.g)}if(a.add(new n.Mesh(b,w)),void 0!==e.groundColor){y=12e3;var M=new n.SphereBufferGeometry(y,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),x=new n.MeshBasicMaterial({fog:!1,side:n.BackSide,vertexColors:n.VertexColors});i(M,y,e.groundAngle,e.groundColor,!1),a.add(new n.Mesh(M,x))}}else{if(/geometry/.exec(e.string)){if("Box"===e.nodeType){var g=e.size;o.geometry=new n.BoxBufferGeometry(g.x,g.y,g.z)}else if("Cylinder"===e.nodeType)o.geometry=new n.CylinderBufferGeometry(e.radius,e.radius,e.height);else if("Cone"===e.nodeType)o.geometry=new n.CylinderBufferGeometry(e.topRadius,e.bottomRadius,e.height);else if("Sphere"===e.nodeType)o.geometry=new n.SphereBufferGeometry(e.radius);else if("IndexedFaceSet"===e.nodeType){var L,E,T,k,_,N,C=new n.BufferGeometry,S=[],O=[];for(T=0,k=e.children.length;T<k;T++){var F=e.children[T];if("TextureCoordinate"===F.nodeType&&F.points)for(_=0,N=F.points.length;_<N;_++)E=F.points[_],O.push(E.x,E.y);if("Coordinate"===F.nodeType){if(F.points)for(_=0,N=F.points.length;_<N;_++)L=F.points[_],S.push(L.x,L.y,L.z);if(F.string.indexOf("DEF")>-1){var P=/DEF\s+([^\s]+)/.exec(F.string)[1];l[P]=S.slice(0)}if(F.string.indexOf("USE")>-1){var R=/USE\s+([^\s]+)/.exec(F.string)[1];S=l[R]}}}var I=0;if(e.coordIndex){var B=[],D=[];for(L=new n.Vector3,E=new n.Vector2,T=0,k=e.coordIndex.length;T<k;T++){var V=e.coordIndex[T];for(I=0;V.length>=3&&I<V.length-2;){void 0===e.ccw&&(e.ccw=!0);var j=V[0],U=V[I+(e.ccw?1:2)],G=V[I+(e.ccw?2:1)];L.fromArray(S,3*j),E.fromArray(O,2*j),B.push(L.x,L.y,L.z),D.push(E.x,E.y),L.fromArray(S,3*U),E.fromArray(O,2*U),B.push(L.x,L.y,L.z),D.push(E.x,E.y),L.fromArray(S,3*G),E.fromArray(O,2*G),B.push(L.x,L.y,L.z),D.push(E.x,E.y),I++}}S=B,O=D}else o.parent.remove(o);!1===e.solid&&(o.material.side=n.DoubleSide),C.solid=e.solid,C.addAttribute("position",new n.Float32BufferAttribute(S,3)),O.length>0&&C.addAttribute("uv",new n.Float32BufferAttribute(O,2)),C.computeVertexNormals(),C.computeBoundingSphere(),/DEF/.exec(e.string)&&(C.name=/DEF ([^\s]+)/.exec(e.string)[1],l[C.name]=C),o.geometry=C}return}if(/appearance/.exec(e.string)){for(var T=0;T<e.children.length;T++){var F=e.children[T];if("Material"===F.nodeType){var z=new n.MeshPhongMaterial;if(void 0!==F.diffuseColor){var H=F.diffuseColor;z.color.setRGB(H.r,H.g,H.b)}if(void 0!==F.emissiveColor){var Y=F.emissiveColor;z.emissive.setRGB(Y.r,Y.g,Y.b)}if(void 0!==F.specularColor){var g=F.specularColor;z.specular.setRGB(g.r,g.g,g.b)}if(void 0!==F.transparency){var m=F.transparency;z.opacity=Math.abs(1-m),z.transparent=!0}/DEF/.exec(e.string)&&(z.name=/DEF ([^\s]+)/.exec(e.string)[1],l[z.name]=z),o.material=z}if("ImageTexture"===F.nodeType){var X=/"([^"]+)"/.exec(F.children[0]);X&&(o.material.name=X[1],o.material.map=r.load(t+X[1]))}}return}}for(var T=0,W=e.children.length;T<W;T++)s(e.children[T],u)}else if(/USE/.exec(e)){var R=/USE\s+?([^\s]+)/.exec(e)[1];void 0==l[R]?console.warn("THREE.VRMLLoader: %s is not defined.",R):/appearance/.exec(e)&&R?o.material=l[R].clone():/geometry/.exec(e)&&R?(o.geometry=l[R].clone(),void 0!==l[R].solid&&!1===l[R].solid&&(o.geometry.solid=!1,o.material.side=n.DoubleSide)):R&&(u=l[R].clone(),o.add(u))}}var l={},u=/(\b|\-|\+)([\d\.e]+)/,c=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,h=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,d=[];s(function(e){for(var t,r,a={string:"Scene",children:[]},n=a,i=0;i<e.length;i++){var s="",l=e[i];if(null===/^\s+?$/g.exec(l)&&""!==(l=l.trim())){if(/#/.exec(l)){var u=l.split("#");l=u[0],s=u[1]}if(t=/([^\s]*){1}(?:\s+)?{/.exec(l)){var c={nodeType:t[1],string:l,parent:n,children:[],comment:s};n.children.push(c),n=c,/}/.exec(l)&&(r=/{(.*)}/.exec(l)[1],c.children.push(r),o(n,r),n=n.parent)}else/}/.exec(l)?n=n.parent:""!==l&&(o(n,l),n.children.push(l))}}return a}(e),a)}(i,a),a}},t.default=n.VRMLLoader},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a);n.VTKLoader=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager},Object.assign(n.VTKLoader.prototype,n.EventDispatcher.prototype,{load:function(e,t,r,a){var i=this,o=new n.FileLoader(i.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e))},r,a)},parse:function(e){function t(e,t){var r=e.length,a=new Float32Array(r+t.length);return a.set(e),a.set(t,r),a}function r(e,t){var r=e.length,a=new Int32Array(r+t.length);return a.set(e),a.set(t,r),a}function a(e){for(var t="",r=new Uint8Array(e),a=0,n=r.length;n--;)t+=String.fromCharCode(r[a++]);return t}var i=n.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(e){function a(e){var t={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){t.attributes={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(t=e.nodeValue.trim());if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes.item(i),s=o.nodeName;if(void 0===t[s]){var l=a(o);""!==l&&(t[s]=l)}else{if(void 0===t[s].push){var u=t[s];t[s]=[u]}var l=a(o);""!==l&&t[s].push(l)}}return t}function i(e){var t,r="undefined"!=typeof Uint8Array?Uint8Array:Array,a=[],n=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=i.length;for(t=0;t<o;t++)a[t]=i[t];for(t=0;t<o;++t)n[i.charCodeAt(t)]=t;n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63;var s,l,u,c,h,o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");c="="===e[o-2]?2:"="===e[o-1]?1:0,h=new r(3*o/4-c),l=c>0?o-4:o;var d=0;for(t=0,s=0;t<l;t+=4,s+=3)u=n[e.charCodeAt(t)]<<18|n[e.charCodeAt(t+1)]<<12|n[e.charCodeAt(t+2)]<<6|n[e.charCodeAt(t+3)],h[d++]=(16711680&u)>>16,h[d++]=(65280&u)>>8,h[d++]=255&u;return 2===c?(u=n[e.charCodeAt(t)]<<2|n[e.charCodeAt(t+1)]>>4,h[d++]=255&u):1===c&&(u=n[e.charCodeAt(t)]<<10|n[e.charCodeAt(t+1)]<<4|n[e.charCodeAt(t+2)]>>2,h[d++]=u>>8&255,h[d++]=255&u),h}var o=null;if(window.DOMParser)try{o=(new DOMParser).parseFromString(e,"text/xml")}catch(e){o=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if(o=new ActiveXObject("Microsoft.XMLDOM"),o.async=!1,!o.loadXML())throw new Error(o.parseError.reason+o.parseError.srcText)}catch(e){o=null}}var s=o.documentElement,l=a(s),u=[],c=[],h=[];if(l.PolyData){for(var d=l.PolyData.Piece,p=l.attributes.hasOwnProperty("compressor"),f=["PointData","Points","Strips","Polys"],m=0,v=f.length;m<v;){var g=d[f[m]];if(g&&g.DataArray){if("[object Array]"===Object.prototype.toString.call(g.DataArray))var y=g.DataArray;else var y=[g.DataArray];for(var b=0,w=y.length;b<w;)"#text"in y[b]&&y[b]["#text"].length>0&&(y[b].text=function(e,a){var n=0;if("UInt64"===l.attributes.header_type?n=8:"UInt32"===l.attributes.header_type&&(n=4),"binary"===e.attributes.format&&a){var o,s,u,c,h,d,p,f,m;if("Float32"===e.attributes.type)var v=new Float32Array;else if("Int64"===e.attributes.type)var v=new Int32Array;o=e["#text"],u=i(o),c=u[0];for(var g=1;g<n-1;g++)c|=u[g]<<g*n;d=(c+3)*n,p=d%3>0?3-d%3:0,d+=p,f=[],m=d,f.push(m),h=3*n;for(var g=0;g<c;g++){for(var y=u[g*n+h],b=1;b<n-1;b++)y|=u[g*n+h+b]<<8*b;m+=y,f.push(m)}for(var g=0;g<f.length-1;g++){s=new Zlib.Inflate(u.slice(f[g],f[g+1]),{resize:!0,verify:!0}).decompress(),s=s.buffer,"Float32"===e.attributes.type?(s=new Float32Array(s),v=t(v,s)):"Int64"===e.attributes.type&&(s=new Int32Array(s),v=r(v,s))}delete e["#text"],"Float32"===e.attributes.type?"binary"===e.attributes.format&&(a||(v=v.filter(function(e,t){if(0!==t)return!0}))):"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(a||(v=v.filter(function(e,t){if(0!==t)return!0})),v=v.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||a)if(e["#text"])var s=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else var s=new Int32Array(0).buffer;else{var s=i(e["#text"]);s=s.slice(n).buffer}if(delete e["#text"],"Float32"===e.attributes.type)var v=new Float32Array(s);else if("Int32"===e.attributes.type)var v=new Int32Array(s);else if("Int64"===e.attributes.type){var v=new Int32Array(s);"binary"===e.attributes.format&&(v=v.filter(function(e,t){if(t%2!=1)return!0}))}}return v}(y[b],p)),b++;switch(f[m]){case"PointData":var A=parseInt(d.attributes.NumberOfPoints),M=g.attributes.Normals;if(A>0)for(var x=0,L=y.length;x<L;x++)if(M===y[x].attributes.Name){var E=y[x].attributes.NumberOfComponents;c=new Float32Array(A*E),c.set(y[x].text,0)}break;case"Points":var A=parseInt(d.attributes.NumberOfPoints);if(A>0){var E=g.DataArray.attributes.NumberOfComponents;u=new Float32Array(A*E),u.set(g.DataArray.text,0)}break;case"Strips":var T=parseInt(d.attributes.NumberOfStrips);if(T>0){var k=new Int32Array(g.DataArray[0].text.length),_=new Int32Array(g.DataArray[1].text.length);k.set(g.DataArray[0].text,0),_.set(g.DataArray[1].text,0);var N=T+k.length;h=new Uint32Array(3*N-9*T);for(var C=0,x=0,L=T;x<L;x++){for(var S=[],O=0,F=_[x],P=0;O<F-P;O++)S.push(k[O]),x>0&&(P=_[x-1]);for(var R=0,F=_[x],P=0;R<F-P-2;R++)R%2?(h[C++]=S[R],h[C++]=S[R+2],h[C++]=S[R+1]):(h[C++]=S[R],h[C++]=S[R+1],h[C++]=S[R+2]),x>0&&(P=_[x-1])}}break;case"Polys":var I=parseInt(d.attributes.NumberOfPolys);if(I>0){var k=new Int32Array(g.DataArray[0].text.length),_=new Int32Array(g.DataArray[1].text.length);k.set(g.DataArray[0].text,0),_.set(g.DataArray[1].text,0);var N=I+k.length;h=new Uint32Array(3*N-9*I);for(var C=0,B=0,x=0,L=I,P=0;x<L;){for(var D=[],O=0,F=_[x];O<F-P;)D.push(k[B++]),O++;for(var R=1;R<F-P-1;)h[C++]=D[0],h[C++]=D[R],h[C++]=D[R+1],R++;x++,P=_[x-1]}}}}m++}var V=new n.BufferGeometry;return V.setIndex(new n.BufferAttribute(h,1)),V.addAttribute("position",new n.BufferAttribute(u,3)),c.length===u.length&&V.addAttribute("normal",new n.BufferAttribute(c,3)),V}}(a(e)):i[2].includes("ASCII")?function(e){var t,r=[],a=[],i=[],o=[],s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,u=/^POINTS /,c=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,p=/^CELL_DATA[ ]+(\d+)/,f=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,b=!1,w=!1,A=!1,M=!1,x=e.split("\n");for(var L in x){var E=x[L];if(v)for(;null!==(t=s.exec(E));){var T=parseFloat(t[1]),k=parseFloat(t[2]),_=parseFloat(t[3]);a.push(T,k,_)}else if(g){if(null!==(t=l.exec(E))){var N=parseInt(t[1]),C=t[2].split(/\s+/);if(N>=3)for(var S,O,F=parseInt(C[0]),P=1,R=0;R<N-2;++R)S=parseInt(C[P]),O=parseInt(C[P+1]),r.push(F,S,O),P++}}else if(y){if(null!==(t=l.exec(E))){var N=parseInt(t[1]),C=t[2].split(/\s+/);if(N>=3)for(var F,S,O,R=0;R<N-2;R++)R%2==1?(F=parseInt(C[R]),S=parseInt(C[R+2]),O=parseInt(C[R+1]),r.push(F,S,O)):(F=parseInt(C[R]),S=parseInt(C[R+1]),O=parseInt(C[R+2]),r.push(F,S,O))}}else if(b||w)if(A)for(;null!==(t=s.exec(E));){var I=parseFloat(t[1]),B=parseFloat(t[2]),D=parseFloat(t[3]);i.push(I,B,D)}else if(M)for(;null!==(t=s.exec(E));){var V=parseFloat(t[1]),j=parseFloat(t[2]),U=parseFloat(t[3]);o.push(V,j,U)}null!==c.exec(E)?(g=!0,v=!1,y=!1):null!==u.exec(E)?(g=!1,v=!0,y=!1):null!==h.exec(E)?(g=!1,v=!1,y=!0):null!==d.exec(E)?(b=!0,v=!1,g=!1,y=!1):null!==p.exec(E)?(w=!0,v=!1,g=!1,y=!1):null!==f.exec(E)?(A=!0,M=!1,v=!1,g=!1,y=!1):null!==m.exec(E)&&(M=!0,A=!1,v=!1,g=!1,y=!1)}var G,z="point";if(i.length===r.length&&(z="cell"),"point"===z)G=new n.BufferGeometry,G.setIndex(new n.BufferAttribute(new Uint32Array(r),1)),G.addAttribute("position",new n.BufferAttribute(new Float32Array(a),3)),i.length===a.length&&G.addAttribute("color",new n.BufferAttribute(new Float32Array(i),3)),o.length===a.length&&G.addAttribute("normal",new n.BufferAttribute(new Float32Array(o),3));else{G=new n.Geometry;for(var H,Y,X,W,T,k,_,I,B,D,K=r.length/3,Q=a.length/3,R=0;R<Q;++R)T=a[3*R+0],k=a[3*R+1],_=a[3*R+2],G.vertices.push(new n.Vector3(T,k,_));for(var L=0;L<K;++L)Y=r[3*L+0],X=r[3*L+1],W=r[3*L+2],G.faces.push(new n.Face3(Y,X,W));if(i.length===3*K)for(var L=0;L<K;++L)H=G.faces[L],I=i[3*L+0],B=i[3*L+1],D=i[3*L+2],H.color=(new n.Color).setRGB(I,B,D)}return G}(a(e)):function(e){function t(e,t){for(var r=t,a=e[r],n=[];10!==a;)n.push(String.fromCharCode(a)),r++,a=e[r];return{start:t,end:r,next:r+1,parsedString:n.join("")}}for(var r,a,i,o,s,l,u,c=new Uint8Array(e),h=new DataView(e),d=[],p=[],f=[],m=[],v=0;;){if(l=t(c,v),u=l.parsedString,0===u.indexOf("POINTS")){for(m.push(u),o=parseInt(u.split(" ")[1],10),r=4*o*3,d=new Float32Array(3*o),a=l.next,i=0;i<o;i++)d[3*i]=h.getFloat32(a,!1),d[3*i+1]=h.getFloat32(a+4,!1),d[3*i+2]=h.getFloat32(a+8,!1),a+=12;l.next=l.next+r+1}else if(0===u.indexOf("TRIANGLE_STRIPS")){var g=parseInt(u.split(" ")[1],10),y=parseInt(u.split(" ")[2],10);r=4*y,f=new Uint32Array(3*y-9*g);var b=0;for(a=l.next,i=0;i<g;i++){var w=h.getInt32(a,!1),A=[];for(a+=4,s=0;s<w;s++)A.push(h.getInt32(a,!1)),a+=4;for(var M=0;M<w-2;M++)M%2?(f[b++]=A[M],f[b++]=A[M+2],f[b++]=A[M+1]):(f[b++]=A[M],f[b++]=A[M+1],f[b++]=A[M+2])}l.next=l.next+r+1}else if(0===u.indexOf("POLYGONS")){var g=parseInt(u.split(" ")[1],10),y=parseInt(u.split(" ")[2],10);r=4*y,f=new Uint32Array(3*y-9*g);var b=0;for(a=l.next,i=0;i<g;i++){var w=h.getInt32(a,!1),A=[];for(a+=4,s=0;s<w;s++)A.push(h.getInt32(a,!1)),a+=4;for(var M=1;M<w-1;M++)f[b++]=A[0],f[b++]=A[M],f[b++]=A[M+1]}l.next=l.next+r+1}else if(0===u.indexOf("POINT_DATA")){for(o=parseInt(u.split(" ")[1],10),l=t(c,l.next),r=4*o*3,p=new Float32Array(3*o),a=l.next,i=0;i<o;i++)p[3*i]=h.getFloat32(a,!1),p[3*i+1]=h.getFloat32(a+4,!1),p[3*i+2]=h.getFloat32(a+8,!1),a+=12;l.next=l.next+r}if((v=l.next)>=c.byteLength)break}var x=new n.BufferGeometry;return x.setIndex(new n.BufferAttribute(f,1)),x.addAttribute("position",new n.BufferAttribute(d,3)),p.length===d.length&&x.addAttribute("normal",new n.BufferAttribute(p,3)),x}(e)}}),t.default=n.VTKLoader},function(e,t,r){"use strict";var a,n;Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=r(0),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(o);!function(o,s){"object"===i(t)&&void 0!==e?e.exports=s():(a=s,void 0!==(n="function"==typeof a?a.call(t,r,t,e):a)&&(e.exports=n))}(0,function(){var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),r=function t(){e(this,t),this.boneName="",this.BoneIndex=0,this.Indeces=[],this.Weights=[],this.initMatrix=null,this.OffsetMatrix=null},a=function t(){e(this,t),this.animeName="",this.boneName="",this.targetBone=null,this.keyType=4,this.frameStartLv=0,this.keyFrames=[],this.InverseMx=null},n=function(){function r(t){e(this,r),this.fps=30,this.name="xanimation",this.length=0,this.hierarchy=[],this.putFlags=t,void 0===this.putFlags.putPos&&(this.putFlags.putPos=!0),void 0===this.putFlags.putRot&&(this.putFlags.putRot=!0),void 0===this.putFlags.putScl&&(this.putFlags.putScl=!0)}return t(r,[{key:"make",value:function(e){for(var t=0;t<e.length;t++)this.hierarchy.push(this.makeBonekeys(e[t]));this.length=this.hierarchy[0].keys[this.hierarchy[0].keys.length-1].time}},{key:"clone",value:function(){return Object.assign({},this)}},{key:"makeBonekeys",value:function(e){var t={};return t.name=e.boneName,t.parent="",t.keys=this.keyFrameRefactor(e),t.copy=function(){return Object.assign({},this)},t}},{key:"keyFrameRefactor",value:function(e){for(var t=[],r=0;r<e.keyFrames.length;r++){var a={};a.time=e.keyFrames[r].time*this.fps,e.keyFrames[r].pos&&this.putFlags.putPos&&(a.pos=e.keyFrames[r].pos),e.keyFrames[r].rot&&this.putFlags.putRot&&(a.rot=e.keyFrames[r].rot),e.keyFrames[r].scl&&this.putFlags.putScl&&(a.scl=e.keyFrames[r].scl),e.keyFrames[r].matrix&&(a.matrix=e.keyFrames[r].matrix,this.putFlags.putPos&&(a.pos=(new s.Vector3).setFromMatrixPosition(a.matrix)),this.putFlags.putRot&&(a.rot=(new s.Quaternion).setFromRotationMatrix(a.matrix)),this.putFlags.putScl&&(a.scl=(new s.Vector3).setFromMatrixScale(a.matrix))),t.push(a)}return t}}]),r}(),i=function t(){e(this,t),this.index=0,this.Frame=0,this.time=0,this.matrix=null};return function(){function o(t,r){e(this,o),this.debug=!1,this.manager=void 0!==t?t:new s.DefaultLoadingManager,this.texloader=void 0!==r?r:new s.TextureLoader,this.url="",this.baseDir="",this._putMatLength=0,this._nowMat=null,this._tmpUvArray=[],this._facesNormal=[],this._nowFrameName="",this.frameHierarchie=[],this.Hierarchies={},this.HieStack=[],this._currentObject={},this._currentFrame={},this._data=null,this.onLoad=null,this.IsUvYReverse=!0,this.Meshes=[],this.animations=[],this.animTicksPerSecond=30,this._currentGeo=null,this._currentAnime=null,this._currentAnimeFrames=null}return t(o,[{key:"_setArgOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){for(var r=t;r<e.length;r++)switch(r){case 0:this.url=e[r];break;case 1:this.options=e[r]}void 0===this.options&&(this.options={})}}},{key:"load",value:function(e,t,r,a){var n=this;this._setArgOption(e);var i=new s.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(this.url,function(e){n._parse(e,t)},r,a)}},{key:"fromResponsedData",value:function(e,t,r){this._setArgOption(t),this._parse(e,r)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(r=e.indexOf("//",t),-1===r&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var a=-1;a=e.indexOf("\r\n",t),a>0?t=a+2:(a=e.indexOf("\r",t),t=a>0?a+1:e.indexOf("\n",t)+1)}return e.substr(t)}},{key:"_readLine",value:function(e){for(var t=0;;){var r=-1;if(r=e.indexOf("//",t),-1===r&&(r=e.indexOf("#",t)),!(r>-1&&r<2))break;var a=-1;a=e.indexOf("\r\n",t),a>0?t=a+2:(a=e.indexOf("\r",t),t=a>0?a+1:e.indexOf("\n",t)+1)}return e.substr(t)}},{key:"_isBinary",value:function(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var r=t.byteLength,a=0;a<r;a++)if(t.getUint8(a,!1)>127)return!0;return!1}},{key:"ensureBinary",value:function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}},{key:"ensureString",value:function(e){return"string"!=typeof e?s.LoaderUtils.decodeText(new Uint8Array(e)):e}},{key:"_parse",value:function(e,t){var r=this.ensureBinary(e);return this._data=this.ensureString(e),this.onLoad=t,this._isBinary(r)?this._parseBinary(r):this._parseASCII()}},{key:"_parseBinary",value:function(e){return this._parseASCII(s.LoaderUtils.decodeText(new Uint8Array(e)))}},{key:"_parseASCII",value:function(){this.url.lastIndexOf("/")>0&&(this.baseDir=this.url.substr(0,this.url.lastIndexOf("/")+1));this.Hierarchies.children=[],this._hierarchieParse(this.Hierarchies,16),this._changeRoot(),this._currentObject=this.Hierarchies.children.shift(),this.mainloop()}},{key:"_hierarchieParse",value:function(e,t){for(var r=t;;){var a=this._data.indexOf("{",r)+1,n=this._data.indexOf("}",r),i=this._data.indexOf("{",a)+1;if(!(a>0&&n>a)){r=-1===a?this._data.length:n+1;break}var o={};o.children=[];var s=this._readLine(this._data.substr(r,a-r-1)).trim(),l=s.split(/ /g);if(l.length>0?(o.type=l[0],l.length>=2?o.name=l[1]:o.name=l[0]+this.Hierarchies.children.length):(o.name=s,o.type=""),"Animation"===o.type){o.data=this._data.substr(i,n-i).trim();var u=this._hierarchieParse(o,n+1);r=u.end,o.children=u.parent.children}else{var c=this._data.lastIndexOf(";",i>0?Math.min(i,n):n);if(o.data=this._data.substr(a,c-a).trim(),i<=0||n<i)r=n+1;else{var h=Math.max(c+1,a),d=this._hierarchieParse(o,h);r=d.end,o.children=d.parent.children}}o.parent=e,"template"!=o.type&&e.children.push(o)}return{parent:e,end:r}}},{key:"mainloop",value:function(){var e=this;this.mainProc(),this._currentObject.parent||this._currentObject.children.length>0||!this._currentObject.worked?setTimeout(function(){e.mainloop()},1):setTimeout(function(){e.onLoad({models:e.Meshes,animations:e.animations})},1)}},{key:"mainProc",value:function(){for(var e=!1;;){if(!this._currentObject.worked){switch(this._currentObject.type){case"template":break;case"AnimTicksPerSecond":this.animTicksPerSecond=parseInt(this._currentObject.data);break;case"Frame":this._setFrame();break;case"FrameTransformMatrix":this._setFrameTransformMatrix();break;case"Mesh":this._changeRoot(),this._currentGeo={},this._currentGeo.name=this._currentObject.name.trim(),this._currentGeo.parentName=this._getParentName(this._currentObject).trim(),this._currentGeo.VertexSetedBoneCount=[],this._currentGeo.Geometry=new s.Geometry,this._currentGeo.Materials=[],this._currentGeo.normalVectors=[],this._currentGeo.BoneInfs=[],this._currentGeo.baseFrame=this._currentFrame,this._makeBoneFrom_CurrentFrame(),this._readVertexDatas(),e=!0;break;case"MeshNormals":this._readVertexDatas();break;case"MeshTextureCoords":this._setMeshTextureCoords();break;case"VertexDuplicationIndices":break;case"MeshMaterialList":this._setMeshMaterialList();break;case"Material":this._setMaterial();break;case"SkinWeights":this._setSkinWeights();break;case"AnimationSet":this._changeRoot(),this._currentAnime={},this._currentAnime.name=this._currentObject.name.trim(),this._currentAnime.AnimeFrames=[];break;case"Animation":this._currentAnimeFrames&&this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=new a,this._currentAnimeFrames.boneName=this._currentObject.data.trim();break;case"AnimationKey":this._readAnimationKey(),e=!0}this._currentObject.worked=!0}if(this._currentObject.children.length>0){if(this._currentObject=this._currentObject.children.shift(),this.debug&&console.log("processing "+this._currentObject.name),e)break}else if(this._currentObject.worked&&this._currentObject.parent&&!this._currentObject.parent.parent&&this._changeRoot(),this._currentObject.parent?this._currentObject=this._currentObject.parent:e=!0,e)break}}},{key:"_changeRoot",value:function(){null!=this._currentGeo&&this._currentGeo.name&&this._makeOutputGeometry(),this._currentGeo={},null!=this._currentAnime&&this._currentAnime.name&&(this._currentAnimeFrames&&(this._currentAnime.AnimeFrames.push(this._currentAnimeFrames),this._currentAnimeFrames=null),this._makeOutputAnimation()),this._currentAnime={}}},{key:"_getParentName",value:function(e){return e.parent?e.parent.name?e.parent.name:this._getParentName(e.parent):""}},{key:"_setFrame",value:function(){this._nowFrameName=this._currentObject.name.trim(),this._currentFrame={},this._currentFrame.name=this._nowFrameName,this._currentFrame.children=[],this._currentObject.parent&&this._currentObject.parent.name&&(this._currentFrame.parentName=this._currentObject.parent.name),this.frameHierarchie.push(this._nowFrameName),this.HieStack[this._nowFrameName]=this._currentFrame}},{key:"_setFrameTransformMatrix",value:function(){this._currentFrame.FrameTransformMatrix=new s.Matrix4;var e=this._currentObject.data.split(",");this._ParseMatrixData(this._currentFrame.FrameTransformMatrix,e),this._makeBoneFrom_CurrentFrame()}},{key:"_makeBoneFrom_CurrentFrame",value:function(){if(this._currentFrame.FrameTransformMatrix){var e=new s.Bone;if(e.name=this._currentFrame.name,e.applyMatrix(this._currentFrame.FrameTransformMatrix),e.matrixWorld=e.matrix,e.FrameTransformMatrix=this._currentFrame.FrameTransformMatrix,this._currentFrame.putBone=e,this._currentFrame.parentName)for(var t in this.HieStack)this.HieStack[t].name===this._currentFrame.parentName&&this.HieStack[t].putBone.add(this._currentFrame.putBone)}}},{key:"_readVertexDatas",value:function(){for(var e=0,t=0,r=0,a=0,n=0;;){var i=!1;if(0===r){e=this._readInt1(e).endRead,r=1,n=0,a=this._currentObject.data.indexOf(";;",e)+1,a<=0&&(a=this._currentObject.data.length)}else{var o=0;switch(t){case 0:o=this._currentObject.data.indexOf(",",e)+1;break;case 1:o=this._currentObject.data.indexOf(";,",e)+1}switch((0===o||o>a)&&(o=a,r=0,i=!0),this._currentObject.type){case"Mesh":switch(t){case 0:this._readVertex1(this._currentObject.data.substr(e,o-e));break;case 1:this._readFace1(this._currentObject.data.substr(e,o-e))}break;case"MeshNormals":switch(t){case 0:this._readNormalVector1(this._currentObject.data.substr(e,o-e));break;case 1:this._readNormalFace1(this._currentObject.data.substr(e,o-e),n)}}e=o+1,n++,i&&t++}if(e>=this._currentObject.data.length)break}}},{key:"_readInt1",value:function(e){var t=this._currentObject.data.indexOf(";",e);return{refI:parseInt(this._currentObject.data.substr(e,t-e)),endRead:t+1}}},{key:"_readVertex1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.Geometry.vertices.push(new s.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),this._currentGeo.Geometry.skinIndices.push(new s.Vector4(0,0,0,0)),this._currentGeo.Geometry.skinWeights.push(new s.Vector4(1,0,0,0)),this._currentGeo.VertexSetedBoneCount.push(0)}},{key:"_readFace1",value:function(e){var t=this._readLine(e.trim()).substr(2,e.length-4).split(",");this._currentGeo.Geometry.faces.push(new s.Face3(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),new s.Vector3(1,1,1).normalize()))}},{key:"_readNormalVector1",value:function(e){var t=this._readLine(e.trim()).substr(0,e.length-2).split(";");this._currentGeo.normalVectors.push(new s.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])))}},{key:"_readNormalFace1",value:function(e,t){var r=this._readLine(e.trim()).substr(2,e.length-4).split(","),a=parseInt(r[0],10),n=this._currentGeo.normalVectors[a];a=parseInt(r[1],10);var i=this._currentGeo.normalVectors[a];a=parseInt(r[2],10);var o=this._currentGeo.normalVectors[a];this._currentGeo.Geometry.faces[t].vertexNormals=[n,i,o]}},{key:"_setMeshNormals",value:function(){for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r){e=this._readInt1(0).endRead,r=1}else{var a=this._currentObject.data.indexOf(",",e)+1;-1===a&&(a=this._currentObject.data.indexOf(";;",e)+1,t=2,r=0);var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(";");this._currentGeo.normalVectors.push([parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])]),e=a+1}}if(e>=this._currentObject.data.length)break}}},{key:"_setMeshTextureCoords",value:function(){this._tmpUvArray=[],this._currentGeo.Geometry.faceVertexUvs=[],this._currentGeo.Geometry.faceVertexUvs.push([]);for(var e=0,t=0,r=0;;){switch(t){case 0:if(0===r){e=this._readInt1(0).endRead,r=1}else{var a=this._currentObject.data.indexOf(",",e)+1;0===a&&(a=this._currentObject.data.length,t=2,r=0);var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(";");this.IsUvYReverse?this._tmpUvArray.push(new s.Vector2(parseFloat(i[0]),1-parseFloat(i[1]))):this._tmpUvArray.push(new s.Vector2(parseFloat(i[0]),parseFloat(i[1]))),e=a+1}}if(e>=this._currentObject.data.length)break}this._currentGeo.Geometry.faceVertexUvs[0]=[];for(var o=0;o<this._currentGeo.Geometry.faces.length;o++)this._currentGeo.Geometry.faceVertexUvs[0][o]=[],this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].a]),this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].b]),this._currentGeo.Geometry.faceVertexUvs[0][o].push(this._tmpUvArray[this._currentGeo.Geometry.faces[o].c]);this._currentGeo.Geometry.uvsNeedUpdate=!0}},{key:"_setMeshMaterialList",value:function(){for(var e=0,t=0,r=0;;){if(r<2){e=this._readInt1(e).endRead,r++}else{var a=this._currentObject.data.indexOf(";",e);-1===a&&(a=this._currentObject.data.length,t=3,r=0);for(var n=this._currentObject.data.substr(e,a-e),i=this._readLine(n.trim()).split(","),o=0;o<i.length;o++)this._currentGeo.Geometry.faces[o].materialIndex=parseInt(i[o]);e=this._currentObject.data.length}if(e>=this._currentObject.data.length||t>=3)break}}},{key:"_setMaterial",value:function(){var e=new s.MeshPhongMaterial({color:16777215*Math.random()});e.side=s.FrontSide,e.name=this._currentObject.name;var t=0,r=this._currentObject.data.indexOf(";;",t),a=this._currentObject.data.substr(t,r-t),n=this._readLine(a.trim()).split(";");e.color.r=parseFloat(n[0]),e.color.g=parseFloat(n[1]),e.color.b=parseFloat(n[2]),t=r+2,r=this._currentObject.data.indexOf(";",t),a=this._currentObject.data.substr(t,r-t),e.shininess=parseFloat(this._readLine(a)),t=r+1,r=this._currentObject.data.indexOf(";;",t),a=this._currentObject.data.substr(t,r-t);var i=this._readLine(a.trim()).split(";");e.specular.r=parseFloat(i[0]),e.specular.g=parseFloat(i[1]),e.specular.b=parseFloat(i[2]),t=r+2,r=this._currentObject.data.indexOf(";;",t),-1===r&&(r=this._currentObject.data.length),a=this._currentObject.data.substr(t,r-t);var o=this._readLine(a.trim()).split(";");e.emissive.r=parseFloat(o[0]),e.emissive.g=parseFloat(o[1]),e.emissive.b=parseFloat(o[2]);for(var l=null;;){if(!(this._currentObject.children.length>0))break;l=this._currentObject.children.shift(),this.debug&&console.log("processing "+l.name);var u=l.data.substr(1,l.data.length-2);switch(l.type){case"TextureFilename":e.map=this.texloader.load(this.baseDir+u);break;case"BumpMapFilename":e.bumpMap=this.texloader.load(this.baseDir+u),e.bumpScale=.05;break;case"NormalMapFilename":e.normalMap=this.texloader.load(this.baseDir+u),e.normalScale=new s.Vector2(2,2);break;case"EmissiveMapFilename":e.emissiveMap=this.texloader.load(this.baseDir+u);break;case"LightMapFilename":e.lightMap=this.texloader.load(this.baseDir+u)}}this._currentGeo.Materials.push(e)}},{key:"_setSkinWeights",value:function(){var e=new r,t=0,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);t=a+1,e.boneName=n.substr(1,n.length-2),e.BoneIndex=this._currentGeo.BoneInfs.length,a=this._currentObject.data.indexOf(";",t),t=a+1,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);for(var i=this._readLine(n.trim()).split(","),o=0;o<i.length;o++)e.Indeces.push(parseInt(i[o]));t=a+1,a=this._currentObject.data.indexOf(";",t),n=this._currentObject.data.substr(t,a-t);for(var l=this._readLine(n.trim()).split(","),u=0;u<l.length;u++)e.Weights.push(parseFloat(l[u]));t=a+1,a=this._currentObject.data.indexOf(";",t),a<=0&&(a=this._currentObject.data.length),n=this._currentObject.data.substr(t,a-t);var c=this._readLine(n.trim()).split(",");e.OffsetMatrix=new s.Matrix4,this._ParseMatrixData(e.OffsetMatrix,c),this._currentGeo.BoneInfs.push(e)}},{key:"_makePutBoneList",value:function(e,t){var r=!1;for(var a in this.HieStack)if(this.HieStack[a].name===e||r){r=!0;var n=new s.Bone;if(n.name=this.HieStack[a].name,n.applyMatrix(this.HieStack[a].FrameTransformMatrix),n.matrixWorld=n.matrix,n.FrameTransformMatrix=this.HieStack[a].FrameTransformMatrix,n.pos=(new s.Vector3).setFromMatrixPosition(n.FrameTransformMatrix).toArray(),n.rotq=(new s.Quaternion).setFromRotationMatrix(n.FrameTransformMatrix).toArray(),n.scl=(new s.Vector3).setFromMatrixScale(n.FrameTransformMatrix).toArray(),this.HieStack[a].parentName&&this.HieStack[a].parentName.length>0)for(var i=0;i<t.length;i++)if(this.HieStack[a].parentName===t[i].name){t[i].add(n),n.parent=i;break}t.push(n)}}},{key:"_makeOutputGeometry",value:function(){this._currentGeo.Geometry.computeBoundingBox(),this._currentGeo.Geometry.computeBoundingSphere(),this._currentGeo.Geometry.verticesNeedUpdate=!0,this._currentGeo.Geometry.normalsNeedUpdate=!0,this._currentGeo.Geometry.colorsNeedUpdate=!0,this._currentGeo.Geometry.uvsNeedUpdate=!0,this._currentGeo.Geometry.groupsNeedUpdate=!0;var e=null;if(this._currentGeo.BoneInfs.length>0){var t=[];this._makePutBoneList(this._currentGeo.baseFrame.parentName,t);for(var r=0;r<this._currentGeo.BoneInfs.length;r++){for(var a=0,n=0;n<t.length;n++)if(t[n].name===this._currentGeo.BoneInfs[r].boneName){a=n,t[n].OffsetMatrix=new s.Matrix4,t[n].OffsetMatrix.copy(this._currentGeo.BoneInfs[r].OffsetMatrix);break}for(var i=0;i<this._currentGeo.BoneInfs[r].Indeces.length;i++){var o=this._currentGeo.BoneInfs[r].Indeces[i],l=this._currentGeo.BoneInfs[r].Weights[i];switch(this._currentGeo.VertexSetedBoneCount[o]){case 0:this._currentGeo.Geometry.skinIndices[o].x=a,this._currentGeo.Geometry.skinWeights[o].x=l;break;case 1:this._currentGeo.Geometry.skinIndices[o].y=a,this._currentGeo.Geometry.skinWeights[o].y=l;break;case 2:this._currentGeo.Geometry.skinIndices[o].z=a,this._currentGeo.Geometry.skinWeights[o].z=l;break;case 3:this._currentGeo.Geometry.skinIndices[o].w=a,this._currentGeo.Geometry.skinWeights[o].w=l}this._currentGeo.VertexSetedBoneCount[o]++,this._currentGeo.VertexSetedBoneCount[o]>4&&console.log("warn! over 4 bone weight! :"+o)}}for(var u=0;u<this._currentGeo.Materials.length;u++)this._currentGeo.Materials[u].skinning=!0;for(var c=[],h=0;h<t.length;h++)t[h].OffsetMatrix?c.push(t[h].OffsetMatrix):c.push(new s.Matrix4);var d=(new s.BufferGeometry).fromGeometry(this._currentGeo.Geometry);d.bones=t,e=new s.SkinnedMesh(d,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials),e.skeleton.boneInverses=c}else{var p=(new s.BufferGeometry).fromGeometry(this._currentGeo.Geometry);e=new s.Mesh(p,1===this._currentGeo.Materials.length?this._currentGeo.Materials[0]:this._currentGeo.Materials)}e.name=this._currentGeo.name;var f=new s.Matrix4,m=this._currentGeo.baseFrame.putBone;if(m&&m.parent){for(;;){if(!(m=m.parent))break;f.multiply(m.FrameTransformMatrix)}e.applyMatrix(f)}this.Meshes.push(e)}},{key:"_readAnimationKey",value:function(){var e=0,t=this._currentObject.data.indexOf(";",e),r=this._currentObject.data.substr(e,t-e);e=t+1;var a=parseInt(this._readLine(r));t=this._currentObject.data.indexOf(";",e),e=t+1,r=this._currentObject.data.substr(e);for(var n=this._readLine(r.trim()).split(";;,"),o=0;o<n.length;o++){var l=n[o].split(";"),u=new i;if(u.type=a,u.Frame=parseInt(l[0]),u.index=this._currentAnimeFrames.keyFrames.length,u.time=u.Frame,4!=a){for(var c=!1,h=0;h<this._currentAnimeFrames.keyFrames.length;h++)if(this._currentAnimeFrames.keyFrames[h].Frame===u.Frame){u=this._currentAnimeFrames.keyFrames[h],c=!0;break}var d=l[2].split(",");switch(a){case 0:u.rot=new s.Quaternion(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),-1*parseFloat(d[0]));break;case 1:u.scl=new s.Vector3(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]));break;case 2:u.pos=new s.Vector3(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]))}c||this._currentAnimeFrames.keyFrames.push(u)}else u.matrix=new s.Matrix4,this._ParseMatrixData(u.matrix,l[2].split(",")),this._currentAnimeFrames.keyFrames.push(u)}}},{key:"_makeOutputAnimation",value:function(){var e=new n(this.options);e.fps=this.animTicksPerSecond,e.name=this._currentAnime.name,e.make(this._currentAnime.AnimeFrames),this.animations.push(e)}},{key:"assignAnimation",value:function(e,t,r){var a=e,n=t;if(a||(a=this.Meshes[0]),n||(n=this.animations[0]),!a||!n)return null;var i={};i.fps=n.fps,i.name=n.name,i.length=n.length,i.hierarchy=[];for(var o=0;o<a.skeleton.bones.length;o++){for(var l=!1,u=0;u<n.hierarchy.length;u++)if(a.skeleton.bones[o].name===n.hierarchy[u].name){l=!0;var c=n.hierarchy[u].copy();if(c.parent=-1,a.skeleton.bones[o].parent&&"Bone"===a.skeleton.bones[o].parent.type)for(var h=0;h<i.hierarchy.length;h++)i.hierarchy[h].name===a.skeleton.bones[o].parent.name&&(c.parent=h,c.parentName=a.skeleton.bones[o].parent.name);i.hierarchy.push(c);break}if(!l){var d=n.hierarchy[0].copy();d.name=a.skeleton.bones[o].name,d.parent=-1;for(var p=0;p<d.keys.length;p++)d.keys[p].pos&&d.keys[p].pos.set(0,0,0),d.keys[p].scl&&d.keys[p].scl.set(1,1,1),d.keys[p].rot&&d.keys[p].rot.set(0,0,0,1);i.hierarchy.push(d)}}return a.geometry.animations||(a.geometry.animations=[]),a.geometry.animations.push(s.AnimationClip.parseAnimation(i,a.skeleton.bones)),a.animationMixer||(a.animationMixer=new s.AnimationMixer(a)),i}},{key:"_ParseMatrixData",value:function(e,t){e.set(parseFloat(t[0]),parseFloat(t[4]),parseFloat(t[8]),parseFloat(t[12]),parseFloat(t[1]),parseFloat(t[5]),parseFloat(t[9]),parseFloat(t[13]),parseFloat(t[2]),parseFloat(t[6]),parseFloat(t[10]),parseFloat(t[14]),parseFloat(t[3]),parseFloat(t[7]),parseFloat(t[11]),parseFloat(t[15]))}}]),o}()}),t.default=s.XLoader}]));